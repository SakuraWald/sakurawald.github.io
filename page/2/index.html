<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sakurawald.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="SakuraWald">
<meta property="og:url" content="https://sakurawald.github.io/page/2/index.html">
<meta property="og:site_name" content="SakuraWald">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://sakurawald.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>SakuraWald</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SakuraWald</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/05/20/leetcode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/20/leetcode/" class="post-title-link" itemprop="url">LeetCode</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-20 14:55:02" itemprop="dateCreated datePublished" datetime="2022-05-20T14:55:02+00:00">2022-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/05/01/database-functional-dependency-normal-form/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/01/database-functional-dependency-normal-form/" class="post-title-link" itemprop="url">Database - Functional Dependency & Normal Form</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-01 18:17:51" itemprop="dateCreated datePublished" datetime="2022-05-01T18:17:51+00:00">2022-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/05/01/database-database-design-e-r-model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/01/database-database-design-e-r-model/" class="post-title-link" itemprop="url">Database - Database Design & E-R Model</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-01 13:56:02" itemprop="dateCreated datePublished" datetime="2022-05-01T13:56:02+00:00">2022-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/30/database-relational-query-language/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/30/database-relational-query-language/" class="post-title-link" itemprop="url">Database -  Relational Query Language</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-30 10:53:48" itemprop="dateCreated datePublished" datetime="2022-04-30T10:53:48+00:00">2022-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Formal-RQL"><a href="#Formal-RQL" class="headerlink" title="Formal RQL"></a>Formal RQL</h1><h2 id="Relational-Algebra"><a href="#Relational-Algebra" class="headerlink" title="Relational Algebra"></a>Relational Algebra</h2><p><code>关系代数</code> 是一种 <code>过程化查询语言</code>，它以 <code>关系</code> 作为输入，同时输出 <code>关系</code> 。</p>
<p><code>关系</code> 是定义在一组<code>域</code> 上的 <code>笛卡尔积</code></p>
<h3 id="Basic-Relational-Algebra"><a href="#Basic-Relational-Algebra" class="headerlink" title="Basic Relational-Algebra"></a>Basic Relational-Algebra</h3><h4 id="Select-Operation"><a href="#Select-Operation" class="headerlink" title="Select Operation"></a>Select Operation</h4><p><code>选择 (Select)</code> \sigma 选出 <code>满足给定谓词的元组</code>。</p>
<h4 id="Project-Operation"><a href="#Project-Operation" class="headerlink" title="Project Operation"></a>Project Operation</h4><p><code>投影 (Project)</code> \Pi 选出 <code>指定的属性</code></p>
<blockquote>
<p>由于 <code>关系</code> 不允许 <code>重复元组</code>，所以 <code>投影</code> 运算之后需要再次 <code>对元组进行去重</code></p>
</blockquote>
<h4 id="Set-Union-Operation"><a href="#Set-Union-Operation" class="headerlink" title="Set-Union Operation"></a>Set-Union Operation</h4><blockquote>
<p>参与 <code>集合运算</code> 的 <code>两个关系</code> 必须是 <code>相容的 (Compatible)</code>：</p>
<ul>
<li>r 和 s 是 <code>同元的</code>，即 <code>属性数量</code> 相同</li>
<li>对所有的 <code>i</code>，<code>r的第i个属性的域</code> 与 <code>s的第i个属性的域</code> 要相同。</li>
</ul>
</blockquote>
<h4 id="Set-Difference-Operation"><a href="#Set-Difference-Operation" class="headerlink" title="Set-Difference Operation"></a>Set-Difference Operation</h4><h4 id="Cartesian-Product-Operation"><a href="#Cartesian-Product-Operation" class="headerlink" title="Cartesian Product Operation"></a>Cartesian Product Operation</h4><p><code>笛卡尔积</code> 用于 <code>组合/串接</code> 两个 <code>关系</code>。</p>
<p>参与 <code>笛卡尔积</code> 的两个 <code>关系</code> 的 <code>属性名</code> 必须 <code>不同</code>，当存在 <code>同名属性 (Common Attribute)</code> 时，需要添加 <code>关系名前缀</code> 用于 <code>区分</code>。</p>
<blockquote>
<p>n.b. r \times s &#x3D; r * s，即 <code>笛卡尔积</code> 保留了 <code>关系r的元组</code> 和 <code>关系s元组</code> 的 <code>所有可能的串接方式</code>。</p>
<p>所得的 <code>结果关系</code> 可能有 <code>某些元组</code> 是 <code>不符合</code> <code>关系r</code> 和 <code>关系s</code> 所提供的 <code>信息</code> 的。</p>
<p>可以使用下列的 <code>选择运算</code> 来 <code>过滤掉</code> <code>这些不符合事实的元组</code></p>
</blockquote>
<h4 id="Renaming-Operation"><a href="#Renaming-Operation" class="headerlink" title="Renaming Operation"></a>Renaming Operation</h4><p><code>更名 (Rename)</code> \rho 用于为 <code>关系代数表达式</code> 提供 <code>可供后续进行引用的标识符</code>。</p>
<hr>
<p>考虑 <code>查询最高工资</code> 的例子。</p>
<hr>
<p>任何 <code>更名运算</code> 都是 <code>可替代的</code>。可以使用 <code>位置标记</code> 来 <code>隐含地</code> <code>引用</code> <code>关系的属性</code>。如 <code>$1 = 第1个属性</code></p>
<p>前面的例子可以 <code>改写</code> 为</p>
<h3 id="Additional-Relational-Algebra"><a href="#Additional-Relational-Algebra" class="headerlink" title="Additional Relational-Algebra"></a>Additional Relational-Algebra</h3><p>所有的 <code>附加关系代数运算</code> 都可以用 <code>基本关系运算</code> 来 <code>描述</code>。</p>
<h4 id="Set-Intersection-Operation"><a href="#Set-Intersection-Operation" class="headerlink" title="Set-Intersection Operation"></a>Set-Intersection Operation</h4><hr>
<h4 id="Natural-Join-Operation"><a href="#Natural-Join-Operation" class="headerlink" title="Natural-Join Operation"></a>Natural-Join Operation</h4><p><code>自然连接</code> \Join 是 <code>笛卡尔积</code> 和 <code>选择</code> 的一种 <code>合并</code>。</p>
<blockquote>
<p>当 <code>两个关系</code> 不存在 <code>相同属性</code> 时， r \Join s &#x3D; r \times s</p>
</blockquote>
<blockquote>
<p><code>自然连接</code> 只不过是 <code>Theta连接</code> 的一个 <code>特例</code></p>
<p>我们经常需要 <code>笛卡尔积</code> 和 <code>选择</code> 一起使用，那么可以转而使用 <code>Theta连接</code> 来 <code>简化书写</code></p>
</blockquote>
<hr>
<blockquote>
<p><code>自然连接</code> 满足 <code>结合律</code>。</p>
</blockquote>
<h4 id="Assignment-Operation"><a href="#Assignment-Operation" class="headerlink" title="Assignment Operation"></a>Assignment Operation</h4><p><code>赋值运算</code> \gets 用于将 <code>关系代数表达式</code> 存储为 <code>常量</code>，以便后续的 <code>引用</code> 。</p>
<blockquote>
<p>这非常类似于 <code>PL的赋值</code></p>
</blockquote>
<blockquote>
<p>n.b. <code>赋值运算</code> 必须 <code>赋值</code> 给 <code>临时变量</code>，而不能直接 <code>赋值</code> 给 <code>永久关系</code>，否则将造成对 <code>数据库的修改</code>。</p>
</blockquote>
<h4 id="Outer-Join-Operation"><a href="#Outer-Join-Operation" class="headerlink" title="Outer-Join Operation"></a>Outer-Join Operation</h4><p><code>外连接运算</code> 可以处理 <code>缺失的信息</code>。</p>
<p>共有3种类型：</p>
<ul>
<li><code>左外连接</code> \sqsupset \Join</li>
<li><code>右外连接</code> \Join \sqsubset</li>
<li><code>全外连接</code> \sqsupset \Join \sqsubset</li>
</ul>
<h3 id="Extended-Relational-Algebra"><a href="#Extended-Relational-Algebra" class="headerlink" title="Extended Relational-Algebra"></a>Extended Relational-Algebra</h3><p>不同于 <code>附加关系代数</code>，<code>拓展关系代数</code> 不能用 <code>基本关系代数</code> 来 <code>描述</code>。</p>
<h4 id="Generalized-Project"><a href="#Generalized-Project" class="headerlink" title="Generalized-Project"></a>Generalized-Project</h4><p><code>广义投影 (Generalized Project)</code>：可以对 <code>投影的属性</code> 进行 <code>常量运算</code></p>
<h4 id="Aggregate"><a href="#Aggregate" class="headerlink" title="Aggregate"></a>Aggregate</h4><p><code>聚集运算 (Aggregate Operation)</code> 的输入是 <code>值的集合</code>，输出 <code>单个值</code>。</p>
<hr>
<p>上面例子给出 <code>查询所有系的教师的平局工资</code> 和 <code>查询每个系的教师的平均工资</code> 的例子。</p>
<blockquote>
<p>当 <code>省略左侧分组</code> 时，默认为：将 <code>输入关系的所有元组</code> <code>分组</code> 为 <code>唯一的一组</code></p>
</blockquote>
<h2 id="Tuple-Relational-Calculus"><a href="#Tuple-Relational-Calculus" class="headerlink" title="Tuple Relational Calculus"></a>Tuple Relational Calculus</h2><h4 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h4><p><code>元组关系演算</code> 的 <code>形式</code> 如下：\s{t P(t)}</p>
<p>其中 P 为 <code>公式</code>。<code>公式</code> 中出现的 <code>变量</code> 分为 <code>自由变量</code> 和 <code>受限变量</code>。</p>
<p><code>公式</code> 由 如下的 <code>原子</code> <code>构成</code>：</p>
<ul>
<li><p>t \in r</p>
<blockquote>
<p>\notin 运算符未定义</p>
</blockquote>
</li>
<li><p>t_1[x] \Theta t_2[y]</p>
<blockquote>
<p>\Theta 为 <code>5个比较运算符</code></p>
</blockquote>
</li>
<li><p>t[x] \Theta c</p>
</li>
</ul>
<p><code>公式</code> 可以由 如下的 <code>规则</code> 来 <code>构造</code>：</p>
<ul>
<li><code>原子</code> 是 <code>公式</code></li>
<li>如果 P_1 是 <code>公式</code>，则 \neg P_1 和 (P_1) 也是 <code>公式</code></li>
<li>如果 P_1 和 P_2 是 <code>公式</code>，则 P_1 \or P_2 ，P_1 \and P_2 以及 P_1 \implies P_2 均是 <code>公式</code></li>
<li>如果 P_1(t) 是包含 <code>自由元组变量</code> t 的 <code>公式</code>，且 r 是 <code>关系</code>，则 \exists t \in r(P_1(t)) 和 \forall t \in r (P_1(t)) 也是 <code>公式</code></li>
</ul>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><ul>
<li><p>查询 <code>2009年秋季学期</code> 或 <code>2010年春季学期</code> 这两个学期 <code>都开设</code> 的 <code>所有课程的集合</code></p>
</li>
<li><p>查询 <code>所有选修了生物系的全部课程的学生</code></p>
</li>
</ul>
<blockquote>
<p>n.b. <code>红色部分</code> 可以正确处理 <code>当生物系没有开设任何课程</code> 的情况</p>
</blockquote>
<h4 id="Expression-Security"><a href="#Expression-Security" class="headerlink" title="Expression Security"></a>Expression Security</h4><p>考虑如下的 <code>元组关系表达式</code></p>
<p>我们称 <code>该表达式</code> 是 <code>不安全的表达式</code>。原因在于：<code>neg</code> 会产生 <code>无限的结果</code>。</p>
<p>进一步地，这是因为我们并没有事先定义 instructor 的 <code>取值范围</code>。</p>
<hr>
<p>为了解决上述问题，我们引入 <code>域 (Domain)</code> 的概念：</p>
<p><code>公式</code> P 的 <code>域</code> dom(P) 用于描述 P <code>所引用的所有值的集合</code>：</p>
<ul>
<li>P 自身所用到的值</li>
<li>P 中涉及的关系的元组中所出现的值</li>
</ul>
<blockquote>
<p>即：<code>P的域</code> &#x3D; <code>P中显式出现的值</code> +<code>名称出现在P中的那些关系的所有值</code></p>
</blockquote>
<hr>
<p>如果 <code>元组关系表达式</code> \s{t P(t)} <code>结果中的所有值</code> 均来自 dom(P)，则称该表达式是 <code>安全的</code>。</p>
<blockquote>
<p><code>安全的表达式</code> 必定包含 <code>有限个结果</code></p>
</blockquote>
<h2 id="Domain-Relational-Calculus"><a href="#Domain-Relational-Calculus" class="headerlink" title="Domain Relational Calculus"></a>Domain Relational Calculus</h2><h3 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h3><p><code>域关系演算</code> 的 <code>形式</code> 如下：\s{&lt;x_1,x_2,\cdots,x_n&gt; P(x_1,x_2,\cdots,x_n)}</p>
<p><code>域关系演算</code> 由 如下的 <code>原子</code> <code>构成</code>：</p>
<ul>
<li>&lt;x_1,x_2,\cdots,x_n&gt; \in r</li>
<li>x \Theta y</li>
<li>x \Theta c</li>
</ul>
<blockquote>
<p><code>公式</code> 的 <code>构造规则</code> 类比 <code>元组关系演算</code>。</p>
</blockquote>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><ul>
<li><p>找出 <code>工资在80000美元以上</code> 的教师的信息</p>
</li>
<li><p>查询 <code>2009年秋季学期</code> 或 <code>2010年春季学期</code> 这两个学期 <code>都开设</code> 的 <code>所有课程的集合</code></p>
</li>
<li><p>查询 <code>所有选修了生物系的全部课程的学生</code></p>
</li>
</ul>
<h3 id="Expression-Security-1"><a href="#Expression-Security-1" class="headerlink" title="Expression Security"></a>Expression Security</h3><p>我们使用与 <code>元组关系演算</code> 同样的策略来解决 <code>表达式安全性问题</code>：引入 <code>域</code> 的概念</p>
<blockquote>
<p>下面几种 <code>语言</code> 在 <code>表达能力</code> 上是 <code>等价的</code>：</p>
<ul>
<li><code>基本关系代数</code></li>
<li><code>安全的元组关系演算</code></li>
<li><code>安全的域关系演算</code></li>
</ul>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/29/database-advanced-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/29/database-advanced-sql/" class="post-title-link" itemprop="url">Dtabase - Advanced SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-29 21:35:25" itemprop="dateCreated datePublished" datetime="2022-04-29T21:35:25+00:00">2022-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Advanced-SQL"><a href="#Advanced-SQL" class="headerlink" title="Advanced SQL"></a>Advanced SQL</h1><h2 id="Access-DB-From-PL"><a href="#Access-DB-From-PL" class="headerlink" title="Access DB From PL"></a>Access DB From PL</h2><p>通过 <code>编程语言 (Programming Language)</code> <code>访问</code> <code>数据库</code> 的方式：</p>
<ul>
<li><p><code>动态SQL</code>：使用 <code>数据库API</code> 来连接 <code>数据库</code></p>
<ul>
<li>JDBC</li>
<li>ODBC</li>
<li>ADO.NET</li>
</ul>
</li>
<li><p><code>嵌入式SQL</code>：可以将 <code>SQL语句</code> 嵌入到 <code>宿主语言</code> 中，通过 <code>预处理器</code> 对 <code>嵌入宿主语言的SQL</code> 进行 <code>转化</code>。</p>
</li>
</ul>
<hr>
<p>这里简单地讨论几点 <code>JDBC</code> 的内容。</p>
<ul>
<li><p>主要涉及的对象：<code>Connection</code>，<code>Statement</code>，<code>ResultSet</code></p>
</li>
<li><p><code>JDBC</code> 并不是仅仅支持 <code>MySQL</code> 的，它可以 <code>指定</code> 用于 <code>建立数据库连接</code> 的 <code>数据库通信的API</code>：如 <code>jdbc:mysql</code>，<code>jdbc:oracle</code> 等来连接 <code>多种类型的数据库</code></p>
<blockquote>
<p>更准确地说，<code>JDBC</code> 仅 <code>指定通信所用的API</code>，而不是 <code>指定通信所用的协议</code>。因为一个<code>JDBC驱动器</code> 可能同时支持 <code>多种数据库通信协议</code></p>
</blockquote>
</li>
<li><p><code>Statement</code> 并不是 <code>SQL语句对象</code>本身，但可以用 <code>Statement</code> 来 <code>执行语句</code></p>
</li>
<li><p>使用 <code>PreparedStatement</code> 而不是 <code>拼接字符串的方式</code> 来 <code>构造SQL语句</code>！</p>
</li>
<li><p><code>数据库</code> 返回的 <code>ResultSet</code> 不仅仅包含 <code>元组数据</code>，还包含许多 <code>元数据</code>。在需要时使用 <code>ResultSet#getMetaData</code> 获得 <code>元数据</code>，而不是 <code>硬编码</code> 它们！</p>
</li>
<li><p>对 <code>Updatable Result Set</code> 的 <code>修改性操作</code> 会 <code>反映到数据库</code></p>
</li>
<li><p>如果需要将 <code>接下来的多条SQL语句作为事务</code>，而不是 <code>每条语句都被视为独立的事务</code>，则请用 <code>Connection#setAutoCommit(false)</code></p>
</li>
</ul>
<h2 id="Function-and-Procedure"><a href="#Function-and-Procedure" class="headerlink" title="Function and Procedure"></a>Function and Procedure</h2><p><code>函数 (Function)</code> 和 <code>过程 (Procedure)</code> 允许 <code>业务逻辑</code> 作为 <code>存储过程</code> 记录在 <code>数据中</code>。</p>
<p>这使得 <code>业务逻辑代码</code> 是 <code>编程语言独立</code> 和 <code>应用独立</code> 的。</p>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><ul>
<li>一个简单的 <code>函数</code> 的例子</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dept_count(dept_name <span class="type">varchar</span>(<span class="number">20</span>)) <span class="keyword">RETURNS</span> <span class="type">integer</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> d_count <span class="type">integer</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> d_count</span><br><span class="line">    <span class="keyword">FROM</span> instructor</span><br><span class="line">    <span class="keyword">WHERE</span> instructor.dept_name <span class="operator">=</span> dept_name</span><br><span class="line">    <span class="keyword">RETURN</span> d_count</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>带参数的视图 (Parameterized View)</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> instructor_of(dept_name <span class="type">varchar</span>(<span class="number">20</span>)) <span class="keyword">RETURNS</span> <span class="keyword">TABLE</span>(ID <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">                                                                  name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">                                                                  dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">                                                                  salary <span class="type">numeric</span>(<span class="number">8</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">RETURN</span> <span class="keyword">TABLE</span>(<span class="keyword">SELECT</span> ID, name, dept_name, salary</span><br><span class="line">             <span class="keyword">FROM</span> instructor</span><br><span class="line">             <span class="keyword">WHERE</span> instructor.dept_name <span class="operator">=</span> instructor_of.dept_name</span><br><span class="line">            );                                                                 </span><br></pre></td></tr></table></figure>

<p>我们将 <code>这种函数</code> 视为 <code>广义上的视图</code>。</p>
<h3 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h3><blockquote>
<p>对于 <code>函数 (Function)</code> 和 <code>过程 (Procedure)</code> 如果做 <code>详细区分</code>，则我们这样定义：</p>
<ul>
<li>函数：带有 <code>返回值</code></li>
<li>过程：不带有 <code>返回值</code></li>
</ul>
<p>从 <code>组成体系结构</code> 的角度看，<code>过程</code> 是比 <code>函数</code> 更加 <code>底层的概念</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dept_count_proc(<span class="keyword">IN</span> dept_name <span class="type">varchar</span>(<span class="number">20</span>), <span class="keyword">OUT</span> d_count <span class="type">integer</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> d_count</span><br><span class="line">    <span class="keyword">FROM</span> instructor</span><br><span class="line">    <span class="keyword">WHERE</span> instructor.dept_name <span class="operator">=</span> dept_count_proc.dept_name</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>IN</code> 表示 <code>输入参数</code>，而 <code>OUT 表示输出参数</code>。</p>
<p>这种形式的 <code>传参方式</code> 在某些 <code>底层接口调用</code> 中常见。其中 <code>OUT</code> 经常传递的是 <code>指针类型</code>，以便 <code>调用者</code> 可以通过 <code>变量</code> 来 <code>接收</code> 到 <code>过程的结果</code></p>
</blockquote>
<h3 id="Persistent-Storage-Module"><a href="#Persistent-Storage-Module" class="headerlink" title="Persistent Storage Module"></a>Persistent Storage Module</h3><p><code>持久存储模块 (Persistent Storage Module)</code> ：用于处理 <code>构造</code></p>
<p>这里不详细讨论 <code>PSM</code> 的 <code>语法</code>，只给出一个 <code>大号的例子</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> out_of_classroom_seats <span class="keyword">CONDITION</span></span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> out_of_classroom_seats</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">sequence <span class="keyword">of</span> statements</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> registerStudnet(</span><br><span class="line">    <span class="keyword">IN</span> s_id <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">    <span class="keyword">IN</span> s_courseid <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    <span class="keyword">IN</span> s_secid <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    <span class="keyword">IN</span> s_semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line">    <span class="keyword">IN</span> s_year <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line">    <span class="keyword">OUT</span> errorMsg <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">integer</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> currEnrol <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> currEnrol</span><br><span class="line">    <span class="keyword">FROM</span> takes</span><br><span class="line">    <span class="keyword">WHERE</span> course_id <span class="operator">=</span> s_courseid <span class="keyword">AND</span> sec_id <span class="operator">=</span> s_secid</span><br><span class="line">    <span class="keyword">AND</span> semester <span class="operator">=</span> s_semester <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> s_year;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> limit <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> capacity <span class="keyword">INTO</span> limit</span><br><span class="line">    <span class="keyword">FROM</span> capacity <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> section</span><br><span class="line">    <span class="keyword">WHERE</span> course_id <span class="operator">=</span> s_courseid <span class="keyword">AND</span> sec_id <span class="operator">=</span> s_secid</span><br><span class="line">    <span class="keyword">AND</span> semester <span class="operator">=</span> s_semester <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> s_year;</span><br><span class="line">    </span><br><span class="line">    IF (currEnrol <span class="operator">&lt;</span> limit) </span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> takes <span class="keyword">VALUES</span> (s_id, s_courseid, s_secid, s_semester, s_year, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">RETURN</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    <span class="comment">-- capacity overflow !</span></span><br><span class="line">    <span class="keyword">SET</span> errorMsg <span class="operator">=</span> <span class="string">&#x27;Enrollment limit reached for course&#x27;</span>  s_courseid  <span class="string">&#x27;section&#x27;</span>  s_secid;</span><br><span class="line">    <span class="keyword">RETURN</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">END</span>    </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="External-Language-Procedure"><a href="#External-Language-Procedure" class="headerlink" title="External Language Procedure"></a>External Language Procedure</h3><p><code>数据库</code> 可以将 <code>过程</code> 委托给 <code>外部语言程序</code> 来执行，像这样的 <code>过程</code> 称作 <code>外部语言过程</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dept_count_proc(<span class="keyword">IN</span> dept_name <span class="type">varchar</span>(<span class="number">20</span>), <span class="keyword">OUT</span> count <span class="type">integer</span>)</span><br><span class="line"><span class="keyword">LANGUAGE</span> C</span><br><span class="line"><span class="keyword">EXTERNAL</span> NAME <span class="string">&#x27;/usr/avi/bin/dept_course_proc&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果为了 <code>性能</code> 而将 <code>任务</code> 委托给 <code>C</code> 这样的语言，可能会导致 <code>安全问题</code>。</p>
<p>而如果委托给 <code>Java</code>，<code>C#</code> 这样的语言，通过 <code>进程间通信</code> 和 <code>沙盒执行</code> 则会导致 <code>效率低下</code>。</p>
<p>此外，编写能 <code>正确处理</code> <code>数据库数据</code> 的 <code>外部例程</code> 的 <code>编码量</code> 通常较多。</p>
</blockquote>
<h2 id="Trigger"><a href="#Trigger" class="headerlink" title="Trigger"></a>Trigger</h2><p><code>触发器 (Trigger)</code>：用于在 <code>数据库</code> 发生 <code>指定事件</code> 时，<code>自动</code> 被 <code>执行的语句</code></p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> credits_earned AFTER <span class="keyword">UPDATE</span> <span class="keyword">OF</span> takes <span class="keyword">ON</span>(grade)</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> nrow</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">OLD</span> <span class="type">ROW</span> <span class="keyword">AS</span> orow</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">WHEN</span> nrow.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">AND</span> nrow.grade <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">AND</span> (orow.grade <span class="operator">=</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">OR</span> orow.grade <span class="keyword">IS</span> <span class="keyword">NULL</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line"><span class="keyword">UPDATE</span> student</span><br><span class="line"><span class="keyword">SET</span> tot_cred <span class="operator">=</span> tot_cred <span class="operator">+</span> </span><br><span class="line">            (<span class="keyword">SELECT</span> credits</span><br><span class="line">            <span class="keyword">FROM</span> course</span><br><span class="line">            <span class="keyword">WHERE</span> course.course_id <span class="operator">=</span> nrow.course_id)</span><br><span class="line">    <span class="keyword">WHERE</span> student.id <span class="operator">=</span> nrow.id;</span><br><span class="line">    <span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>触发器类型</code>：</p>
<ul>
<li><code>语句级触发器 (FOR EACH STATEMENT)</code>：对于 <code>引起修改的整个SQL语句</code> <code>仅执行1次</code> <code>触发器</code></li>
<li><code>行级触发器 (FOR EACH ROW)</code>：对 <code>每个受影响的行</code> <code>都执行1次</code> <code>触发器</code></li>
</ul>
<p><code>过渡变量 (Transition Variable)</code>：</p>
<ul>
<li><code>REFERENCING OLD ROW AS symbol</code>：存储 <code>已经更新或删除的行的旧值</code></li>
<li><code>REFERENCING NEW ROW AS symbol</code>：可用于 <code>插入</code> 或 <code>删除</code> 的 <code>行的引用</code></li>
</ul>
<p><code>触发时机</code>：</p>
<ul>
<li><code>BEFORE</code>：用于 <code>避免非法更新</code>，<code>附加额外约束</code></li>
<li><code>AFTER</code>：用于 <code>为某些修改做善后处理</code>，<code>维护某些修改性操作的合法性</code></li>
</ul>
</blockquote>
<p>如果可以使用 <code>存储过程</code> 的话，则尽量不要使用 <code>触发器</code>。</p>
<h2 id="Recursive-Query"><a href="#Recursive-Query" class="headerlink" title="Recursive Query"></a>Recursive Query</h2><p><code>递归查询 (Recursive Query)</code> 的典型例子是寻找 <code>传递闭包 (Transitive Closure)</code> ，比如 <code>找出某个课程的所有前置课程</code>。</p>
<hr>
<p>寻找 <code>传递闭包</code></p>
<h3 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> findAllPrereqs(cid <span class="type">varchar</span>(<span class="number">8</span>))</span><br><span class="line"><span class="keyword">RETURN</span> <span class="keyword">TABLE</span>(course_id <span class="type">varchar</span>(<span class="number">8</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">-- define variables</span></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> c_prereq(course_id <span class="type">varchar</span>(<span class="number">8</span>));</span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> new_c_prereq(course_id <span class="type">varchar</span>(<span class="number">8</span>));</span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> temp(course_id <span class="type">varchar</span>(<span class="number">8</span>));</span><br><span class="line"><span class="comment">-- init and continue</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> new_c_prereq</span><br><span class="line"><span class="keyword">SELECT</span> prereq_id</span><br><span class="line"><span class="keyword">FROM</span> prereq</span><br><span class="line"><span class="keyword">WHERE</span> course_id <span class="operator">=</span> cid;</span><br><span class="line"><span class="comment">-- loop until not new course is added</span></span><br><span class="line">REPEAT</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> c_prereq</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INTO</span> temp</span><br><span class="line"><span class="keyword">FROM</span> new_c_prereq;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> temp</span><br><span class="line">(<span class="keyword">SELECT</span> prereq.course_id</span><br><span class="line">            <span class="keyword">FROM</span> new_C_prereq, prereq</span><br><span class="line">            <span class="keyword">WHERE</span> new_c_prereq.course_id <span class="operator">=</span> prereq.course_id)</span><br><span class="line">            <span class="keyword">EXCEPT</span></span><br><span class="line">            (<span class="keyword">SELECT</span> course_id</span><br><span class="line">            <span class="keyword">FROM</span> c_prereq);</span><br><span class="line">        <span class="keyword">DELETE</span> <span class="keyword">FROM</span> new_c_prereq;</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> new_c_prereq</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> temp;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> temp;</span><br><span class="line">UNTIL <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> new_c_prereq)</span><br><span class="line"><span class="keyword">END</span> REPEAT</span><br><span class="line"><span class="comment">-- return the result table</span></span><br><span class="line">    <span class="keyword">RETURN</span> <span class="keyword">TABLE</span> c_prereq;</span><br><span class="line"><span class="keyword">END</span> </span><br></pre></td></tr></table></figure>

<h3 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- define recursive query</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> rec_prereq(course_id, prereq_id) <span class="keyword">AS</span> (<span class="keyword">SELECT</span> course_id, prereq_id</span><br><span class="line">                                                   <span class="keyword">FROM</span> prereq)</span><br><span class="line">                                                   <span class="keyword">UNION</span> </span><br><span class="line">                                                   (<span class="keyword">SELECT</span> rec_prereq, course_id, prereq.prereq_id</span><br><span class="line">                                                   <span class="keyword">FROM</span> prereq, rec_prereq</span><br><span class="line">                                                   <span class="keyword">WHERE</span> prereq.course_id <span class="operator">=</span> rec_prereq.prereq_id)</span><br><span class="line"><span class="comment">-- call recursive query</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> rec_prereq;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述的SQL中，首先通过 <code>基查询</code> 找到 <code>每门课程的先修课程</code>，然后 <code>递归查询</code> 在 <code>每次迭代过程</code> 中 <code>增加一层课程</code>，直到到达 <code>课程-先修课程的最大层次</code>。</p>
</blockquote>
<blockquote>
<p>通过 <code>FROM子句</code> 对 <code>递归视图 prc_prereq</code> 进行 <code>递归查询</code>。</p>
<p><code>WITH RECURSIVE</code> 用于声明 <code>递归视图</code>，它会使得 <code>递归</code> 在到达 <code>不动点</code> 时 <code>自动被终止</code></p>
</blockquote>
<blockquote>
<p><code>SQL标准</code> 要求 <code>递归过程</code> 返回的 <code>结果</code> 是 <code>单调递增的</code>，并且最终到达 <code>不动点 (Fixed Point)</code></p>
<blockquote>
<p>也就是说，每次 <code>递归过程</code> 返回的 <code>结果</code> 必须是 <code>之前的结果的超集</code></p>
</blockquote>
<blockquote>
<p>只要 <code>递归过程是递增的</code>，就可以使用 <code>迭代过程来定义递归过程</code>。</p>
</blockquote>
</blockquote>
<p>任何的 <code>递归查询 (Recursive Query)</code> &#x3D; <code>基查询 (Base Query)</code> UNION <code>递归查询 (Recursive Query)</code></p>
<h2 id="Advanced-Aggregate"><a href="#Advanced-Aggregate" class="headerlink" title="Advanced Aggregate"></a>Advanced Aggregate</h2><h3 id="Rank"><a href="#Rank" class="headerlink" title="Rank"></a>Rank</h3><h4 id="Sparse-Rank-amp-Dense-Rank"><a href="#Sparse-Rank-amp-Dense-Rank" class="headerlink" title="Sparse Rank &amp; Dense Rank"></a>Sparse Rank &amp; Dense Rank</h4><ul>
<li><code>rank()</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 1</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">rank</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> (GPA) <span class="keyword">DESC</span>) <span class="keyword">AS</span> s_rank</span><br><span class="line"><span class="keyword">FROM</span> student_grades</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">&#x27;s_rank&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>单纯的 <code>rank</code> 并不会对 <code>结果关系中的元组</code> <code>按rank进行排序</code>。</p>
<p>故添加 <code>ORDER BY &#39;s_rank&#39;</code> 来对 <code>结果关系的元组</code> 进行 <code>排序</code></p>
</blockquote>
<blockquote>
<p>其他类型的 <code>排序函数</code>：<code>percent_rank()</code>，<code>cume_dist()</code>，<code>row_number()</code></p>
</blockquote>
<blockquote>
<p>关于 <code>空值</code> 的处理，可以设置策略：<code>NULL FIRST</code> 或 <code>NULL LAST</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">rank</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> (GPA) <span class="keyword">DESC</span> <span class="keyword">NULL</span> <span class="keyword">LAST</span>) <span class="keyword">AS</span> s_rank</span><br><span class="line"><span class="keyword">FROM</span> student_grades</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">&#x27;s_rank&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>SQL 1 &#x3D; SQL 2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 2</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, (<span class="number">1</span> <span class="operator">+</span> (<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">                <span class="keyword">FROM</span> student_grades B</span><br><span class="line">                <span class="keyword">WHERE</span> B.GPA <span class="operator">&gt;</span> A.GPA)) <span class="keyword">AS</span> s_rank</span><br><span class="line"><span class="keyword">FROM</span> student_grades A</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> s_rank</span><br></pre></td></tr></table></figure>

<ul>
<li><code>dense_rank()</code></li>
</ul>
<p><code>rank()</code> 产生的 <code>排名</code> 是 <code>间断的</code>：如果 <code>分数最高的人</code> 有2人，则 <code>这两个人的排名</code> 均为 <code>1</code>，但 <code>分数次高的人</code> 的 <code>排名</code> 则为 <code>3</code></p>
<p>相反的，如果使用 <code>dense_rank()</code>，则产生 <code>不间断</code> 的 <code>排名</code>：<code>分数最高的两人</code> 排名均为 <code>1</code>，但 <code>分数次高的人</code> 的 <code>排名</code> 则为 <code>2</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 3</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">dense_rank</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> (GPA) <span class="keyword">DESC</span>) <span class="keyword">AS</span> s_rank</span><br><span class="line"><span class="keyword">FROM</span> student_grades</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">&#x27;s_rank&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Partition-before-Rank"><a href="#Partition-before-Rank" class="headerlink" title="Partition before Rank"></a>Partition before Rank</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 4</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, dept_name, <span class="built_in">rank</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> dept_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> GPA <span class="keyword">DESC</span>) <span class="keyword">AS</span> DEPT_RANK</span><br><span class="line"><span class="keyword">FROM</span> dept_grades</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_name, dept_rank;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当存在 <code>GROUP BY</code> 时， <code>PARTION</code> 在 <code>GROUP BY</code> 之后执行。</p>
</blockquote>
<blockquote>
<p>可以认为，如果在 <code>聚集</code> 时没有 <code>显示地指定 PARTITION</code>，则认为 <code>将所有的集合</code> 分为 <code>唯一的一个分区</code></p>
</blockquote>
<h4 id="Grading"><a href="#Grading" class="headerlink" title="Grading"></a>Grading</h4><p><code>ntile(n)</code> 按 <code>给定顺序</code> 取得 <code>每个分区 (Partion) 中的元组</code>，然后将 <code>元组</code> 分成 <code>n个具有相同元组数目的桶</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">ntile</span>(<span class="number">4</span>) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> (GPA <span class="keyword">DESC</span>)) <span class="keyword">AS</span> quartile</span><br><span class="line"><span class="keyword">FROM</span> student_grades;</span><br></pre></td></tr></table></figure>

<p>可用于构造 <code>百分比直方图</code></p>
<h3 id="Window-Query"><a href="#Window-Query" class="headerlink" title="Window Query"></a>Window Query</h3><p><code>窗口查询</code>：可用于对 <code>一定范围内的元组</code> 进行 <code>聚集</code></p>
<blockquote>
<p>不同于 <code>分区查询</code> 中的 <code>1个元组</code> 只对 <code>1个分区 (Partion)</code> 有贡献，<code>分窗查询</code> 中的 <code>窗口 (Window)</code> 是可以 <code>重叠的</code>。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="built_in">avg</span>(num_credits) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span> <span class="keyword">ROWS</span> <span class="number">3</span> PRECEDING) <span class="keyword">AS</span> avg_total_credits</span><br><span class="line"><span class="keyword">FROM</span> tot_credits;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 如果 <code>某个年份的元组</code> 具有 <code>多个</code>，则 <code>为某个年份到底选择哪个元组</code> 将 <code>取决于具体实现</code>。</p>
</blockquote>
<blockquote>
<p><code>窗口</code> 的大小界定参数：</p>
<ul>
<li><code>ROWS n PRECEDING/FOLLOWING</code></li>
<li><code>ROWS UNBOUNDED PRECEDING/FOLLOWING</code></li>
<li><code>ROWS BETWEEN a PRECEEDING AND b FOLLOWING</code></li>
<li><code>RANGE BETWEEN a AND b</code></li>
</ul>
</blockquote>
<h2 id="OLAP"><a href="#OLAP" class="headerlink" title="OLAP"></a>OLAP</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p><code>联机分析处理 (OLAP)</code> 是一个 <code>交互式系统</code>，允许 <code>分析人员</code> 查看 <code>多维数据</code> 的 <code>不同种类的汇总数据</code></p>
<hr>
<p>假如我们有 <code>模式</code> sales(item\_name, color, clothes\_size, quantity)</p>
<p>可以对 <code>关系中的某些属性</code> <code>分组 (Group)</code> 为 <code>度量属性</code> 和 <code>维属性</code>：</p>
<ul>
<li><code>度量属性 (Measure Attribute)</code>：对 <code>某个值</code> 进行 <code>度量</code>，并且可以对 <code>这个值</code> 进行 <code>聚集操作</code></li>
<li><code>维属性 (Dimension Attribute)</code>：<code>剩余的属性</code> 称为 <code>维属性</code></li>
</ul>
<p>能够 <code>模式化</code> 为 <code>度量属性</code> 和 <code>维属性</code> 的 <code>数据</code> 统称为 <code>多维数据 (Multi-Dimensional Data)</code></p>
<hr>
<p><code>数据立方体 (Data Cube)</code>：可以用于描述 <code>n维数据</code>。</p>
<blockquote>
<p><code>交叉表 (Cross-Tabulation / Pivot Table)</code>：可以用于描述 <code>二维属性</code>，是 <code>数据立方体</code> 的 <code>2维情形</code></p>
<p>某些 <code>交叉表</code> 可能还含有 <code>汇总行 (Total Row)</code> 和 <code>汇总列 (Total Column)</code></p>
</blockquote>
<p><code>单元 (Cell)</code>：<code>n维的数据单元</code> 可用 <code>n维向量</code> 进行 <code>定位</code>，每个 <code>单元</code> 存储 <code>1个值</code></p>
<blockquote>
<p>当 <code>某个维度</code> 的 <code>取值</code> 为 <code>all</code> 时，则表示 <code>对该维度的数据进行聚集</code>，即 <code>对该维度进行压缩</code>！</p>
<p>如 <code>clothes_size</code> 的 <code>all值</code> 是对 ：<code>small</code>，<code>medium</code> 和 <code>large</code> 进行 <code>聚集</code> 得到的。</p>
</blockquote>
<hr>
<ul>
<li>Select <code>attribute_list</code></li>
</ul>
<p><code>转轴 (Pivot)</code>：改变 <code>交叉表</code> 中 <code>维</code> 的操作</p>
<p><code>切片 (Slice) / 切块 (Dicing)</code>：<code>固定</code> <code>某个维度</code>，<code>观察</code> <code>其余的维度</code></p>
<blockquote>
<p>一般将 <code>切片</code> 用于 <code>固定1个维度</code>时，<code>切块</code> 用于 <code>固定多个维度</code> 时。</p>
</blockquote>
<ul>
<li>Change <code>observation granularity</code></li>
</ul>
<p><code>上卷 (RollUp)</code> ：即 <code>粒度变粗</code></p>
<p><code>下钻 (Drill Down)</code>：即 <code>粒度变细</code></p>
<blockquote>
<p><code>较粗粒度的数据</code> 可以由 <code>较细粒度的数据</code> 所产生，反之则不能。</p>
<p>即 <code>高维数据</code> 可以产生 <code>低维数据</code>，反之不能。</p>
</blockquote>
<p>一个 <code>属性</code> 可以有不同的 <code>粒度</code>，这些 <code>不同粒度</code> 组成 <code>层次结构</code>，如 <code>Datetime的层次结构</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">date_time(DateTime) --&gt; hour_of_day(Hour of Day)</span><br><span class="line">date_time --&gt; date(Date)</span><br><span class="line">date --&gt; day_of_week(Day of Week)</span><br><span class="line">date --&gt; month(Month)</span><br><span class="line">month --&gt; quarter(Quarter)</span><br><span class="line">quarter --&gt; year(Year)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当我们讨论 <code>属性的粒度</code> 时， 我们应当把 <code>粒度树</code> <code>倒过来看</code>，这样正好符合 <code>上卷</code> 和 <code>下钻</code>。</p>
<blockquote>
<p>计算机的 <code>树</code> 就是 <code>倒过来的自然界的树</code>，而 <code>粒度树</code> 是 <code>倒过来的树</code>，也就正好符合 <code>自然界的树</code>。</p>
</blockquote>
</blockquote>
<h3 id="OLAP-in-SQL"><a href="#OLAP-in-SQL" class="headerlink" title="OLAP in SQL"></a>OLAP in SQL</h3><p><code>模式</code> sales(item\_name, color, clothes\_size, quantity)</p>
<ul>
<li><code>pivot()</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line">pivot(</span><br><span class="line"><span class="built_in">sum</span>(quantity)</span><br><span class="line">    <span class="keyword">FOR</span> color <span class="keyword">IN</span> (<span class="string">&#x27;dark&#x27;</span>, <span class="string">&#x27;pastel&#x27;</span>, <span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>pivot中的for</code> 的 <code>语义</code> 是：<code>解包</code> <code>指定属性的指定值</code> ，将 <code>这些值</code> 作为 <code>新属性</code> 插入。</p>
</blockquote>
<p>item_name</p>
<p>clothes_size</p>
<p>dark</p>
<p>pastel</p>
<p>white</p>
<p>skirt</p>
<p>small</p>
<p>2</p>
<p>11</p>
<p>2</p>
<p>…</p>
<p>…</p>
<p>…</p>
<p>…</p>
<p>…</p>
<ul>
<li><code>cube()</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> item_name, color, clothes_size, <span class="built_in">sum</span>(quantity)</span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">cube</span>(item_name, color, clothes_size)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果需要处理 <code>all值</code>，则可以使用 <code>decode()</code> 和 <code>grouping()</code>。</p>
</blockquote>
<p>该查询返回的是一个 <code>关系</code> (item\_name, color, clothes\_size, quantity)</p>
<p>该关系表示1个 <code>3维的数据立方体</code></p>
<ul>
<li><code>rollup()</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> item_name, color, clothes_size, <span class="built_in">sum</span>(quantity)</span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">rollup</span>(item_name, color, clothes_size)</span><br></pre></td></tr></table></figure>

<p>从 <code>返回的结果关系的模式</code> 来看，<code>rollup()</code> 和 <code>cube()</code> 返回的 <code>结果关系</code> 具有 <code>相同的模式</code>。</p>
<p>实际上，<code>rollup()</code> 生成的是：1个 <code>0维立方体</code>，1个 <code>1维立方体</code>，1个 <code>2维立方体</code>， 1个 <code>3维立方体</code></p>
<blockquote>
<p>无论是用 <code>cube()</code> 还是 <code>rollup()</code>，我们都无法 <code>精准控制分组的产生</code>，即无法 <code>精准指定分组具有哪些属性</code>。</p>
<p>但我们可以通过 <code>HAVING子句</code> 来去除 <code>GROUP子句</code> 产生的 <code>我们不想要的分组</code></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/29/database-intermediate-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/29/database-intermediate-sql/" class="post-title-link" itemprop="url">Database - Intermediate SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-29 16:39:10" itemprop="dateCreated datePublished" datetime="2022-04-29T16:39:10+00:00">2022-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Intermediate-SQL"><a href="#Intermediate-SQL" class="headerlink" title="Intermediate SQL"></a>Intermediate SQL</h1><h2 id="Join-Expression"><a href="#Join-Expression" class="headerlink" title="Join Expression"></a>Join Expression</h2><h3 id="Join-Condition"><a href="#Join-Condition" class="headerlink" title="Join Condition"></a>Join Condition</h3><h4 id="natural"><a href="#natural" class="headerlink" title="natural"></a>natural</h4><p>使用 <code>natural</code> 作为 <code>连接条件</code> 的 <code>连接 (Join)</code> 称为 <code>自然连接 (Natural Join)</code>。</p>
<blockquote>
<p>我们前面讨论过，可以将 <code>natura</code>展开为 <code>using attribute_list</code> 展开为 <code>on &lt;predicate&gt;</code></p>
</blockquote>
<h4 id="using-attribute-list"><a href="#using-attribute-list" class="headerlink" title="using attribute_list"></a>using attribute_list</h4><p>指定对 <code>参与连接的关系</code> 进行 <code>连接</code> 时所使用的 <code>属性列表 (Attribute List)</code></p>
<h4 id="on"><a href="#on" class="headerlink" title="on "></a>on <Predicate></h4><p><code>on条件</code> 用于设置 <code>参与连接的关系</code> 的 <code>元组匹配</code> 的 <code>通用谓词</code></p>
<blockquote>
<p>从 <code>功能范围</code> 来讲：<code>on &lt;Predicate&gt;</code> &gt; <code>using attribute_list</code> &gt; <code>natural</code></p>
</blockquote>
<hr>
<p>我们考虑下面两个连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">JOIN</span> takes <span class="keyword">ON</span> student.ID <span class="operator">=</span> takes.ID</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> takes</span><br></pre></td></tr></table></figure>

<p><code>SQL1</code> \ne <code>SQL 2</code> ，但它们的 <code>结果关系</code> 高度 <code>相似</code>，<code>唯一的区别</code> 是：<code>SQL 1</code> 的 <code>结果关系</code> 中， <code>ID属性</code> 出现 <code>2次</code>，分别为 <code>student.ID</code> 和 <code>takes.ID</code></p>
<blockquote>
<p>注意 <code>on &lt;predicate&gt;</code> 的 <code>语义</code>：<code>&lt;predicate&gt;</code> <code>过滤出</code> <code>能参与连接的元组</code>。</p>
<p>注意 <code>join</code> 的语义：最基本的 <code>连接 (Join)</code> 操作就是 <code>简单地</code> <code>将两个元组</code> 进行 <code>拼接</code>。</p>
<blockquote>
<p><code>自动去除相同的属性名</code> 是 <code>natural join</code> 的 <code>特性</code>，<code>join</code> 并不会这么做！</p>
</blockquote>
</blockquote>
<p>然而，对于 <code>SQL 2</code>来说，由于 <code>student关系</code> 和 <code>takes关系</code> 的 <code>共有属性</code> 仅有 <code>ID</code>，所以 <code>连接条件</code> 也是 <code>student.ID = takes.ID</code>。</p>
<p>但 <code>Natural Join</code> 会 <code>自动地去除属性名相同的列</code>，所以 <code>ID属性</code> 仅在 <code>SQL 2的结果关系</code> 中 <code>出现1次</code></p>
<p>更确切地</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 3 equals SQL 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student, takes</span><br><span class="line"><span class="keyword">WHERE</span> student.ID <span class="operator">=</span> takes.ID</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 4 equals SQL 2</span></span><br><span class="line"><span class="keyword">SELECT</span> student.ID <span class="keyword">as</span> ID, name, dept_name, tot_cred, course_id, sec_id, semester, <span class="keyword">year</span>, grade</span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">JOIN</span> takes <span class="keyword">ON</span> student.ID <span class="operator">=</span> takes.ID</span><br></pre></td></tr></table></figure>

<h3 id="Join-Type"><a href="#Join-Type" class="headerlink" title="Join Type"></a>Join Type</h3><h4 id="Inner-Join"><a href="#Inner-Join" class="headerlink" title="Inner Join"></a>Inner Join</h4><p><code>内连接 (Inner Join)</code> 是 <code>默认的连接类型</code>。</p>
<blockquote>
<p>当我们写 <code>JOIN</code> 时，实际上是省略了 <code>INNER</code> 的 <code>INNER JOIN</code>。</p>
<p>同理，<code>NATURAL JOIN</code> &#x3D; <code>NATURAL INNER JOIN</code></p>
</blockquote>
<h4 id="Outer-Join"><a href="#Outer-Join" class="headerlink" title="Outer Join"></a>Outer Join</h4><p>考虑该语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> takes;</span><br></pre></td></tr></table></figure>

<p>该 <code>语句</code> 的 <code>期望</code> 是： <code>查询出所有学生的选课信息</code></p>
<p>但是，如果 <code>某些学生没有选任何课</code>，那么在 <code>结果关系</code> 中，我们将无法看到 <code>这些学生</code>。</p>
<p>如果我们 <code>希望</code> 在 <code>结果关系</code> 中，<code>仍然显示出</code> <code>没有选任何课的学生</code> 的信息，并且 <code>将它们的选课信息</code> 显示为 <code>null</code>。</p>
<p>则可以使用 <code>外连接</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">NATURAL</span> <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> takes;</span><br></pre></td></tr></table></figure>

<hr>
<p><code>外连接 (Outer Join)</code>：在 <code>内连接</code> 的基础上，通过在 <code>结果关系</code> 中 <code>创建包含空值的元组</code> 来 <code>保留</code> <code>哪些本来在内连接中丢失的元组</code></p>
<blockquote>
<p>换句话说：<code>外连接</code> 会将 <code>那些有参与连接</code> 但 <code>不满足连接条件的元组</code> 的 <code>那些本该被内连接丢弃的元组</code> 重新 <code>捡回来</code>，然后 <code>填充空值</code>。</p>
<p>注意一个细节，我们说 <code>参与连接的元组</code> 指的是按照所属的 <code>连接表达式</code> 作为 <code>边界</code> 来划分的。<code>另一个连接表达式</code> 和 <code>WHERE子句</code> 显然都属于 <code>边界之外</code>。</p>
<p><code>外连接</code> 只会 <code>捡回那些参与了连接但不满足连接条件的元组，并为它们填充空值</code>。如果 <code>某些元组根本没有参与这个外连接</code>，那么 <code>显然这些元组不应该被这个外连接所捡回并填充空值</code>。</p>
</blockquote>
<p><code>外连接</code> 的 3种 <code>类型</code>：</p>
<ul>
<li><code>左外连接 (Left Outer Join)</code>：只 <code>保留</code> 出现在 <code>左外连接运算符</code> <code>左边的关系中的元组</code></li>
<li><code>右外连接 (Right Outer Join)</code>：只 <code>保留</code> 出现在 <code>右外连接运算符</code> <code>右边的关系中的元组</code></li>
<li><code>全外连接 (Full Outer Join)</code>：<code>保留</code> <code>两个关系中的元组</code></li>
</ul>
<blockquote>
<p>相比来说，<code>内连接</code> 不 <code>保留</code> <code>两侧的关系中的任何关系中的元组</code></p>
</blockquote>
<blockquote>
<p><code>外连接的计算方法</code>：可以先计算 <code>相应的内连接</code>，然后向 <code>内连接的结果关系</code> 中 <code>加入</code> <code>应当被保留的元组</code></p>
</blockquote>
<hr>
<p>考虑该查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> takes <span class="keyword">ON</span> student.ID <span class="operator">=</span> takes.ID;</span><br></pre></td></tr></table></figure>

<p><code>SQL 1</code> \ne <code>SQL 2</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> takes <span class="keyword">ON</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">WHERE</span> student.ID <span class="operator">=</span> takes.ID;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>SQL 1</code>：<code>结果关系</code> 类似于 <code>student LEFT NATURAL OUTER JOIN takes</code> ，只不过 <code>ID属性将出现2次</code>。</p>
</li>
<li><p><code>SQL 2</code>：由于指定 <code>ON true</code> 使得 <code>参与连接的关系中的所有元组</code> 都 <code>满足连接条件</code>，所以 <code>外连接</code> 不会 <code>加入被内连接丢弃的元组并为它们填充空值</code></p>
<blockquote>
<p>也就是说 <code>由于没有元组因不满足连接条件而被内连接所丢弃</code>，所以后续 <code>外连接</code> 也不会 <code>加入这些本来被内连接丢弃的元组并为它们填充空值</code></p>
</blockquote>
<p>实际上，<code>a LEFT OUTER JOIN b ON true</code> 相当于 <code>产生两个关系的笛卡尔积</code>。</p>
<blockquote>
<p>不要将 <code>a LEFT OUTER JOIN b ON true</code> 和 <code>NATURAL LEFT OUTER JOIN</code> 弄 <code>混淆</code>，<code>NATURAL</code> 只不过是 <code>连接条件</code> 中的一种而已。</p>
</blockquote>
</li>
</ul>
<h2 id="View"><a href="#View" class="headerlink" title="View"></a>View</h2><h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><p><code>视图 (View)</code>：是一种 <code>通过查询来定义的</code> <code>虚关系 (Virtual Relation)</code>。它在 <code>概念层</code> 包含 <code>查询的结果</code>，但 <code>序关系</code>并不 <code>预先计算并存储</code>，而是在 <code>查询时临时进行计算</code> 而得到。</p>
<blockquote>
<p>该 <code>定义</code> 暂时不考虑 <code>物化视图 (Materialized View)</code></p>
</blockquote>
<h3 id="Create-a-view"><a href="#Create-a-view" class="headerlink" title="Create a view"></a>Create a view</h3><p>所定义的 <code>视图</code> 的 <code>模式</code> 可以从 <code>查询语句</code> 中自动地被 <code>推导</code> 出来</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> faculty <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, name, dept_name</span><br><span class="line"><span class="keyword">FROM</span> instructor;</span><br></pre></td></tr></table></figure>

<p>当然，也可以指定 <code>视图的属性名</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> departments_total_salary(dept_name, total_salary) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, <span class="built_in">sum</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br></pre></td></tr></table></figure>

<h3 id="Materialized-View"><a href="#Materialized-View" class="headerlink" title="Materialized View"></a>Materialized View</h3><p><code>物化视图 (Materialized View)</code>：和 <code>非物化视图</code> 的区别在于，<code>物化视图</code> 会 <code>存储查询的结果关系</code>，并 <code>保证</code> 当 <code>实际关系</code> 更新时，<code>物化视图</code> 也应当有 <code>相应的维护策略</code>。这个过程称为 <code>物化视图的维护 (Materialized View Maintenance)</code></p>
<p><code>物化视图</code> 的 <code>维护策略 (Maintenance Strategy)</code>：</p>
<ul>
<li>立即更新</li>
<li>延迟更新</li>
</ul>
<hr>
<p>我们称 <code>物化视图</code>是 <code>可更新的 (Updatable)</code> ：可以对 <code>该物化视图</code> 进行 <code>修改性操作</code>，且 <code>这些操作可以正确地反映到实关系</code>。</p>
<blockquote>
<p>大部分的 <code>物化视图</code> 都是 <code>不可更新的</code>，仅能用于 <code>查询</code>。</p>
<p>这是因为 <code>单纯从视图定义的查询语句</code> 很难 <code>翻译出等价的且合法的更新语句</code>。</p>
</blockquote>
<p>考虑该 <code>视图定义</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> history_instructors <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;History&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>如果我们 <code>视图</code> 执行 <code>该语句</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> history_instructors</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;25566&#x27;</span>, <span class="string">&#x27;Brown&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="number">100000</span>)</span><br></pre></td></tr></table></figure>

<p>则也 <code>可能</code> 存在 <code>错误</code>，原因在于：<code>欲插入视图中的元组</code> 无法在 <code>视图中被查询出来</code>。即 <code>新值</code> 不满足 <code>视图的WHERE子句</code></p>
<blockquote>
<p><code>SQL</code> 默认允许这种操作。如果希望禁止这种操作，可以在 <code>CREATE VIEW</code> 时添加 <code>WITH CHECK OPTION</code></p>
</blockquote>
<h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><p><code>事务 (Transaction)</code>：由 <code>SQL语句的序列</code> 组成，<code>事务</code> 拥有 <code>ACID性</code></p>
<blockquote>
<p>按照 <code>SQL标准</code>，<code>任何一条单独的SQL语句</code> 都 <code>隐含地</code> <code>开始于一个新事务</code>。</p>
</blockquote>
<blockquote>
<p>从编程角度说，如果为了保证 <code>多条SQL语句的原子性</code>，则需要对 <code>SQL连接驱动</code> 做出相应的设置。</p>
<p>如使用 <code>JDBC</code> 时，首先关闭 <code>单条SQL语句的自动提交</code>。</p>
</blockquote>
<h2 id="Integrity-Constraint"><a href="#Integrity-Constraint" class="headerlink" title="Integrity Constraint"></a>Integrity Constraint</h2><p><code>完整性约束 (Integrity Constraint)</code>：保证 <code>授权用户</code> 对 <code>数据库的修改性操作</code> 不会 <code>破坏</code> <code>数据库</code> 的 <code>数据一致性</code></p>
<p>常见的 <code>完整性约束</code>：</p>
<h3 id="Integrity-Constraint-for-Single-Relation"><a href="#Integrity-Constraint-for-Single-Relation" class="headerlink" title="Integrity Constraint for Single-Relation"></a>Integrity Constraint for Single-Relation</h3><ul>
<li><code>not null约束</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">bugder <span class="type">numeric</span>(<span class="number">12</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p>由于 <code>空值</code> 是 <code>所有的域的成员</code>，所以对于 <code>SQL</code>来说，<code>空值</code> 可以是 <code>任何属性</code> 的 <code>合法值</code>。</p>
<p>如果希望 <code>禁止某个属性的值为空值</code>，则可以设置 <code>not null</code></p>
<ul>
<li><code>unique约束</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNIQUE</span>(attribute_list)</span><br></pre></td></tr></table></figure>

<p><code>unique约束</code> 用于指定 <code>某个属性列表</code> 为 <code>候选码</code>：即在 <code>关系</code> 中，没有 <code>任何两个元组</code> 可以在 <code>作为候选码的属性</code> 上的 <code>取值</code> <code>都相同</code>。</p>
<blockquote>
<p>n.b. <code>候选码属性</code> 可以被设置为 <code>null</code> （除非已经被声明 <code>not null</code>），由于 <code>unique约束</code> 是基于 <code>元组的相等性测试</code> 的，它和 <code>unique结构</code> 对待 <code>null</code> 的方式相同。</p>
</blockquote>
<ul>
<li><code>check子句</code></li>
</ul>
<p>可以为 <code>关系</code> 定义 <code>check(Predicate)</code> ，使得 <code>关系中的所有元组</code> 都必须 <code>满足该谓词</code>。</p>
<blockquote>
<p>可以使用 <code>check</code> 来 <code>代替</code> <code>unique</code>，<code>not null</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> section</span><br><span class="line">(course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line"> sec_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line"> semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line"> <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line"> building <span class="type">varchar</span>(<span class="number">15</span>),</span><br><span class="line"> room_number <span class="type">varchar</span>(<span class="number">7</span>),</span><br><span class="line"> time_slot_id <span class="type">varchar</span>(<span class="number">4</span>),</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (course_id, sec_id, semester, <span class="keyword">year</span>),</span><br><span class="line"> <span class="keyword">CHECK</span>(semester <span class="keyword">IN</span> (<span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;Winter&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Referential-Integrity"><a href="#Referential-Integrity" class="headerlink" title="Referential Integrity"></a>Referential Integrity</h3><h4 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h4><p><code>参照完整性 (Referential Integrity)</code>：在 <code>某个关系的给定属性集上的取值</code> 也 <code>必须出现在</code> <code>另一个关系的特定属性集的取值</code> 。</p>
<blockquote>
<p>若 <code>关系</code> r_1 和 <code>关系</code> r_2 的 <code>属性集</code> 分别为 R_1 和 R_2，<code>主码</code> 分别为 K_1 和 K_2。</p>
<p>若对于 R_2 中的 <code>任何元组</code> t_2 ，都存在 t_1.K_1 &#x3D; t_2.\b\alpha</p>
<p>则我们称：R_2的子集 \alpha 为 <code>参照关系</code> r_1 中 K_1 的 <code>外码 (Foreign Key)</code></p>
<blockquote>
<p>即：我们要求 r_2 中 \alpha 上的 <code>取值集合</code> 必须是 r_1 中 K_1 上的 <code>取值集合</code> 的 <code>子集</code>。</p>
<p>从这个意义上，<code>参照完整性</code> 又被称为 <code>子集依赖 (Subset Dependency)</code></p>
</blockquote>
<blockquote>
<p>不同于 <code>外码约束</code>，<code>参照完整性</code> 并不要求 K_1 是 r_1 的 <code>主码</code></p>
</blockquote>
</blockquote>
<hr>
<h4 id="A-simple-demo"><a href="#A-simple-demo" class="headerlink" title="A simple demo"></a>A simple demo</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> section</span><br><span class="line">(...</span><br><span class="line"> <span class="keyword">FOREIGN</span> KEY(dept_name) <span class="keyword">REFERENCES</span> department</span><br><span class="line"> <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line"> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE</span><br><span class="line"> ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 <code>REFERENCE子句</code> 时，要求 <code>属性列表</code> 必须是 <code>被参照关系的候选码</code>。</p>
<blockquote>
<p>可以通过 <code>PRIMARY KEY</code> 和 <code>UNIQUE</code> 来使得 <code>属性</code> 成为 <code>候选码 (Candidate Key)</code></p>
</blockquote>
</blockquote>
<p>可以为 <code>参照完整性约束</code> 中的 <code>外码</code> 设置 <code>删除策略</code> 和 <code>更新策略</code></p>
<p>常见的几种策略有：</p>
<ul>
<li><code>CASCADE</code></li>
<li><code>SET NULL</code></li>
<li><code>SET DEFAULT</code></li>
</ul>
<hr>
<p>n.b. 对于 <code>元组的外码属性的相等性测试</code> 有 <code>特殊规则</code> ：如果 <code>某个元组的某个外码属性</code> 为 <code>null</code>，则会 <code>被视为满足约束</code>。</p>
<h3 id="Defer-Integrity-Constraint"><a href="#Defer-Integrity-Constraint" class="headerlink" title="Defer Integrity Constraint"></a>Defer Integrity Constraint</h3><p>对于 <code>多步骤的事务</code> 来说，可能在 <code>事务的中间过程</code> <code>暂时性地违反完整性约束</code> ，但在 <code>事务之后的步骤</code> 又 <code>重新符合完整性约束</code>。</p>
<p>此时，可以使用 <code>initially deferred子句</code> 来将 <code>完整性约束检测</code> 从 <code>事务中间步骤</code> <code>推迟到</code> <code>事务结束时</code> 再进行 <code>检测</code></p>
<h3 id="Complex-Check-Constraint"><a href="#Complex-Check-Constraint" class="headerlink" title="Complex Check Constraint"></a>Complex Check Constraint</h3><p>根据 <code>SQL标准</code> 来说，<code>check</code> 中允许定义 <code>任何谓词</code>。</p>
<p>如果 <code>check的谓词</code> 中包含 <code>子查询</code>，则该 <code>check</code> 是 <code>复杂的</code>。</p>
<p>考虑该例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CHECK</span>(time_slot_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> time_slot_id <span class="keyword">FROM</span> time_slot))</span><br></pre></td></tr></table></figure>

<p>为了维护 <code>check约束</code>，并非仅仅是 <code>简单地在插入或更新元组时</code> 进行 <code>检查</code>，在 <code>子查询所涉及的关系</code> 发生 <code>变化</code> 时，也需要进行 <code>检查</code>。</p>
<h2 id="Assertion"><a href="#Assertion" class="headerlink" title="Assertion"></a>Assertion</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ASSERTION credits_earned_constraint <span class="keyword">CHECK</span>(</span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> ID</span><br><span class="line">           <span class="keyword">FROM</span> student</span><br><span class="line">           <span class="keyword">WHERE</span> tot_cred <span class="operator">&lt;&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">sum</span>(credits)</span><br><span class="line">                             <span class="keyword">FROM</span> takes <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> course</span><br><span class="line">                              <span class="keyword">WHERE</span> student.ID <span class="operator">=</span> takes.ID</span><br><span class="line">                              <span class="keyword">AND</span> grade <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                              <span class="keyword">AND</span> grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">                              )</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>断言 (Assertion)</code>：<code>断言</code> 是 <code>谓词</code> 的一种形式，用于描述我们希望 <code>数据库</code> <code>总能</code> <code>满足的条件</code>。</p>
<blockquote>
<p><code>域约束</code>，<code>参照完整性约束</code> 均属于 <code>断言</code></p>
</blockquote>
<blockquote>
<p>目前大部分的 <code>数据库</code> 对 <code>断言 (Assertion)</code> 的支持不完善。</p>
<p><code>维护</code> 一个 <code>断言</code> 的代价是非常大的。如果可能，可以使用 <code>触发器 (Trigger)</code> 来代替 <code>断言</code> 。</p>
</blockquote>
<h2 id="Data-Type-and-Pattern"><a href="#Data-Type-and-Pattern" class="headerlink" title="Data Type and Pattern"></a>Data Type and Pattern</h2><h3 id="Date-and-Time"><a href="#Date-and-Time" class="headerlink" title="Date and Time"></a>Date and Time</h3><p>Type</p>
<p>Node</p>
<p>date</p>
<p><code>日历日期</code>，如 <code>1990-06-21</code></p>
<p>time</p>
<p><code>一天中的时间</code>，如 <code>8:42:26</code></p>
<p>timestamp</p>
<p><code>date和time的组合</code>，如 <code>1990-06-21 8:42:26</code></p>
<h3 id="Default-Value"><a href="#Default-Value" class="headerlink" title="Default Value"></a>Default Value</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student</span><br><span class="line">(ID <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"> tot_cred <span class="type">numeric</span>(<span class="number">3</span>, <span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY(ID)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX studentID_index <span class="keyword">ON</span> student(ID)</span><br></pre></td></tr></table></figure>

<h3 id="Big-Object-Type"><a href="#Big-Object-Type" class="headerlink" title="Big Object Type"></a>Big Object Type</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> demo</span><br><span class="line">(</span><br><span class="line">    book_review <span class="type">clob</span>(<span class="number">10</span>KB)</span><br><span class="line">    image <span class="type">blob</span>(<span class="number">10</span>MB)</span><br><span class="line">    movie <span class="type">blob</span>(<span class="number">2</span>GB)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当 <code>查询</code> <code>大对象</code> 时，<code>数据库</code> 并非直接 <code>返回整个大对象</code>。而是 <code>返回用于检索该大对象的定位器</code>。</p>
<p>这类似于 <code>迭代器</code> 或 <code>文件指针</code>，可以 <code>按小片段</code> <code>逐步地访问</code> <code>整个大对象</code></p>
</blockquote>
<h3 id="User-Defined-Type"><a href="#User-Defined-Type" class="headerlink" title="User Defined Type"></a>User Defined Type</h3><ul>
<li><code>独特类型 (Distinct Type)</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TYPE Dollars <span class="keyword">AS</span> <span class="type">numeric</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">FINAL</span>;</span><br><span class="line"><span class="keyword">CREATE</span> TYPE Pounds <span class="keyword">AS</span> <span class="type">numeric</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">FINAL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> department</span><br><span class="line">(dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"> building <span class="type">varchar</span>(<span class="number">15</span>),</span><br><span class="line"> budget Dollars</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>final关键字</code> 是没有任何意义的。属于 <code>SQL标准</code> 的 <code>历史遗留问题</code></p>
</blockquote>
<p>这里的关键点是，<code>Dollars</code> 是 <code>独特类型</code>，不能将 <code>Pounds</code> 类型赋值给 <code>Dollars</code> 类型</p>
<blockquote>
<p>尽管 <code>Dollars</code> 和 <code>Pounds</code> 基于 <code>相同的基本数据类型</code> 而定义的。</p>
</blockquote>
<p>甚至，我们也无法将 <code>Integer</code> 赋值给 <code>Dollars</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This is wrong</span></span><br><span class="line">department.budget <span class="operator">+</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This is right</span></span><br><span class="line"><span class="built_in">cast</span>(department.budget <span class="keyword">to</span> <span class="type">numeric</span>(<span class="number">12</span>,<span class="number">2</span>)) <span class="operator">+</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>之前我们讨论过 <code>域 (Domain)</code>，它和 <code>独特类型</code> 的区别在于：</p>
<ul>
<li><code>域</code> 上可以声明 <code>约束</code> 和 定义 <code>默认值</code></li>
<li><code>域</code> 并不是 <code>强类型的</code>，<code>基本类型相容的域</code> 可以 <code>相互赋值</code>。</li>
</ul>
</blockquote>
<ul>
<li><code>结构化数据类型 (Structured Data Type)</code></li>
</ul>
<p>可以创建 <code>具有嵌套记录结构</code>，<code>数组</code>，<code>多重集</code> 的 <code>复杂数据类型</code></p>
<h2 id="Create-Table-Extension"><a href="#Create-Table-Extension" class="headerlink" title="Create Table Extension"></a>Create Table Extension</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> temp_instructor <span class="keyword">LIKE</span> instructor</span><br></pre></td></tr></table></figure>

<h2 id="Schema-Catalog-and-Environment"><a href="#Schema-Catalog-and-Environment" class="headerlink" title="Schema, Catalog and Environment"></a>Schema, Catalog and Environment</h2><p><code>目录 (Catalog)</code> 和<code>模式 (Schema)</code>用于为 <code>关系</code> 提供 <code>命名空间</code>，它们都是用于 <code>限定</code> <code>关系</code> 的 <code>限定名</code>。</p>
<blockquote>
<p>部分 <code>数据库实现</code> 使用 <code>数据库</code> 术语 来代替 <code>目录</code>。</p>
</blockquote>
<p>如下例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catelog5.univ_schema.course</span><br></pre></td></tr></table></figure>

<blockquote>
<p>每个 <code>用户 (User)</code> 都有自己的 <code>默认目录 (Default Catalog)</code> 和 <code>默认模式 (Default Schema)</code>。</p>
<p>当 <code>用户</code> 连接到 <code>数据库</code> 时，会为 <code>该连接自动地配置为</code> <code>默认目录</code> 和 <code>默认模式</code>。</p>
<blockquote>
<p>这类似于 <code>OS</code> 中为 <code>登陆OS的用户</code> 自动地切换 <code>当前目录</code> 为 <code>用户的主目录 (Home Directory)</code></p>
</blockquote>
<p>当 <code>创建</code> <code>新用户</code> 时，会 <code>自动地</code> 创建 <code>与该用户名同名的模式</code></p>
</blockquote>
<blockquote>
<p>在前面的例子中，我们都没有指定 <code>catelog</code> 和 <code>schema</code>。</p>
<p>这是因为我们一直在使用 <code>用户的默认目录</code> 和 <code>用户的默认模式</code>。即直接用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">course</span><br></pre></td></tr></table></figure>

<p>来 <code>定位</code> <code>course关系</code></p>
</blockquote>
<h2 id="Authorization"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization</h2><p><code>授权 (Authorization)</code>：将某种 <code>权限 (Privilege/Permission)</code> 授予 <code>某个用户 (User)</code> 或 <code>某个角色 (Role)</code></p>
<h3 id="Grant-and-Revoke"><a href="#Grant-and-Revoke" class="headerlink" title="Grant and Revoke"></a>Grant and Revoke</h3><p><code>授予权限</code> 和 <code>撤销权限</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> department <span class="keyword">TO</span> Amit, Satoshi;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> department <span class="keyword">FROM</span> AMit, Satoshi;</span><br></pre></td></tr></table></figure>

<hr>
<p>授权的 <code>最细粒度</code> 为 <code>关系的属性</code> ：<code>SQL标准</code> 允许对 <code>关系的某个属性</code> 授权，但不允许对 <code>关系的某个特定元组</code> 进行授权。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span>(budget) <span class="keyword">ON</span> department <span class="keyword">TO</span> Amit, Satoshi;</span><br></pre></td></tr></table></figure>

<h3 id="Role"><a href="#Role" class="headerlink" title="Role"></a>Role</h3><p><code>角色 (Role)</code>：即 <code>权限(Permission)的集合</code>。可以将 <code>角色</code> 授予 <code>用户</code>，使得 <code>用户</code> 获得 <code>这些权限</code></p>
<p>使用 <code>角色</code> 的两点好处：</p>
<ul>
<li>可以一次性地授予 <code>权限集</code> 给 <code>角色</code>，然后再把 <code>角色</code> 授予给 <code>用户</code>，避免对 <code>每个用户</code> 都繁琐的授予 <code>权限集</code></li>
<li>即可以 <code>标识</code> <code>用户的身份</code>，同时可以避免 <code>所有相同身份的人使用同个用户</code> 导致 <code>安全隐患</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ROLE instructor;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> takes <span class="keyword">TO</span> instructor</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> instructor <span class="keyword">TO</span> Amit</span><br></pre></td></tr></table></figure>

<h3 id="View-Authorization"><a href="#View-Authorization" class="headerlink" title="View Authorization"></a>View Authorization</h3><p>对于 <code>仅有查看Geology系权限的工作人员</code>，尽管 <code>它没有权限查看其他系的元组</code>，下列 <code>语句</code> 仍然是 <code>合法的</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> geo_instructor <span class="keyword">AS</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"> <span class="keyword">FROM</span> instructor</span><br><span class="line"> <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Geology&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> geo_instructor</span><br></pre></td></tr></table></figure>

<p>这表明，<code>创建某个视图的用户</code> 并不需要 <code>获得该视图上的所有权限</code>。</p>
<p>该 <code>用户</code> 在 <code>该视图上所获得的权限</code> 并不会 <code>多余它已有的权限</code></p>
<blockquote>
<p>即 <code>危险的用户</code> 无法通过 <code>视图</code>，<code>函数</code> 或 <code>过程</code> 来 <code>获得</code> <code>超越它本有的权限</code> 的 <code>权限</code></p>
</blockquote>
<h3 id="Reference-Authorization"><a href="#Reference-Authorization" class="headerlink" title="Reference Authorization"></a>Reference Authorization</h3><p><code>用户</code> 在 <code>创建外码</code>时，必须要拥有 <code>被参照关系</code> 的 <code>REFERENCE权限</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">REFERENCES</span> (dept_name) <span class="keyword">ON</span> department <span class="keyword">TO</span> Mariano;</span><br></pre></td></tr></table></figure>

<p>一个很关键在原因在于：<code>所创建的外码</code> 会对 <code>被参照关系</code> 的 <code>删除和更新</code> 产生 <code>阻碍</code>。</p>
<p>如果 <code>某个用户</code> <code>创建了许多外码约束</code>，那么那个 <code>被参照关系</code> 在 <code>删除和更新</code> 时会 <code>背负许多毫无意义的外码约束</code>，使得因为 <code>违反外码约束</code> 而 <code>无法进行</code> <code>删除和更新</code>。</p>
<p>因此，<code>只有拥有被参照关系的REFERENCES权限的用户</code> 才可以 <code>创建引用该关系的外码</code>。</p>
<blockquote>
<p>类似地，<code>CHECK约束</code> 和 <code>REFERENCES约束</code> 一样，都要求 <code>用户拥有所引用关系的REFERENCE权限</code></p>
</blockquote>
<h3 id="Transfer-Permission-and-Revoke-Permission"><a href="#Transfer-Permission-and-Revoke-Permission" class="headerlink" title="Transfer Permission and Revoke Permission"></a>Transfer Permission and Revoke Permission</h3><p><code>SQL</code> <code>默认</code> 禁止 <code>转授</code> <code>授予某个用户的权限</code>。</p>
<p>如果希望 <code>授予Amit的SELECT权限</code>，<code>Amit仍然可以转授该权限给其他用户</code>，则使用 <code>WIGH GRANT OPTION</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> department <span class="keyword">TO</span> Amit <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br></pre></td></tr></table></figure>

<hr>
<p><code>用户</code> 和 <code>角色</code> 之间的 <code>权限授予</code> 用 <code>授权图 (Authorization Graph)</code> 来描述。</p>
<p>考虑如下情况，如果 <code>危险用户A</code> 从 <code>DBA</code> 获得 <code>某权限</code>，然后 <code>危险用户A</code> 将 <code>该权限转授</code> <code>危险用户B</code>。</p>
<p>同时，<code>危险用户B</code> 再将 <code>该权限</code> <code>转授</code> <code>危险用户A</code>。</p>
<p>也就是说，形成了一个 <code>转授环</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">dba((DBA)) --&gt; a((A))</span><br><span class="line">a --&gt; b((B))</span><br><span class="line">b --&gt; a</span><br></pre></td></tr></table></figure>

<p>使用 <code>授权图</code> 可以 <code>处理</code> <code>这种情况</code></p>
<p>我们规定，<code>用户具有权限的充分必要条件</code> 是 从<code>授权图的根节点(DBA)</code> 到 <code>该用户的顶点</code> 之间要存在 <code>路径</code>。</p>
<p>对于上述的情况，当我们 <code>撤销授予用户A的权限</code>时，由于 <code>用户B的权限</code> 是 <code>用户A转授给它的</code>，所以，实际上 <code>撤销的路径为</code> dba \to a \to b</p>
<p>于是 <code>授权图</code> 变成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">dba((DBA))</span><br><span class="line">a((A))</span><br><span class="line">b((B))</span><br></pre></td></tr></table></figure>

<hr>
<p>可以使用 <code>restrict</code> 来 <code>阻止</code> <code>级联收回</code>，如果 <code>存在级联收回</code>，则 <code>不执行任何收权动作</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> department <span class="keyword">FROM</span> amit, Satoshi RESTRICT</span><br></pre></td></tr></table></figure>

<hr>
<p>如果确实希望 <code>只收回用户A的权限</code>，但 <code>不收回用户A授予用户B的权限</code>。</p>
<p>则不应当使用 <code>上述的权限拓扑</code>，<code>DBA</code> 应当将 <code>权限</code> 授予 <code>角色</code>，然后将 <code>角色</code> 授予 <code>用户</code>。即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">dba((DBA)) --&gt; role(instructor)</span><br><span class="line">role --&gt; a((A))</span><br><span class="line">role --&gt; b((B))</span><br></pre></td></tr></table></figure>

<p>当需要 <code>仅撤销用户A的权限时</code>，只需要 <code>简单地撤销用户A的角色instructor即可</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">dba((DBA)) --&gt; role(instructor)</span><br><span class="line">a((A))</span><br><span class="line">role --&gt; b((B))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 作为一种规范，如果可能的话，<code>权限</code> 应该由 <code>角色</code> 来 <code>授予</code>，而不是由 <code>特定的用户</code> 授予 ！</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/28/database-elementary-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/database-elementary-sql/" class="post-title-link" itemprop="url">Database - Elementary SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-28 19:55:53" itemprop="dateCreated datePublished" datetime="2022-04-28T19:55:53+00:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Elementary-SQL"><a href="#Elementary-SQL" class="headerlink" title="Elementary SQL"></a>Elementary SQL</h1><h2 id="Primitive-Type"><a href="#Primitive-Type" class="headerlink" title="Primitive Type"></a>Primitive Type</h2><p>Primitive Type</p>
<p>Description</p>
<p>char(n), character(n)</p>
<p><code>固定长度的字符串</code>，<code>固定长度</code> 为 n</p>
<p>varchar(n), character\ varying(n)</p>
<p><code>可变长度的字符串</code>，<code>最大长度</code> 为 n</p>
<p>int, integer</p>
<p><code>整数类型</code></p>
<p>smallint</p>
<p><code>小整数类型</code></p>
<p>numeric(p,d)</p>
<p><code>定点数类型</code>：numeric(3,1) \to 44.5</p>
<p>real, double\ precision</p>
<p><code>浮点数</code> 和 <code>双精度浮点数</code></p>
<p>float(n)</p>
<p><code>精度至少为n位的浮点数</code></p>
<blockquote>
<p><code>空值 (null)</code>：任何 <code>数据类型</code> 都可能包含 <code>空值</code>。<code>空值</code> 表达语义 <code>缺失的值</code>。</p>
</blockquote>
<blockquote>
<p>对于使用 <code>char</code> 类型存放的 <code>字符串</code>，会自动执行 <code>末尾补空格</code> 策略。</p>
<p>但请注意，当我们使用 <code>char</code> 和 <code>varchar</code> 进行 <code>相等性测试</code>时，<code>行为</code> 将是 <code>未定义的</code>，某些实现可能会 <code>自动为varchar在末尾补空格</code>。</p>
<p>出于这点考虑，建议 <code>永远只使用varchar</code></p>
</blockquote>
<h2 id="Define-a-Database-Pattern"><a href="#Define-a-Database-Pattern" class="headerlink" title="Define a Database Pattern"></a>Define a Database Pattern</h2><h3 id="General-Form"><a href="#General-Form" class="headerlink" title="General Form"></a>General Form</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> r</span><br><span class="line">(Attribute1 Domain1,</span><br><span class="line"> Attribute2 Domain2,</span><br><span class="line"> ...,</span><br><span class="line"> Attributen Domainn,</span><br><span class="line"> <span class="operator">&lt;</span>Integrity <span class="keyword">Constraint</span><span class="operator">&gt;</span>,</span><br><span class="line"> ...,</span><br><span class="line"> <span class="operator">&lt;</span>Integrity <span class="keyword">Constraint</span><span class="operator">&gt;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>域 (Domain)</code> ：用于指定 <code>与域相关联的属性</code> 的 <code>数据类型</code> 以及 <code>约束</code></p>
</blockquote>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> teaches(</span><br><span class="line">id <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">section_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line"><span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (id, course_id, section_id, semester, <span class="keyword">year</span>),</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (course_id, section_id, semester, <span class="keyword">year</span>) <span class="keyword">REFERENCES</span> section,</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (id) <span class="keyword">REFERENCES</span> instructor    </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="Basic-DML"><a href="#Basic-DML" class="headerlink" title="Basic DML"></a>Basic DML</h2><h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> instructor <span class="keyword">VALUES</span> (<span class="number">10211</span>, <span class="string">&#x27;Smith&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="number">66000</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><ul>
<li>Delete a <code>Relationship</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> r;</span><br></pre></td></tr></table></figure>

<ul>
<li>Delete <code>Tuple</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以使用 <code>DELETE FROM r</code>来删除 <code>关系中的所有元组</code>，但 <code>保留关系的模式定义</code></p>
</blockquote>
<h4 id="Alter"><a href="#Alter" class="headerlink" title="Alter"></a>Alter</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> r <span class="keyword">ADD</span> attribute domain;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> r <span class="keyword">DROP</span> attribute;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>某些 <code>数据库</code> 仅仅支持 <code>删除整个关系</code> ，而不支持 <code>删除关系中的某个属性</code>。</p>
</blockquote>
<h2 id="Basic-Structure"><a href="#Basic-Structure" class="headerlink" title="Basic Structure"></a>Basic Structure</h2><p><code>SQL</code> 的 <code>基本查询</code> 由 <code>SELECT</code>，<code>FROM</code>，<code>WHERE</code> 三大 <code>子句</code> 所构成。</p>
<h3 id="Single-Relation-query"><a href="#Single-Relation-query" class="headerlink" title="Single-Relation query"></a>Single-Relation query</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> instructor;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>数学</code> 上的 <code>关系</code> 本质是 <code>集合</code>，不允许 <code>重复元素</code>。</p>
<p>但 <code>维护元素的唯一性</code> 的 <code>代价</code> 非常大，在 <code>数据库</code> 中则是 <code>允许关系中的元素发生重复</code></p>
<blockquote>
<ul>
<li><code>all</code> 和 <code>distinct</code></li>
</ul>
<p>对于 <code>SELECT</code> 来说，<code>去重选项</code> 默认为 <code>ALL</code> 即表示 <code>不去重</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ALL</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> instructor;</span><br></pre></td></tr></table></figure>

<p>也可以手动指定为 <code>distinct</code> 表示需要进行 <code>去重</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> instructor;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<p>使用 <code>WHERE子句</code> 可以从 <code>FROM子句的结果关系</code> 中 <code>筛选</code> 出 <code>使得谓词为True的元组</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> deptname  <span class="string">&#x27;Comp.Sci.&#x27;</span> <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">70000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Multi-Relation-query"><a href="#Multi-Relation-query" class="headerlink" title="Multi-Relation query"></a>Multi-Relation query</h3><h4 id="General-Form-1"><a href="#General-Form-1" class="headerlink" title="General Form"></a>General Form</h4><p><code>多表查询</code> 的 <code>通用格式</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> attribute1, attribute2, ..., attributen</span><br><span class="line"><span class="keyword">FROM</span> r1, r2, ..., rn</span><br><span class="line"><span class="keyword">WHERE</span> P;</span><br></pre></td></tr></table></figure>

<p>其中，每种 <code>子句</code> 的作用如下：</p>
<ul>
<li><code>SELECT子句</code>：从 <code>WHERE子句给出的元组</code> 中 <code>投影</code> 指定的 <code>属性列表</code></li>
<li><code>FROM子句</code>：给出 <code>作为数据输入的</code> 的 <code>关系列表</code></li>
<li><code>WHERE子句</code>：<code>过滤出</code> 使得 <code>谓词</code> 为 <code>True</code> 的 <code>FROM子句中的元组</code></li>
</ul>
<blockquote>
<p><code>数据库</code> 执行 <code>查询</code> 的 <code>顺序</code> 与 <code>书写顺序</code> 不太一样：FROM \to WHERE \to SELECT</p>
<p>可以将 <code>SELECT子句</code> 看作是一种 <code>语言学方面的结构提前</code>，这种 <code>形式提前</code> 有利于我们 <code>快速地了解输出的结构是什么</code></p>
</blockquote>
<blockquote>
<p><code>WHERE子句</code> 的 <code>默认值</code> 为 <code>WHERE true</code></p>
</blockquote>
<blockquote>
<p><code>FROM子句</code> 会为 <code>关系列表</code> 中的 <code>所有关系</code> 都进行 <code>笛卡尔积运算</code>，通常会产生一个 <code>非常巨大的结果关系</code></p>
<blockquote>
<p>实际上，大部分情况下并不会真的 <code>生成</code> <code>关系列表中所有关系的笛卡尔积</code>。</p>
<p>因为 <code>查询优化器</code> 会 <code>事先过滤</code>掉 <code>大部分不可能满足WHERE子句的元组</code>，使得 <code>FROM子句</code> 输出的 <code>结果关系</code> 规模 <code>大幅度减小</code></p>
</blockquote>
<p>对于 <code>FROM instructor, department</code> 来说，就是对 <code>instructor关系</code> 和 <code>department关系</code> 进行 <code>笛卡尔积</code> 作为 <code>结果关系</code></p>
</blockquote>
<h4 id="Match-Condition-Specified-by-Where-Clause"><a href="#Match-Condition-Specified-by-Where-Clause" class="headerlink" title="Match Condition Specified by Where Clause"></a>Match Condition Specified by Where Clause</h4><p>通过 <code>Where子句</code> 指定 <code>匹配条件</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, course_id</span><br><span class="line"><span class="keyword">FROM</span> instructor, teaches</span><br><span class="line"><span class="keyword">WHERE</span> instructor.ID <span class="operator">=</span> teaches.ID;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当 <code>属性名</code> 仅出现在 <code>FROM子句所指定的关系</code> 的 <code>一个关系</code> 中时，可以省略掉 <code>属性名的全限定前缀</code>。</p>
<p>当然，<code>总是为属性名写上关系名前缀</code> 是没有错的。</p>
</blockquote>
<blockquote>
<p>n.b. 上述的 <code>匹配条件</code> 并不会查询出 <code>没有教授任何课程的教师</code>。</p>
<p>如果期望显示出这些教师，则应当使用 <code>外连接</code></p>
</blockquote>
<h4 id="Match-Condition-Specified-by-Natural-Join"><a href="#Match-Condition-Specified-by-Natural-Join" class="headerlink" title="Match Condition Specified by Natural Join"></a>Match Condition Specified by Natural Join</h4><h5 id="Natural-Join-Compare-all-the-common-attributes"><a href="#Natural-Join-Compare-all-the-common-attributes" class="headerlink" title="Natural Join: Compare all the common attributes"></a>Natural Join: Compare all the common attributes</h5><p><code>自然连接 (Natural Join)</code>：将输入的 <code>2个关系</code> 中 <code>共有属性 (Common Condition) 的值</code> <code>均相等</code> <code>的元组</code> 作为 <code>输出结果</code></p>
<p>下列 <code>查询</code> 的 <code>等价形式</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, course_id</span><br><span class="line"><span class="keyword">FROM</span> instructor, teaches</span><br><span class="line"><span class="keyword">WHERE</span> instructor.ID <span class="operator">=</span> teaches. ID</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, course_id</span><br><span class="line"><span class="keyword">FROM</span> instructor <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> teaches</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实际上，可以将 <code>NATURAL JOIN语句</code> 看作是一种形式的 <code>宏展开 (Macro Expansion)</code>。</p>
<p>先查找 <code>两个关系的共有属性</code>，然后 <code>改写</code> 成 <code>WHERE子句</code> 形式的 <code>谓词</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> S.common_attribute_1 <span class="operator">=</span> T.common_attribute_1</span><br><span class="line"><span class="keyword">AND</span> S.common_attribute_2 <span class="operator">=</span> T.common_attribute_2</span><br><span class="line">...</span><br><span class="line"><span class="keyword">AND</span> S.common_attribute_n <span class="operator">=</span> T.common_attribute_n</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="Natural-Join-Specify-specific-common-attributes"><a href="#Natural-Join-Specify-specific-common-attributes" class="headerlink" title="Natural Join: Specify specific common attributes"></a>Natural Join: Specify specific common attributes</h5><p>首先，考虑下面这个 <code>查询</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 1</span></span><br><span class="line"><span class="keyword">SELECT</span> name, title</span><br><span class="line"><span class="keyword">FROM</span> instructor <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> teaches, course</span><br><span class="line"><span class="keyword">WHERE</span> teaches.course_id <span class="operator">=</span> course.course_id;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. <code>teaches.course_id</code> 追根溯源来自 <code>teaches</code>，我们是无法直接 <code>引用</code> <code>自然连接的结果关系</code> 的，但可以 <code>直接引用</code> <code>参与自然连接的属性</code>，因为 <code>自然连接的结果关系</code> 中的 <code>属性</code> 正来自这些 <code>单个关系的属性</code>。</p>
</blockquote>
<p>但是，该查询 <code>并不等价于</code> 下列这个 <code>查询</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 2</span></span><br><span class="line"><span class="keyword">SELECT</span> name, title</span><br><span class="line"><span class="keyword">FROM</span> instructor <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> teaches <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> course</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>instructor关系</code>，<code>teaches关系</code>，<code>course关系</code> 均有 <code>dept_name属性</code>。</p>
<p>对于 <code>Query 1</code> ：则只需要考虑 <code>这两个关系的</code> <code>dept_name属性</code> 的 <code>相等</code>，而 <code>course关系的dept_name属性</code> 可以与他们不同。也就是说，该查询会显示出 <code>教师所讲授的课程</code> 不是 <code>教师所在系的课程</code></p>
<p>对于 <code>Query 2</code>：该查询 <code>只显示</code> <code>教师所教的课程</code> <code>就是该教师所在系的课程</code></p>
</blockquote>
<p>出现该问题的原因在于，在将 <code>instructor NATURAL JOIN teaches</code> 和 <code>course</code>进行 <code>自然连接</code> 时，<code>course</code> 中存在 <code>我们不希望使用的共同属性</code> 即 <code>dept_name</code></p>
<blockquote>
<p><code>course关系</code> 共有2个 <code>共同属性</code>：<code>course_id</code>，<code>dept_name</code></p>
</blockquote>
<p>对此，我们可以通过 <code>带指定属性列表的自然连接 (Natural Join with Specific Arrtibute List)</code> 来改写 <code>Query 2</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 3</span></span><br><span class="line"><span class="keyword">SELECT</span> name, title</span><br><span class="line"><span class="keyword">FROM</span> (instructor <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> teaches) <span class="keyword">JOIN</span> course <span class="keyword">USING</span> (course_id)</span><br></pre></td></tr></table></figure>

<p>这样，<code>Query 3</code> 等价于 <code>Query 1</code>。</p>
<blockquote>
<p>n.b. 同样的道理，可以再将 <code>NATURAL JOIN</code> 视为 <code>JOIN relation USING attribute_list</code> 的 <code>宏展开</code>。</p>
<p>默认情况下，<code>relation_1 NATURAL JOIN relation_2</code> 可以展开为 <code>relation_1 JOIN relation_2 USING (common_attribute_list)</code></p>
</blockquote>
<h2 id="Basic-Operation"><a href="#Basic-Operation" class="headerlink" title="Basic Operation"></a>Basic Operation</h2><h3 id="Rename-Operation"><a href="#Rename-Operation" class="headerlink" title="Rename Operation"></a>Rename Operation</h3><p><code>更名运算 (Rename Operation)</code> 用于为 <code>实体</code> 指定 <code>标识符</code>。</p>
<p>它主要有以下几种作用：</p>
<ul>
<li><p>修改 <code>输出关系</code>中的 <code>长属性名</code> 修改为 <code>短属性名</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> instructor_name <span class="keyword">AS</span> inst_name</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br></pre></td></tr></table></figure>
</li>
<li><p>为 <code>运算中间结果</code> 指定 <code>标识符</code>，以便 <code>后续对它的引用</code></p>
</li>
<li><p>用于 <code>区分</code> <code>涉及自身关系的笛卡尔积运算</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> T.name</span><br><span class="line"><span class="keyword">FROM</span> instructor <span class="keyword">AS</span> T, instructor <span class="keyword">AS</span> S</span><br><span class="line"><span class="keyword">WHERE</span> T.salary <span class="operator">&gt;</span> S.salary <span class="keyword">AND</span> S.dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 可以将 <code>T</code> 和 <code>S</code> 看作是 <code>instructor关系</code> 的 <code>2份拷贝</code></p>
<blockquote>
<p>实际上，并不会真的拷贝2份关系。<code>T</code> 和 <code>S</code> 只不过是对 <code>instructor</code> 的 <code>引用</code> 而已。</p>
</blockquote>
</blockquote>
<blockquote>
<p>像 <code>T</code> 和 <code>S</code> 这样 <code>用于重命名关系的标识符</code> 被称为 <code>相关名称 (Correlation Name)</code>，或 <code>表别名 (Table Alias)</code> 或 <code>相关变量 (Correlation Variable)</code> 或 <code>元组变量 (Tuple Variable)</code></p>
</blockquote>
</li>
</ul>
<h3 id="String-Operation"><a href="#String-Operation" class="headerlink" title="String Operation"></a>String Operation</h3><h4 id="Pattern-Matching"><a href="#Pattern-Matching" class="headerlink" title="Pattern Matching"></a>Pattern Matching</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> department</span><br><span class="line"><span class="keyword">WHERE</span> building <span class="keyword">LIKE</span> <span class="string">&#x27;%Watson%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>通过使用 <code>LIKE操作符</code>可以实现 <code>模式匹配 (Pattern Matching)</code>，使用如下 <code>字符</code> 来 <code>定义模式</code>：</p>
<ul>
<li><code>百分号 (%)</code>：匹配 <code>任意子串</code></li>
<li><code>下划线 (_)</code>：匹配 <code>任意一个字符</code></li>
</ul>
<blockquote>
<p>n.b. 尽管 <code>SQL标准</code> 中要求 <code>字符串的相等运算</code> 是 <code>大小写敏感的</code>。</p>
<p>但 <code>某些数据库</code>，如 <code>MySQL</code> 和 <code>SQL Server</code> 却在 <code>匹配字符串</code> 时 <code>不区分大小写</code>！</p>
<p>关于 <code>字符串相等性测试</code> 的具体详情，应当查阅 <code>Manual</code></p>
</blockquote>
<h4 id="Escape-Character"><a href="#Escape-Character" class="headerlink" title="Escape Character"></a>Escape Character</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LIKE</span> <span class="string">&#x27;ab\%cd%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;\&#x27;</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>ESCAPE关键字</code> 定义 <code>转义字符</code> 为 <code>\</code></p>
<h3 id="Order-Operation"><a href="#Order-Operation" class="headerlink" title="Order Operation"></a>Order Operation</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Physics&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>, name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ORDER BY子句</code> 的 <code>默认值</code> 为 <code>asc</code>，而 <code>desc</code> 需要手动指定。</p>
</blockquote>
<h4 id="Between-Operation"><a href="#Between-Operation" class="headerlink" title="Between Operation"></a>Between Operation</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 1</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">9000</span> <span class="keyword">AND</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 2</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">9000</span> <span class="keyword">AND</span> salary <span class="operator">&lt;=</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure>

<p><code>Query 1</code> 等价于 <code>Query 2</code></p>
<blockquote>
<p>n.b. 可以将 <code>Between运算符</code> 和 <code>Not Between运算符</code> 视为 <code>基于不等式比较运算符写法</code> 的 <code>宏展开</code>。</p>
<p>但使用 <code>Between</code> 和 <code>Not Between</code> 使得 <code>查询</code> 更加 <code>清晰</code>，而且更不容易 <code>错写</code></p>
</blockquote>
<h4 id="Multi-Dimensional-Tuple"><a href="#Multi-Dimensional-Tuple" class="headerlink" title="Multi-Dimensional Tuple"></a>Multi-Dimensional Tuple</h4><p>考虑下列 <code>包含多个AND的相等性测试语句</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 1</span></span><br><span class="line"><span class="keyword">SELECT</span> name, course_id</span><br><span class="line"><span class="keyword">FROM</span> instructor, teaches</span><br><span class="line"><span class="keyword">WHERE</span> instructor.ID <span class="operator">=</span> teaches.ID <span class="keyword">AND</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br></pre></td></tr></table></figure>

<p>以及</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 2</span></span><br><span class="line"><span class="keyword">SELECT</span> name, course_id</span><br><span class="line"><span class="keyword">FROM</span> instructor, teaches</span><br><span class="line"><span class="keyword">WHERE</span> (instructor.ID, dept_name) <span class="operator">=</span> (teaches.ID, <span class="string">&#x27;Biology&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>Query 1</code> 等价于 <code>Query 2</code></p>
<blockquote>
<p>作为一种更为 <code>抽象</code> 的考虑。我们可以认为 <code>常规所书写的相等语句</code> 本质上就属于 <code>1维元组</code>。</p>
<p>而如果需要同时测试 <code>多个属性的某种比较关系</code>，可以使用 <code>向量/元组</code>。</p>
<p>上述仅仅是 <code>测试</code> <code>相等关系</code>。同理，也可以用于 <code>测试</code> <code>偏序关系</code>。</p>
<blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(x1, y1) <span class="operator">&lt;</span> (x2, y2) </span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<h3 id="Set-Operation"><a href="#Set-Operation" class="headerlink" title="Set Operation"></a>Set Operation</h3><p><code>SQL标准</code> 中所定义的 <code>集合运算</code> 都是基于 <code>数学的集合论语义</code> 的：<code>所有的集合运算</code> 会 <code>自动去重</code></p>
<blockquote>
<p>实际上，<code>SQL</code> 的 <code>集合运算</code> 有 <code>两套版本</code></p>
<ul>
<li><code>自动去重的默认的distinct版本</code>：<code>intersect (distinct)</code>，<code>union (distinct)</code> ，<code>except (distinct)</code></li>
<li><code>不带去重的all版本</code> ： <code>intersect all</code>，<code>union all</code>，<code>except all</code></li>
</ul>
</blockquote>
<h4 id="Intersect-Operation"><a href="#Intersect-Operation" class="headerlink" title="Intersect Operation"></a>Intersect Operation</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> course_id</span><br><span class="line"> <span class="keyword">FROM</span> section</span><br><span class="line"> <span class="keyword">WHERE</span> semester<span class="operator">=</span><span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">) <span class="keyword">INTERSECT</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id</span><br><span class="line"><span class="keyword">FROM</span> section</span><br><span class="line"><span class="keyword">WHERE</span> semester<span class="operator">=</span><span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Union-Operation"><a href="#Union-Operation" class="headerlink" title="Union Operation"></a>Union Operation</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> course_id</span><br><span class="line"> <span class="keyword">FROM</span> section</span><br><span class="line"> <span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">) <span class="keyword">UNION</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id</span><br><span class="line"><span class="keyword">FROM</span> section</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Except-Operation"><a href="#Except-Operation" class="headerlink" title="Except Operation"></a>Except Operation</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> course_id</span><br><span class="line"> <span class="keyword">FROM</span> section</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">) <span class="keyword">EXCEPT</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id</span><br><span class="line"><span class="keyword">FROM</span> section</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span>   </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="Null"><a href="#Null" class="headerlink" title="Null"></a>Null</h2><h3 id="The-type-of-operation-involved"><a href="#The-type-of-operation-involved" class="headerlink" title="The type of operation involved"></a>The type of operation involved</h3><p>The type of operation involved</p>
<p>Rule</p>
<p><code>算术表达式</code></p>
<p>任何 <code>算术表达式</code> 的 <code>输入为空</code>，则 <code>输出为空</code></p>
<p><code>逻辑表达式</code></p>
<p>任何 <code>涉及空值的逻辑表达式</code> 的 <code>输出为未知 (unknown)</code><br>n.b. <code>unknown</code> 并不是 <code>null</code>或 <code>not null</code>，也不是 <code>true</code> 和 <code>false</code>。<br><code>unknown</code> 是 <code>区别于true和false的第三种逻辑值</code>  </p>
<p><code>基本逻辑运算</code> 对于 <code>unknown</code> 定义了 <code>特殊规则</code><br><code>fasle AND unknown = false</code>，<code>true OR unknown = true</code>，<code>NOT unkown = unknown</code></p>
<blockquote>
<p>n.b. <code>SQL标准</code> 定义的 <code>逻辑值</code> 有3种：<code>true</code>，<code>false</code>，<code>unknown</code>。</p>
<p>注意 <code>while子句</code> 的 <code>语义</code> 为：<code>过滤出</code> <code>使得谓词为true的哪些元组</code></p>
</blockquote>
<blockquote>
<p>n.b. <code>未知 (unknown)</code> 也不是 <code>空 (null)</code>。</p>
<p><code>unknown</code>不可以用 <code>is null</code> 或 <code>is not null</code> 来测试。</p>
<p>某些 <code>具体实现</code> 提供了 <code>is unknown</code> 来进行测试。</p>
</blockquote>
<h3 id="Equality-Test"><a href="#Equality-Test" class="headerlink" title="Equality Test"></a>Equality Test</h3><p>Equality Test</p>
<p>Rule</p>
<p><code>元组的相等性测试</code></p>
<p>在测试 <code>两个元组的属性值</code> 是否相等时，如果 <code>属性值</code> 均为 <code>null</code>，则 <code>属性值视为相同</code><br>n.b. 如果 <code>只想保留这样的相同元组的一份拷贝</code>，可以使用 <code>SELECT DISTINCT</code></p>
<p><code>谓词的相等性测试</code></p>
<p>在测试 <code>谓词 null = null</code> 时，将返回 <code>unknown</code>，而不是 <code>true</code></p>
<blockquote>
<p>n.b. 可以认为，<code>元组的相等性测试</code> 实际上执行的是 <code>另一套特殊规则</code>：它为 <code>null = null</code> 返回 <code>true</code></p>
<p>而 <code>谓词的相等性测试</code> 则：为 <code>null = null</code> 返回 <code>unknown</code></p>
</blockquote>
<h2 id="Aggregate-Function"><a href="#Aggregate-Function" class="headerlink" title="Aggregate Function"></a>Aggregate Function</h2><p><code>聚集函数 (Aggregate Function)</code>：以 <code>值的集合</code> 作为输入，返回 <code>单个值</code> 。</p>
<p>Intrinsic Aggregate Function</p>
<p>Node</p>
<p>avg()</p>
<p> </p>
<p>min()</p>
<p> </p>
<p>max()</p>
<p> </p>
<p>sum()</p>
<p>忽略 <code>null</code></p>
<p>count()</p>
<p>为 <code>null</code> 返回 <code>0</code></p>
<h3 id="Basic-Aggregate"><a href="#Basic-Aggregate" class="headerlink" title="Basic Aggregate"></a>Basic Aggregate</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Comp.Sci.&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p>计算 <code>某个关系中的元组个数</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> course;</span><br></pre></td></tr></table></figure>

<hr>
<p>若需要在 <code>聚集操作</code> <code>之前</code> 进行 <code>去重</code>，则可以使用 <code>distinct关键字</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> ID) </span><br><span class="line"><span class="keyword">FROM</span> teaches</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="string">&#x27;2010&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 可以认为，对于 <code>内置的5个聚集函数</code> 而言，默认的 <code>去重选项</code> 是 <code>all</code></p>
<p>n.b. <code>SQL标准</code> 并不允许为 <code>count(*)</code> 使用 <code>distinct</code>。但却可以为 <code>min</code> 和 <code>max</code> 使用 <code>distinct</code>。尽管这些 <code>distinct</code> 并不会改变 <code>运算结果</code> ！</p>
</blockquote>
<h3 id="Grouped-Aggregate"><a href="#Grouped-Aggregate" class="headerlink" title="Grouped Aggregate"></a>Grouped Aggregate</h3><p><code>分组聚集 (Grouped Aggregate)</code> ：可以先对 <code>某个关系中的元组</code> 进行 <code>分组</code>，然后再 <code>分别地</code> 对 <code>每个分组</code> 进行 <code>聚集操作</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以认为，默认情况下 <code>省略</code> <code>GROUP BY子句</code> 意味着：将 <code>整个关系的所有元组</code> 分为 <code>唯一的一组</code>。</p>
</blockquote>
<hr>
<p>考虑一个 <code>错误的查询例子</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This is a wrong query example</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, ID, <span class="built_in">avg</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br></pre></td></tr></table></figure>

<p>该 <code>查询</code> 的问题在于，我们使用 <code>dept_name属性</code> 将 <code>instructor关系的元组</code> 按 <code>系</code> 进行 <code>分组</code>，之后的 <code>avg(salary)</code> 计算的是 <code>某个系的所有教师的平均工资</code>。</p>
<p>而 <code>ID属性</code> 的问题在于，对于 <code>某个系</code> 来说， <code>该系中有许多的教师</code>，如果确实需要 <code>输出ID</code>，那么究竟要输出 <code>该系的所有教师中的哪一个教师的ID</code>？</p>
<p>综上，我们对于 <code>GROUP BY</code> 有一个规则：出现在 <code>SELECT子句</code> 中，但没有被 <code>聚集</code> 的 <code>属性</code>。必须出现在 <code>GROUP BY</code> 中。</p>
<h3 id="Grouped-Aggregate-with-Having-Clause"><a href="#Grouped-Aggregate-with-Having-Clause" class="headerlink" title="Grouped Aggregate with Having Clause"></a>Grouped Aggregate with Having Clause</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">as</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">avg</span>(salary) <span class="operator">&gt;</span> <span class="number">42000</span>;</span><br></pre></td></tr></table></figure>

<p><code>HAVING 子句</code> 在 <code>Grouped Aggregate输出结果</code> <code>之后</code> 才进行 <code>过滤</code>。</p>
<blockquote>
<p>换句话说，<code>HAVING</code> 必须在 <code>GROUP BY</code> 的 <code>分组形成后</code> 才能 <code>执行</code></p>
</blockquote>
<p>同理，对 <code>HAVING</code> 也有类似 <code>GROUP BY</code> 的规则 ：出现在 <code>HAVING子句</code>中，但没有被 <code>聚集</code> 的 <code>属性</code>。必须出现在 <code>GROUP BY</code>中。</p>
<blockquote>
<p>可以将 <code>HAVING子句</code> 和 <code>WHERE子句</code> 作类比。</p>
<ul>
<li><p><code>WHERE</code> ：针对 <code>元组</code></p>
</li>
<li><p><code>HAVING</code>：针对 <code>分组</code></p>
</li>
</ul>
</blockquote>
<blockquote>
<p>现在，我们可以这样看待 <code>标准的SELECT-FROM-WHERE查询</code>为：将 <code>某个关系的分组</code> 分为 <code>唯一的一组</code>，且 <code>分组过滤条件</code> 为 <code>HAVING true</code></p>
</blockquote>
<h2 id="Nested-Subquery"><a href="#Nested-Subquery" class="headerlink" title="Nested Subquery"></a>Nested Subquery</h2><p>我们知道 <code>SELECT-FROM-WHERE</code> 返回类型为 <code>关系</code>，而 <code>FROM子句</code> 的输入类型也为 <code>关系</code>，那么 <code>嵌套子查询 (Nested Subquery)</code> 应当是合理的。</p>
<ul>
<li><code>in</code> 和 <code>not in</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> course_id</span><br><span class="line"><span class="keyword">FROM</span> section</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span> </span><br><span class="line"><span class="keyword">AND</span> course_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> course_id</span><br><span class="line">                  <span class="keyword">FROM</span> section</span><br><span class="line">                  <span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span>;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>all</code> 和 <code>any/some</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> T.name</span><br><span class="line"><span class="keyword">FROM</span> instructor <span class="keyword">AS</span> T, instructor <span class="keyword">AS</span> S</span><br><span class="line"><span class="keyword">WHERE</span> T.salary <span class="operator">&gt;</span> S.salary <span class="keyword">AND</span> S.dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 这种实现方式中，必须要加 <code>DISTINCT</code>：因为 <code>FROM子句</code> 输出的 <code>结果关系</code> 为 <code>2个关系的笛卡尔积</code>，此时 <code>结果关系</code> 中 <code>满足WHERE条件的元组</code> 会 <code>重复</code></p>
</blockquote>
<p>等价于</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 2</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">some</span>(<span class="keyword">SELECT</span> salary</span><br><span class="line">                   <span class="keyword">FROM</span> instructor</span><br><span class="line">                   <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br><span class="line">                   );</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 两条关于 <code>全称量词和特称量词</code> 的 <code>等价性规则</code>：</p>
<ul>
<li><code>= some</code> 等价于 <code>in</code>，但 <code>&lt;&gt; some</code> 不等价于 <code>not in</code></li>
<li><code>&lt;&gt;all</code> 等价于 <code>not in</code>，但 <code>= all</code> 不等价于 <code>in</code></li>
</ul>
</blockquote>
<ul>
<li><code>exists</code></li>
</ul>
<p><code>exists</code>：若 <code>作为exists参数的子查询</code> 产生的 <code>结果关系</code> 是 <code>非空的</code>时，则返回 <code>true</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> course_id</span><br><span class="line"><span class="keyword">FROM</span> section <span class="keyword">AS</span> S</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">           <span class="keyword">FROM</span> section <span class="keyword">AS</span> T</span><br><span class="line">           <span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2010</span></span><br><span class="line">           <span class="keyword">AND</span> S.course_id <span class="operator">=</span> T.course_id;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 该例子中，还有一个需要注意的地方：我们在 <code>子查询</code> 中 <code>引用</code> 了 <code>子查询外部的标识符</code> <code>S.course_id</code>。</p>
<p>我们称 <code>这样的子查询</code> 为 <code>相关子查询 (Correlated Subquery)</code>：使用了 <code>来自外层查询的相关名称</code> 的 <code>子查询</code></p>
<blockquote>
<p>关于 <code>子查询</code> 中对 <code>标识符</code> 的 <code>引用规则</code>，可以类比于 <code>PL中的变量作用域规则</code></p>
</blockquote>
</blockquote>
<hr>
<p><code>not exists</code> 可以用于 <code>测试</code> <code>子查询的结果集</code> 中 <code>是否不存在元组</code>。</p>
<p>我们可以利用这个 <code>特性</code> 来模拟 <code>集合的包含关系</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- use not exists to represent subset relationship</span></span><br><span class="line"><span class="keyword">SELECT</span> S.ID, S.name</span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">AS</span> S</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(</span><br><span class="line">    (<span class="keyword">SELECT</span> course_id</span><br><span class="line">     <span class="keyword">FROM</span> course</span><br><span class="line">     <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span></span><br><span class="line">    ) </span><br><span class="line">    <span class="keyword">EXCEPT</span></span><br><span class="line">    (<span class="keyword">SELECT</span> T.course_id</span><br><span class="line">     <span class="keyword">FROM</span> takes <span class="keyword">AS</span> T</span><br><span class="line">     <span class="keyword">WHERE</span> S.ID <span class="operator">=</span> T.ID</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>unique</code></li>
</ul>
<p><code>unique</code>：若 <code>作为unique参数的子查询</code> 产生的 <code>结果关系</code> 中 <code>不存在重复元组</code>，则返回 <code>true</code>。它为 <code>空集</code> 返回 <code>true</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> T.course_id</span><br><span class="line"><span class="keyword">FROM</span> course <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">UNIQUE</span>(<span class="keyword">SELECT</span> R.course_id</span><br><span class="line">            <span class="keyword">FROM</span> section <span class="keyword">AS</span> R</span><br><span class="line">             <span class="keyword">WHERE</span> T.course_id <span class="operator">=</span> R.course_id</span><br><span class="line">             <span class="keyword">AND</span> R.year <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实际上，可以利用 <code>count()</code> 将 <code>exists</code> ，<code>not exists</code> ，<code>unique</code> 和 <code>not unique</code> 进行 <code>宏展开</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> T.course_id</span><br><span class="line"><span class="keyword">FROM</span> course <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">&gt;=</span> (<span class="keyword">SELECT</span> <span class="built_in">count</span>(R.course_id)</span><br><span class="line">            <span class="keyword">FROM</span> section <span class="keyword">AS</span> R</span><br><span class="line">            <span class="keyword">WHERE</span> T.course_id <span class="operator">=</span> R.course_id</span><br><span class="line">            <span class="keyword">AND</span> R.year <span class="operator">=</span> <span class="number">2009</span></span><br><span class="line">           )</span><br></pre></td></tr></table></figure>

<p>解释：<code>WHERE子句</code> 将对 <code>T关系中的每个元组</code> 进行 <code>测试</code>，判断 <code>嵌套子查询</code> 中 <code>与该元组相等的元组的个数</code> 是否 <code>小于等于1</code></p>
<blockquote>
<p>该例子中，通过 <code>course_id</code> 作为 <code>主键</code> 来判断 <code>两个元组是否相等</code>。</p>
<p>而 <code>AND R.year = 2009</code> 仅仅是 <code>附加的过滤条件</code></p>
</blockquote>
</blockquote>
<blockquote>
<p>n.b. <code>unique</code> 判断 <code>元组是否重复</code> 是基于 <code>元组的相等性测试</code> 的。故如果 <code>两个元组中的某个元组的某个属性</code> 为 <code>null</code>，则 <code>这两个元组</code> <code>不相等</code>。</p>
<p>换句话说，使用 <code>unique</code> 判断 <code>某些属性为空的元组</code> 是否 <code>重复</code> 是错误的：</p>
<p>在这种情况下，尽管 <code>某个元组确确实实有多个副本</code>，但 <code>该元组有一个属性为空</code>，则 <code>元组的相等性测试</code> 将永远为 <code>false</code>，进而使得 <code>unique</code> 永远返回 <code>true</code></p>
</blockquote>
<ul>
<li><code>FROM子查询</code></li>
</ul>
<p>可以利用 <code>FROM子查询</code> 来 <code>去除</code> <code>HAVING子句</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 1</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">as</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">avg</span>(salary) <span class="operator">&gt;</span> <span class="number">42000</span>;</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Query 2</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, avg_salary</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> dept_name, <span class="built_in">avg</span>(salary)</span><br><span class="line">     <span class="keyword">FROM</span> instructor</span><br><span class="line">     <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name) <span class="keyword">AS</span> dept_avg(dept_name, avg_salary)</span><br><span class="line"><span class="keyword">WHERE</span> avg_salary <span class="operator">&gt;</span> <span class="number">42000</span>; </span><br></pre></td></tr></table></figure>

<p>该 <code>转化</code> 的思想在于：<code>HAVING子句</code> 实际上的 <code>执行时机</code> 是在 <code>GROUP BY产生结果关系之后</code>，再对 <code>结果关系(也就是一些分组)</code> 进行 <code>过滤</code>。</p>
<p>因此，我们可以 <code>先获得作为结果关系的这些分组</code>，然后再 <code>对这些分组进行过滤</code>。</p>
<ul>
<li><code>WITH子句</code></li>
</ul>
<p><code>WITH子句</code>：用于定义 <code>仅对包含with子句的查询可见</code> 的 <code>临时关系</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> dept_total(dept_name, <span class="keyword">value</span>) <span class="keyword">AS</span> (<span class="keyword">SELECT</span> dept_name, <span class="built_in">sum</span>(salary)</span><br><span class="line">                                     <span class="keyword">FROM</span> instructor</span><br><span class="line">                                     <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name),</span><br><span class="line">dept_total_avg(<span class="keyword">value</span>) <span class="keyword">AS</span> (<span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">                             <span class="keyword">FROM</span> dept_total)</span><br><span class="line"><span class="keyword">SELECT</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> dept_total, dept_total_avg</span><br><span class="line"><span class="keyword">WHERE</span> dept_total.value <span class="operator">&gt;=</span> dept_total_avg.value;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 使用 <code>WITH子句</code> 可以 <code>非常有效地</code> 去除 <code>嵌套子查询</code>。</p>
<p>如果可能，<code>应当尽量使用WITH子句来消除嵌套子查询</code></p>
</blockquote>
<ul>
<li><code>标量子查询 (Scalar Subquery)</code></li>
</ul>
<p><code>SQL</code> 会 <code>自动地</code> 将 <code>仅含有单属性单元组的关系</code> <code>解包</code>为 <code>单个值</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> (<span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">               <span class="keyword">FROM</span> instructor)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>n.b. 从 <code>本质</code> 上来说， <code>标量子查询</code> 返回的 <code>数据类型</code> 是确确实实的 <code>关系</code>。</p>
<p>只不过，在 <code>SQL</code> 实现中可以自动地 <code>对这种类型的关系</code> 进行 <code>拆包</code>。这类似于 <code>Java</code> 中的 <code>Auto Boxed/Unboxed</code></p>
<p><code>SQL编译器</code> 并无法 <code>检测</code> <code>标量子查询</code> 是否真的符合要求。</p>
<p>如果在 <code>运行时</code> 发现 <code>需要输入单个值的地方</code> 所使用的 <code>标量子查询</code> 包含 <code>多个值</code>，则会导致 <code>运行时错误</code></p>
</blockquote>
<h3 id="Modifying-Operation"><a href="#Modifying-Operation" class="headerlink" title="Modifying Operation"></a>Modifying Operation</h3><h3 id="Delete-1"><a href="#Delete-1" class="headerlink" title="Delete"></a>Delete</h3><p>考虑该例子的 <code>语句执行顺序</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This is a wrong example</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> instructor</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> (<span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">               <span class="keyword">FROM</span> instructor)</span><br></pre></td></tr></table></figure>

<p>请注意，<code>我们所编写的SQL语句</code> 应当 <code>满足</code> ：在该语句进行 <code>修改性操作</code> 之前，必须先 <code>测试所有的元组</code>，将 <code>符合测试条件的元组</code> 加入到 <code>待删除列表</code>，之后再 <code>一次性地</code> 执行 <code>修改性操作</code>。</p>
<p>注意：这里所说的 <code>修改性操作</code> 不仅仅是指 <code>Delete</code>，包括 <code>Insert</code> 和 <code>Alter</code> 都有 <code>类似的问题</code></p>
<blockquote>
<p>该问题类似于 <code>ArrayList的并发修改问题</code>，当我们对 <code>正在遍历中的列表</code> 进行 <code>修改性操作</code> 时，必须保证 <code>最终的效果</code> 不依赖于 <code>修改性操作所执行的顺序</code></p>
</blockquote>
<blockquote>
<p>给出 <code>MySQL 8.0</code> 以上版本将 <code>拒绝执行该语句</code> 并且 <code>返回错误</code></p>
<p>1093 - You can’t specify target table ‘instructor’ for update in FROM clause</p>
</blockquote>
<h3 id="Insert-1"><a href="#Insert-1" class="headerlink" title="Insert"></a>Insert</h3><p>常用的插入操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course(course_id, title, dept_name, credits)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;CS-437&#x27;</span>, <span class="string">&#x27;Database Systems&#x27;</span>, <span class="string">&#x27;Comp. SCi.&#x27;</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> instructor</span><br><span class="line"><span class="keyword">SELECT</span> ID, name, dept_name, <span class="number">18000</span></span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Music&#x27;</span> <span class="keyword">AND</span> total_cred <span class="operator">&gt;</span> <span class="number">144</span>;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This is a wrong example</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>该语句 <code>可能会导致无限递归插入</code>，这取决于 <code>数据库的具体实现</code>。</p>
<blockquote>
<p>经过实际测试，<code>MySQL 8.0</code> 以上可以 <code>正常地执行该语句</code>，并且 <code>查询会终止</code>。</p>
<p>它的 <code>语义</code> 为：将 <code>表中的所有元组</code> 按照 <code>顺序</code> <code>克隆一份插入到表的末尾</code></p>
<p><img src="https://s2.loli.net/2022/04/28/UDCi95xnFNvL6GW.png" alt="image-20220428194552573"></p>
<p><img src="https://s2.loli.net/2022/04/28/rmL13RFyhHCZdbW.png" alt="image-20220428194617665"></p>
</blockquote>
<h3 id="Alter-1"><a href="#Alter-1" class="headerlink" title="Alter"></a>Alter</h3><p>当 <code>update语句</code> 之间 <code>受语句执行顺序</code> 所 <code>影响</code> 时，可以使用 <code>case结构</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 1</span></span><br><span class="line"><span class="keyword">UPDATE</span> instructor</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">100000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL 2</span></span><br><span class="line"><span class="keyword">UPDATE</span> instructor</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;=</span> <span class="number">100000</span></span><br></pre></td></tr></table></figure>

<p>为了 <code>正确地表达语义</code>，我们可以使用 <code>case</code> 结构来 <code>正确表述执行顺序之间相互影响的语句</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> instructor</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="keyword">CASE</span></span><br><span class="line">             <span class="keyword">WHEN</span> salary <span class="operator">&lt;=</span> <span class="number">100000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line">             <span class="keyword">ELSE</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line">             <span class="keyword">END</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/27/greedy-oiling-car-optimal-merge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/27/greedy-oiling-car-optimal-merge/" class="post-title-link" itemprop="url">Greedy - Oiling Car & Optimal Merge</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-27 06:16:01" itemprop="dateCreated datePublished" datetime="2022-04-27T06:16:01+00:00">2022-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Greedy-Problems"><a href="#Greedy-Problems" class="headerlink" title="Greedy Problems"></a>Greedy Problems</h1><h2 id="Oiling-Car-Problem"><a href="#Oiling-Car-Problem" class="headerlink" title="Oiling Car Problem"></a>Oiling Car Problem</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>一辆汽车加满油后可行驶 n 公里。旅途中有若干个加油站。设计一个有效算法，指出应</p>
<p>在哪些加油站停靠加油，使沿途加油次数最少。并证明算法能产生一个最优解。</p>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>由文件 input.txt 给出输入数据。第一行有 2 个正整数 n 和 k，表示汽车加满油后可行驶</p>
<p>n 公里，且旅途中有 k 个加油站。接下来的 1 行中，有 k+1 个整数，表示第 k 个加油站与第</p>
<p>k-1 个加油站之间的距离。第 0 个加油站表示出发地，汽车已加满油。第 k+1 个加油站表示</p>
<p>目的地。</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>将编程计算出的最少加油次数输出到文件 output.txt。如果无法到达目的地，则输出”No</p>
<p>Solution”。</p>
<h3 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h3><p><strong>输入文件示例</strong></p>
<p>input.txt</p>
<p>7 7</p>
<p>1 2 3 4 5 1 6 6</p>
<p><strong>输出文件示例</strong></p>
<p>output.txt</p>
<p>4</p>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>将该题建模在<code>图</code>上，设<code>节点</code>为<code>加油站</code>，而<code>边</code>的权重表示<code>两个加油站之间的距离</code>，设<code>汽车</code>初始位置在<code>节点0</code>，</p>
<p>将<code>加油站</code>根据题目所给的相对距离，也建立在<code>数轴</code>上。</p>
<p>同时，<code>合并</code>我们的<code>终点</code>到<code>最后一个加油站</code></p>
<blockquote>
<p>也就是说，我们实际上将<code>源点</code>和<code>终点</code>也一般化为<code>加油站</code>。</p>
<p>我们将<code>起点</code>视为<code>第0个加油站</code>，<code>距离前一个加油站的距离 = 0</code>。</p>
<p>同时将<code>终点</code>视为<code>第k个加油站</code>。</p>
<p>从而，我们得到<code>加油站列表</code>a_0,\cdots,a_k</p>
<p>这样有利于算法逻辑的统一，方便算法进行初始化。</p>
</blockquote>
<ul>
<li>加油次数最少的策略绝对不会存在<code>往左走的路径</code></li>
</ul>
<p>设<code>函数</code>cost(path) &#x3D; \sum_{i&#x3D;0}^{k}{a_i - a_{i+1}}</p>
<p>假设有<code>任意一个策略为</code>p_1，</p>
<p>设<code>路径</code>p_2为<code>在策略</code>p_1<code>的基础上对路径做出如下修改的策略</code>：</p>
<p>将<code>路径</code>a_i, a_i \quad (i \gt 0)修改为(a_i, a_{i-1}, \cdots, a_{i-1}, a_i)</p>
<p>而由于cost{(a_{i-1},\cdots,a_{i-1})} \ge 0，</p>
<p>所以<code>包含这一段子路径</code>并不会对我们<code>减少加油次数</code>有帮助。</p>
<p>因而，我们得出结论：<code>任何包含环的路径所得出的策略的加油次数，并不会好于把环去掉后的策略</code>。也就是最优的策略必然是无环的路径。</p>
<ul>
<li>只在无法到达下一个加油站时才在当前加油站加油可以获得最优解</li>
</ul>
<p>由于要求达到优化目标为<code>加油次数最少</code>，但<code>不限制每次加油的量</code>，且<code>每个加油站都可以把油量加到指定的n值</code>，所以<code>在任何加油站进行加油是没有区别的</code>。</p>
<p>所以，只需要<code>尽可能地不进行加油</code>即可达到<code>最少的加油次数</code>。</p>
<p>如果<code>初始时的油量是无穷的</code>，则我们不需要进行任何加油。</p>
<p>但如果油量是有限的，我们除了需要满足<code>能使得汽车到达下一个加油站</code>即可。</p>
<p>而由于<code>每个加油站除了距离前一个加油站的距离可能不同外，都是相同的加油站</code>。</p>
<p>因而，我们<code>只需考虑当前油量是否足够让汽车从当前加油站到下一个</code>即可。</p>
<p>从而，<code>一旦汽车从当前加油站到达下一个加油站</code>，则<code>可以从原问题中删除掉这个加油站</code>，而使得<code>题目的性质没有发生改变</code>。</p>
<p>换句话说，<code>每次仅考虑前k个加油站时获得的最优步骤，可以组成原问题的最优步骤</code>。</p>
<p>因此，我们采用这种策略可以获得最优解。</p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  7</span></span><br><span class="line"><span class="comment">*  [0] 1 2 (3) (4) 5 (1) (6) 6</span></span><br><span class="line"><span class="comment">*  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">solve</span><span class="params">(<span class="type">int</span> n, ArrayList&lt;Integer&gt; stations)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">gas</span> <span class="operator">=</span> n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; stations.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; stations.get(i+<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No Solution!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        gas -= stations.get(i);</span><br><span class="line">        <span class="keyword">if</span> (gas &lt; stations.get(i + <span class="number">1</span>)) &#123;</span><br><span class="line">            ans++;</span><br><span class="line">            gas = n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Integer.toString(ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL0.in</span> <span class="string">&amp;</span> <span class="string">OIL0.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span> <span class="number">7</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.138600</span> <span class="string">ms</span> <span class="string">(138600</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL1.in</span> <span class="string">&amp;</span> <span class="string">OIL1.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3708 </span><span class="number">6</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">0</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">0</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.111400</span> <span class="string">ms</span> <span class="string">(111400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL10.in</span> <span class="string">&amp;</span> <span class="string">OIL10.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">36</span> <span class="number">942</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="literal">No</span> <span class="string">Solution!</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="literal">No</span> <span class="string">Solution!</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.132500</span> <span class="string">ms</span> <span class="string">(132500</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL2.in</span> <span class="string">&amp;</span> <span class="string">OIL2.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">630</span> <span class="number">37</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">3</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">3</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.167700</span> <span class="string">ms</span> <span class="string">(167700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL3.in</span> <span class="string">&amp;</span> <span class="string">OIL3.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">181</span> <span class="number">46</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">18</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">18</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.156300</span> <span class="string">ms</span> <span class="string">(156300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL4.in</span> <span class="string">&amp;</span> <span class="string">OIL4.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">809</span> <span class="number">638</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">40</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">40</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.312200</span> <span class="string">ms</span> <span class="string">(312200</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL5.in</span> <span class="string">&amp;</span> <span class="string">OIL5.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">887</span> <span class="number">598</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">35</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">35</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.207000</span> <span class="string">ms</span> <span class="string">(207000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL6.in</span> <span class="string">&amp;</span> <span class="string">OIL6.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">532</span> <span class="number">813</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">79</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">79</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.228500</span> <span class="string">ms</span> <span class="string">(228500</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL7.in</span> <span class="string">&amp;</span> <span class="string">OIL7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">301</span> <span class="number">402</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">69</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">69</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.158300</span> <span class="string">ms</span> <span class="string">(158300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL8.in</span> <span class="string">&amp;</span> <span class="string">OIL8.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">716</span> <span class="number">950</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">70</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">70</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.243100</span> <span class="string">ms</span> <span class="string">(243100</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">OIL9.in</span> <span class="string">&amp;</span> <span class="string">OIL9.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">506</span> <span class="number">448</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">49</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">49</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.162700</span> <span class="string">ms</span> <span class="string">(162700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>

<h2 id="Optimal-Merge-Problem"><a href="#Optimal-Merge-Problem" class="headerlink" title="Optimal Merge Problem"></a>Optimal Merge Problem</h2><h3 id="Description-1"><a href="#Description-1" class="headerlink" title="Description"></a>Description</h3><p>给定_k_ 个排好序的序列_s_1 ,<em>s_2 ,…,sk , 用 2 路合并算法将这_k</em> 个序列合并成一个序列。</p>
<p>假设所采用的 2 路合并算法合并 2 个长度分别为_m_ 和 <em>n</em> 的序列需要_m_ + <em>n</em> - 1次比较。试设</p>
<p>计一个算法确定合并这个序列的最优合并顺序，使所需的总比较次数最少。</p>
<p>为了进行比较，还需要确定合并这个序列的最差合并顺序，使所需的总比较次数最多。</p>
<h3 id="Input-1"><a href="#Input-1" class="headerlink" title="Input"></a>Input</h3><p>由文件 input.txt 给出输入数据。第一行有 1 个正整数 k，表示有 k 个待合并序列。接下</p>
<p>来的 1 行中，有 k 个正整数，表示 k 个待合并序列的长度。</p>
<h3 id="Output-1"><a href="#Output-1" class="headerlink" title="Output"></a>Output</h3><p>将编程计算出的最多比较次数和最少比较次数输出到文件 output.txt。</p>
<h3 id="Sample-1"><a href="#Sample-1" class="headerlink" title="Sample"></a>Sample</h3><p><strong>输入文件示例</strong></p>
<p>input.txt</p>
<p>4</p>
<p>5 12 11 2</p>
<p><strong>输出文件示例</strong></p>
<p>output.txt</p>
<p>78 52</p>
<h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>对于<code>归并操作</code>，如果我们仅使用<code>k路归并</code>，且输入规模为<code>n个序列</code>。</p>
<p>则我们可以观察发现，<code>对于每一轮步骤，我们从n个序列中的一个序列中取出头部元素，放入到结果序列中</code>，而这需要<code>比较所有的n个序列的头部元素</code>，总共花费<code>n-1次比较</code></p>
<p>因此，<code>这n个序列的长度是多少</code>是无关紧要的，我们在意的是<code>有几个序列</code>。</p>
<p>换句话说，如果<code>t</code>是当前剩余的序列的总数，则每次取出1个元素，需要<code>比较t-1次</code>。</p>
<ul>
<li>比较次数最多的情况：让将每个序列取到只剩1个元素后换其他序列，直到所有序列均只剩1个元素</li>
<li>比较次数最少的情况：尽可能地减少序列的数量，也就是尽可能地把长度较小的序列先取完，如此反复，直到所有序列都取完。</li>
</ul>
<hr>
<p>假设共有 k 个给定的 <code>序列</code> 的 <code>长度</code> 为 s_1,s_2,\cdots, s_k</p>
<p>设 <code>第i轮开始时剩余的序列的数量</code> 为 k_i</p>
<p>若需要使用 <code>k路合并</code> 将所有的 <code>序列</code> 都进行 <code>归并</code>，则 <code>每一轮归并操作</code> 需要进行的 <code>比较次数</code> 为 k_i，使得一个 <code>元素</code> 有序。</p>
<p>总共 s_1 + s_2 + \cdots + s_k &#x3D; s 个元素，共需要进行 s 轮。</p>
<p>则整个过程 <code>总共需要比较次数</code> 为</p>
<p>由上式可以知道，<code>每轮归并</code> 取走 <code>剩余序列中的其中一个序列的头部元素</code> 所需要进行的 <code>比较次数</code> 与 <code>各个序列自身的长度</code> 无关，仅与 <code>当前剩余的序列数量</code> 有关。</p>
<p>所以，可以得出结论：</p>
<ul>
<li><code>比较次数</code> 最少的情况：每次 <code>取走元素</code> 时，尽可能使得 <code>剩余序列数目</code> 更少。</li>
<li><code>比较次数</code> 最多的情况：每次 <code>取走元素</code> 时，尽可能使得 <code>剩余序列数目</code> 更多。</li>
</ul>
<h3 id="Source-1"><a href="#Source-1" class="headerlink" title="Source"></a>Source</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Lab4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> util.Judger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimalMergeSolver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Judger</span> <span class="variable">judger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Judger</span>(<span class="string">&quot;/Cases/Lab4/OPTIMAL MERGE&quot;</span>).redirectError().ignoreExceptCase(<span class="string">&quot;11&quot;</span>).setMaxExpectedInputLines(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Judger.Pair&lt;Integer, Integer&gt; <span class="title function_">solve</span><span class="params">(ArrayList&lt;Integer&gt; list)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calc min: Priority-Queue</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        PriorityQueue&lt;Integer&gt; minHeap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(list);</span><br><span class="line">        <span class="keyword">while</span> (minHeap.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> minHeap.poll() + minHeap.poll();</span><br><span class="line">            min += sum - <span class="number">1</span>;</span><br><span class="line">            minHeap.add(sum);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calc max</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        PriorityQueue&lt;Integer&gt; maxHeap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(Comparator.reverseOrder());</span><br><span class="line">        maxHeap.addAll(list);</span><br><span class="line">        <span class="keyword">while</span> (maxHeap.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> maxHeap.poll() + maxHeap.poll();</span><br><span class="line">            max += sum - <span class="number">1</span>;</span><br><span class="line">            maxHeap.add(sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Judger</span>.Pair&lt;&gt;(max, min);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Scanner scanner : judger) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">                list.add(scanner.nextInt());</span><br><span class="line">            &#125;</span><br><span class="line">            judger.manuallyStartTimer();</span><br><span class="line">            Judger.Pair&lt;Integer, Integer&gt; result = solve(list);</span><br><span class="line">            System.out.printf(<span class="string">&quot;%d %d\n&quot;</span>, result.getKey(), result.getValue());</span><br><span class="line">            judger.manuallyStopTimer();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Benchmark-1"><a href="#Benchmark-1" class="headerlink" title="Benchmark"></a>Benchmark</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE0.in</span> <span class="string">&amp;</span> <span class="string">MERGE0.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">4</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">78</span> <span class="number">52</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">78</span> <span class="number">52</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">3.060100</span> <span class="string">ms</span> <span class="string">(3060100</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE1.in</span> <span class="string">&amp;</span> <span class="string">MERGE1.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">620</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">13008644</span> <span class="number">285991</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">13008644</span> <span class="number">285991</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">3.215400</span> <span class="string">ms</span> <span class="string">(3215400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE10.in</span> <span class="string">&amp;</span> <span class="string">MERGE10.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">813</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">22558660</span> <span class="number">394886</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">22558660</span> <span class="number">394886</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.361100</span> <span class="string">ms</span> <span class="string">(1361100</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE2.in</span> <span class="string">&amp;</span> <span class="string">MERGE2.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">352</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">4111334</span> <span class="number">142290</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">4111334</span> <span class="number">142290</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.580700</span> <span class="string">ms</span> <span class="string">(580700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE3.in</span> <span class="string">&amp;</span> <span class="string">MERGE3.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">235</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">1820172</span> <span class="number">88000</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">1820172</span> <span class="number">88000</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.731000</span> <span class="string">ms</span> <span class="string">(731000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE4.in</span> <span class="string">&amp;</span> <span class="string">MERGE4.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">222</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">1643475</span> <span class="number">82557</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">1643475</span> <span class="number">82557</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.396400</span> <span class="string">ms</span> <span class="string">(396400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE5.in</span> <span class="string">&amp;</span> <span class="string">MERGE5.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">792</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">21235932</span> <span class="number">375348</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">21235932</span> <span class="number">375348</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.848700</span> <span class="string">ms</span> <span class="string">(848700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE6.in</span> <span class="string">&amp;</span> <span class="string">MERGE6.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">940</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">30287355</span> <span class="number">470933</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">30287355</span> <span class="number">470933</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.966800</span> <span class="string">ms</span> <span class="string">(966800</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE7.in</span> <span class="string">&amp;</span> <span class="string">MERGE7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">936</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">29521637</span> <span class="number">456380</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">29521637</span> <span class="number">456380</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.349700</span> <span class="string">ms</span> <span class="string">(1349700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE8.in</span> <span class="string">&amp;</span> <span class="string">MERGE8.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">380</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">4837331</span> <span class="number">157940</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">4837331</span> <span class="number">157940</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.618000</span> <span class="string">ms</span> <span class="string">(618000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE9.in</span> <span class="string">&amp;</span> <span class="string">MERGE9.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">924</span>, <span class="string">Omit</span> <span class="string">the</span> <span class="string">remaining</span> <span class="number">1</span> <span class="string">line(s)...</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">28269476</span> <span class="number">436352</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">28269476</span> <span class="number">436352</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.808000</span> <span class="string">ms</span> <span class="string">(808000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/25/codesnippet-markdown-builder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/25/codesnippet-markdown-builder/" class="post-title-link" itemprop="url">CodeSnippet Markdown Builder</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-25 17:59:12" itemprop="dateCreated datePublished" datetime="2022-04-25T17:59:12+00:00">2022-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Markdown-Builder"><a href="#Markdown-Builder" class="headerlink" title="Markdown Builder"></a>Markdown Builder</h1><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MarkdownBuilder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">buildMatrix</span><span class="params">(Object origin, Object[] rows, Object[] cols, Object[][] data)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Default value */</span></span><br><span class="line">        <span class="keyword">if</span> (origin == <span class="literal">null</span>) &#123;</span><br><span class="line">            origin = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="literal">null</span>) &#123;</span><br><span class="line">            rows = <span class="keyword">new</span> <span class="title class_">String</span>[data.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">                rows[i] = String.valueOf(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cols == <span class="literal">null</span>) &#123;</span><br><span class="line">            cols = <span class="keyword">new</span> <span class="title class_">String</span>[data[<span class="number">0</span>].length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data[<span class="number">0</span>].length; i++) &#123;</span><br><span class="line">                cols[i] = String.valueOf(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Construct */</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        result.append(<span class="string">&quot;\\begin&#123;bmatrix&#125;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            <span class="comment">// first row</span></span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; cols.length; j++) &#123;</span><br><span class="line">                    <span class="comment">// origin cell</span></span><br><span class="line">                    <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</span><br><span class="line">                        result.append(origin);</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    result.append(<span class="string">&quot;&amp;&quot;</span>).append(cols[j]);</span><br><span class="line">                &#125;</span><br><span class="line">                result.append(<span class="string">&quot;\\\\\n&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// first column</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; data[i].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</span><br><span class="line">                    result.append(rows[i]);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                result.append(<span class="string">&quot;&amp;&quot;</span>).append(data[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            result.append(<span class="string">&quot;\\\\&quot;</span>).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result.append(<span class="string">&quot;\\end&#123;bmatrix&#125;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">buildTable</span><span class="params">(Object origin, Object[] rows, Object[] cols, Object[][] data)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Default value */</span></span><br><span class="line">        <span class="keyword">if</span> (origin == <span class="literal">null</span>) &#123;</span><br><span class="line">            origin = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="literal">null</span>) &#123;</span><br><span class="line">            rows = <span class="keyword">new</span> <span class="title class_">String</span>[data.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">                rows[i] = String.valueOf(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cols == <span class="literal">null</span>) &#123;</span><br><span class="line">            cols = <span class="keyword">new</span> <span class="title class_">String</span>[data[<span class="number">0</span>].length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data[<span class="number">0</span>].length; i++) &#123;</span><br><span class="line">                cols[i] = String.valueOf(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Construct */</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>().append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            <span class="comment">// first row</span></span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; cols.length; j++) &#123;</span><br><span class="line">                    <span class="comment">// origin cell</span></span><br><span class="line">                    <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</span><br><span class="line">                        result.append(<span class="string">&quot;&quot;</span>).append(origin).append(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    result.append(cols[j]).append(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                result.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// second row -&gt; table properties</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; cols.length; j++) &#123;</span><br><span class="line">                    result.append(<span class="string">&quot; :-: &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                result.append(<span class="string">&quot;&quot;</span>).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; data[i].length; j++) &#123;</span><br><span class="line">                <span class="comment">// first column</span></span><br><span class="line">                <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</span><br><span class="line">                    result.append(<span class="string">&quot;&quot;</span>).append(rows[i]).append(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                result.append(data[i][j]).append(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            result.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.append(<span class="string">&quot;\n&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">markdownBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">origin</span> <span class="operator">=</span> <span class="string">&quot;item\\property&quot;</span>;</span><br><span class="line">    String[] rows = &#123;<span class="string">&quot;item1&quot;</span>, <span class="string">&quot;item2&quot;</span>, <span class="string">&quot;item3&quot;</span>&#125;;</span><br><span class="line">    String[] cols = &#123;<span class="string">&quot;value&quot;</span>, <span class="string">&quot;weight&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    String[][] data = &#123;</span><br><span class="line">            &#123;<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;weight1&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;value2&quot;</span>, <span class="string">&quot;weight2&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;value3&quot;</span>, <span class="string">&quot;weight3&quot;</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    System.out.println(Judger.MarkdownBuilder.buildMatrix(origin, rows, cols, data));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h3><p>item\property</p>
<p>value</p>
<p>weight</p>
<p>item1</p>
<p>value1</p>
<p>weight1</p>
<p>item2</p>
<p>value2</p>
<p>weight2</p>
<p>item3</p>
<p>value3</p>
<p>weight3</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://sakurawald.github.io/2022/04/19/dp-complete-knapsack-problem-pebble-merge-problem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SakuraWald">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/dp-complete-knapsack-problem-pebble-merge-problem/" class="post-title-link" itemprop="url">DP -  Multiple-Knapsack Problem & Pebble Merge Problem</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-19 07:53:07" itemprop="dateCreated datePublished" datetime="2022-04-19T07:53:07+00:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:38:44" itemprop="dateModified" datetime="2023-01-01T23:38:44+00:00">2023-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Dynamic-Programming-Problems"><a href="#Dynamic-Programming-Problems" class="headerlink" title="Dynamic Programming Problems"></a>Dynamic Programming Problems</h1><h2 id="Multiple-Knapsack-Problem"><a href="#Multiple-Knapsack-Problem" class="headerlink" title="Multiple-Knapsack Problem"></a>Multiple-Knapsack Problem</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>设有 n 种不同面值的硬币，各硬币的面值存于数组 T［1:n］中。现要用这些面值的硬 币来找钱。可以使用的各种面值的硬币个数存于数组 Coins［1:n］中。 对任意钱数 0≤m≤20001，设计一个用最少硬币找钱 m 的方法。</p>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>由文件 input.txt 提供输入数据，文件的第一行中只有 1 个整数给出n 的值,第 2 行起每 行 2 个数，分别是 T[j]和 Coins[j]。最后 1 行是要找的钱数 m。</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>程序运行结束时，将计算出的最少硬币数输出到文件 output.txt 中。问题无解时输出-1。</p>
<h3 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h3><p><strong>输入文件示例</strong></p>
<p>input.txt</p>
<p>3 1 3 2 3 5 3 18</p>
<p><strong>输出文件示例</strong></p>
<p>output.txt</p>
<p>5</p>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><h4 id="Analyse-the-Dimensions-amp-Establish-the-Recursive-Equation"><a href="#Analyse-the-Dimensions-amp-Establish-the-Recursive-Equation" class="headerlink" title="Analyse the Dimensions &amp; Establish the Recursive Equation"></a>Analyse the Dimensions &amp; Establish the Recursive Equation</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">class Knapsack &#123;</span><br><span class="line"> +capacity</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Item &#123;</span><br><span class="line"> +value</span><br><span class="line"> +weight</span><br><span class="line"> +amount</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，分析出题目中的 <code>对象 (Object)</code> 所涉及到的 <code>属性 (Attribute)</code> 有哪些。</p>
<p>我们可以得到：</p>
<ul>
<li><p>与<code>物品 (硬币)</code>有关的属性有<code>面值 (value)</code>和<code>数量 (amount)</code>。</p>
<blockquote>
<p>实际上，<code>物品</code>还有一个属性为 <code>重量 (weight)</code>。</p>
<p>由于 <code>优化目标</code>为 <code>所需的最少硬币的数量</code>，所以可以将 <code>所有物品的重量</code>均视为 <code>单位重量</code>，</p>
<p>然后 <code>忽略</code> 掉这个属性。</p>
</blockquote>
</li>
<li><p>与<code>背包 (需要凑的零钱)</code>有关的属性有<code>容量 (capacity)</code></p>
</li>
</ul>
<p>所以，我们可以得到3个 <code>数据维度 (Dimension)</code>：<code>硬币的面值</code>，<code>硬币的数量</code>，<code>需要凑的零钱</code>，</p>
<blockquote>
<p><code>硬币的数量</code> 应该算 <code>2个维度</code>，加起来总共 <code>4个维度</code></p>
</blockquote>
<p>并且，我们可以定义<code>递推关系的值</code>为<code>所需的最少硬币数</code>。</p>
<blockquote>
<p>这是因为 <code>所需的最少硬币数</code>是 <code>题目所需求的解</code>。</p>
<blockquote>
<p>一般直接将 <code>递推关系的值</code> 定义为 <code>题目所需要求解的值</code>，然后进行 <code>划分子问题</code>，</p>
<p>这样等到 <code>递推方程的值</code>计算完成，我们就可以 <code>直接</code>得到 <code>问题的解</code>。</p>
</blockquote>
</blockquote>
<hr>
<p>现在，我们不妨考虑一下，在<code>最终凑齐零钱</code>之前发生了什么？</p>
<p>在<code>最后一步 (The Final Step)</code> ，我们会将<code>某种面值的硬币</code>放入<code>k枚</code>，然后满足<code>目标容量</code>。</p>
<blockquote>
<p>n.b. 这里如果认为：<code>最后一步</code> 会将 <code>某种面值的硬币</code> 放入<code>1枚</code> 也可以。</p>
<p>但实际上，<code>某种面值的硬币</code> 可以 <code>一次性</code> 地放入 <code>多枚</code>，并且效果 <code>等价于</code></p>
<p><code>分多次在不同步</code> 放入 <code>该种硬币1枚</code></p>
</blockquote>
<p>因此，我们可以立即得出下面的<code>递推方程</code>。</p>
<hr>
<h4 id="Compress-the-Recursive-Equation"><a href="#Compress-the-Recursive-Equation" class="headerlink" title="Compress the Recursive Equation"></a>Compress the Recursive Equation</h4><p>到此，我们已经得到了<code>递推方程</code>，但该方程是<code>4维</code>的，<code>时间复杂度</code> 可能会较大。</p>
<blockquote>
<p>后面我们会对比 <code>4维解法</code> 和 <code>2维解法</code> 的 <code>性能差异</code>。</p>
<p>当 <code>问题规模</code> 变得 <code>稍微大一些</code> 的时候， <code>4维解法</code> 的 <code>时间复杂度</code> 将无法在 <code>可接受的时间</code> 内完成求解。</p>
</blockquote>
<p>接下来我们可以考虑，能否<code>压缩 (Compress)</code> <code>某些维度</code>来达到<code>降维优化</code>的效果。</p>
<blockquote>
<p>实际上，该 <code>递推方程</code>的 <code>数量 (amount)</code>维度存有 <code>冗余的信息</code>。</p>
</blockquote>
<hr>
<p>关于<code>每种硬币的数量限制</code>，不妨考虑：</p>
<p>如果<code>每种硬币</code>都是<code>无限的</code>，那么我们很确信，<code>capacity较大的问题的最优解</code>由<code>capacity较小的问题的最优解</code>来<code>组成</code>。</p>
<blockquote>
<p>因为<code>每种硬币</code>是 <code>无限的</code>，我们只需要简单地把<code>capacity较小的问题的找零方案</code>进行<code>组合</code>即可。</p>
</blockquote>
<p>但是，如果<code>每种硬币都是有限的</code>，如何知道<code>capacity较大的问题的最优解</code>是否可以 <code>直接</code> 由<code>capacity较小的问题的最优解</code>组合得到，而且 <code>不违反每种硬币的数量限制</code>？</p>
<p>换句话说：如果我们需要<code>凑齐500元</code>，而<code>凑齐500元的最优解</code>由<code>凑齐200元的最优解</code>和<code>凑齐300元的最优解</code>来<code>组合</code>得到。假设，<code>凑齐200元的最优解</code>和<code>凑齐500元的最优解</code>都用到了<code>5元硬币</code>，则我们如何<code>确保所使用的5元硬币的总量符合数量限制</code>？</p>
<p>这个问题其实依赖于我们的<code>计算顺序</code>，<code>凑齐200元的最优解</code>和<code>凑齐300元的最优解</code>并不是<code>独立地被计算出来的</code>。</p>
<p>我们会在<code>凑齐200元的最优解</code>的 <code>基础上</code> 进行计算<code>凑齐300元的最优解</code>，也就是从<code>capacity较小的问题</code>开始计算。</p>
<p>同时，<code>保证任何时候的凑零钱方式</code>都符合 <code>每种硬币的数量限制</code>。</p>
<p>也就是说，我们是通过<code>在capacity较小的问题</code>的 <code>基础 (Base)</code>之上，<code>动态地</code> 计算 <code>capacity较大的问题的最优解</code>，</p>
<blockquote>
<p>换句话说，如果我们在 <code>capacity较小的问题</code> 的 <code>基础</code> 之上，求解 <code>capacity较大的问题</code>的 <code>最优解</code>。</p>
<p>那么违反 <code>数量限制的解</code> 本质上就是 <code>非法解</code>，并不是 <code>合法解</code>，更谈不上 <code>最优解</code>！</p>
<p>这使得处理 <code>数量限制</code>的约束非常容易，我们需要做的仅仅是 <code>在子问题的基础之上求解原问题</code>。</p>
<blockquote>
<p>即要求我们满足 <code>最优子结构 (Optimal Substructure)</code> 性质</p>
</blockquote>
</blockquote>
<hr>
<p>关于<code>每种硬币的数量限制</code>，还有一个重要的性质，那就是<code>凑硬币的顺序是可交换的</code>。</p>
<p>比如说：</p>
<p>也就是<code>同样面值的固定数量的硬币</code>，按 <code>任意顺序</code> 放入，最终的 <code>效果</code> 是等价的。</p>
<blockquote>
<p>即 <code>整数的加法</code>是 <code>可交换的</code></p>
</blockquote>
<p>那么，也就是说：如果我们要求<code>凑齐50元硬币的最优解</code>，而我们 <code>拥有一些10元硬币</code>，</p>
<p>则我们无需考虑<code>到底要按照什么顺序放入这些10元硬币</code>，而仅仅需要考虑，<code>到底一次性要放多少枚10元硬币</code>才可以得到<code>凑齐50元硬币的最优解</code>。</p>
<p>因此，我们实际上利用 <code>可交换性</code>可以<code>压缩</code> 掉 <code>amount维度</code>：</p>
<p>由于对于 <code>某种硬币</code>来说， <code>分多步放入共k枚</code>和 <code>在1步就一次性放入k枚</code>的 <code>效果</code>是 <code>等价的</code>，</p>
<p>那么我们不妨就可以 <code>依次考虑每种类型的硬币</code>，并 <code>确定一次性要放多少枚该种硬币</code>。</p>
<p>在已知<code>正在考虑的硬币类型</code>和 <code>当前需要凑齐的金额</code>时，我们可以很容易地得出 <code>当前类型的硬币的数量</code>的 <code>上下界</code>，</p>
<p>然后依次考虑 <code>k的所有可能取值</code>，找出 <code>原问题的最优解</code>。</p>
<blockquote>
<p>如果没有这样压缩，则我们要为<code>amount维度</code>的每种可能的来源方式做考虑：</p>
<p>如果没有 <code>可交换性</code>的话，我们就需要为 <code>硬币数量的所有可能来源</code>做考虑。</p>
<p>如 5枚 &#x3D; 0+5 &#x3D; 1 + 4 &#x3D; 2 + 3 &#x3D; 3 + 2 &#x3D; 4 + 1 &#x3D; 5 + 0</p>
</blockquote>
<hr>
<p>因而，我们可以得到 <code>压缩后的递推方程</code>。</p>
<blockquote>
<p>n.b. 当我们<code>集中起来一次性考虑每种面额要放多少枚硬币</code>时，我们将<code>非常容易地</code>实现<code>对每种面值的硬币的数量的限制</code>（只需要通过简单地取定<code>当前面值的硬币</code>的<code>循环下限</code>和<code>循环上限</code>即可）</p>
<blockquote>
<p>同时这也意味着，<code>每种硬币的数量是特定的</code>和<code>每种硬币的数量是无限的</code>这两种问题本质上是相同的。</p>
</blockquote>
</blockquote>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h4 id="Iterative-Method"><a href="#Iterative-Method" class="headerlink" title="Iterative Method"></a>Iterative Method</h4><h5 id="Diagram"><a href="#Diagram" class="headerlink" title="Diagram"></a>Diagram</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">2</span> <span class="number">3</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">6</span> <span class="number">1</span>, <span class="number">12</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>item\capacity</p>
<p>0</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>0</p>
<p>0</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1</p>
<p>0</p>
<p>1061109567</p>
<p>1</p>
<p>1061109567</p>
<p>2</p>
<p>1061109567</p>
<p>3</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>2</p>
<p>0</p>
<p>1061109567</p>
<p>1</p>
<p>1</p>
<p>2</p>
<p>2</p>
<p>2</p>
<p>1061109567</p>
<p>3</p>
<p>3</p>
<p>1061109567</p>
<p>4</p>
<p>1061109567</p>
<p>3</p>
<p> —————————————————–Current Case: MODE1.in &amp; MODE1.outExpected  Input: [10, Omit the remaining 10 line(s)…]Expected Output: [1, 5]Your     Output: [1, 5]Time Cost: 0.045200 ms (45200 ns)Accepted—————————————————–Current Case: MODE10.in &amp; MODE10.outExpected  Input: [1234567, Omit the remaining 1234567 line(s)…]Expected Output: [47527, 38]Your     Output: [47527, 38]Time Cost: 104.330000 ms (104330000 ns)Accepted—————————————————–Current Case: MODE11.in &amp; MODE11.outExpected  Input: [10, Omit the remaining 10 line(s)…]Expected Output: [1, 6]Your     Output: [1, 6]Time Cost: 0.001100 ms (1100 ns)Accepted—————————————————–Current Case: MODE12.in &amp; MODE12.outExpected  Input: [10, Omit the remaining 10 line(s)…]Expected Output: [2, 5]Your     Output: [2, 5]Time Cost: 0.001000 ms (1000 ns)Accepted—————————————————–Current Case: MODE13.in &amp; MODE13.outExpected  Input: [10, Omit the remaining 10 line(s)…]Expected Output: [2, 4]Your     Output: [2, 4]Time Cost: 0.000901 ms (901 ns)Accepted—————————————————–Current Case: MODE14.in &amp; MODE14.outExpected  Input: [10, Omit the remaining 10 line(s)…]Expected Output: [2, 4]Your     Output: [2, 4]Time Cost: 0.001200 ms (1200 ns)Accepted—————————————————–Current Case: MODE15.in &amp; MODE15.outExpected  Input: [10, Omit the remaining 9 line(s)…]Expected Output: [3, 4]Your     Output: [3, 4]Time Cost: 0.001101 ms (1101 ns)Accepted—————————————————–Current Case: MODE2.in &amp; MODE2.outExpected  Input: [50, Omit the remaining 50 line(s)…]Expected Output: [3, 8]Your     Output: [3, 8]Time Cost: 0.002099 ms (2099 ns)Accepted—————————————————–Current Case: MODE3.in &amp; MODE3.outExpected  Input: [100, Omit the remaining 100 line(s)…]Expected Output: [28, 9]Your     Output: [28, 9]Time Cost: 0.004400 ms (4400 ns)Accepted—————————————————–Current Case: MODE4.in &amp; MODE4.outExpected  Input: [500, Omit the remaining 500 line(s)…]Expected Output: [17, 8]Your     Output: [29, 8]Time Cost: 0.029600 ms (29600 ns)Wrong Answer.—————————————————–Current Case: MODE5.in &amp; MODE5.outExpected  Input: [10000, Omit the remaining 10000 line(s)…]Expected Output: [152, 11]Your     Output: [152, 11]Time Cost: 0.564300 ms (564300 ns)Accepted—————————————————–Current Case: MODE6.in &amp; MODE6.outExpected  Input: [50000, Omit the remaining 50000 line(s)…]Expected Output: [1507, 11]Your     Output: [1507, 11]Time Cost: 3.741200 ms (3741200 ns)Accepted—————————————————–Current Case: MODE7.in &amp; MODE7.outExpected  Input: [500000, Omit the remaining 500000 line(s)…]Expected Output: [62872, 23]Your     Output: [62872, 23]Time Cost: 37.026301 ms (37026301 ns)Accepted—————————————————–Current Case: MODE8.in &amp; MODE8.outExpected  Input: [1000000, Omit the remaining 1000000 line(s)…]Expected Output: [15875, 34]Your     Output: [15875, 34]Time Cost: 71.459100 ms (71459100 ns)Accepted—————————————————–Current Case: MODE9.in &amp; MODE9.outExpected  Input: [1234567, Omit the remaining 1234567 line(s)…]Expected Output: [44678, 42]Your     Output: [44678, 42]Time Cost: 83.852201 ms (83852201 ns)Accepted—————————————————–Result Statistics: √ √ √ √ √ √ √ √ √ × √ √ √ √ √ yaml</p>
<p>1061109567</p>
<p>1</p>
<p>1</p>
<p>2</p>
<p>2</p>
<p>1</p>
<p>1061109567</p>
<p>2</p>
<p>2</p>
<p>3</p>
<p>3</p>
<p>3</p>
<h5 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">solve</span><span class="params">(<span class="type">int</span>[] values, <span class="type">int</span>[] amounts, <span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">    <span class="comment">// define dp array</span></span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[values.length + <span class="number">1</span>][capacity + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= values.length; i++) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= capacity; j++) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][j] = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// only use the first i coins</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= values.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> values[i - <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// to satisfy j capacity</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= capacity; j++) &#123;</span><br><span class="line">            <span class="comment">// how many coins of this type should be used ?</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt;= j / value &amp;&amp; k &lt;= amounts[i - <span class="number">1</span>]; k++) &#123;</span><br><span class="line">                dp[i][j] = Math.min(dp[i - <span class="number">1</span>][j], dp[i - <span class="number">1</span>][j - k * value] + k);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> dp[values.length][capacity];</span><br><span class="line">    <span class="keyword">return</span> ans == <span class="number">0x3f3f3f3f</span> ? -<span class="number">1</span> : ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS0.in</span> <span class="string">&amp;</span> <span class="string">COINS0.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">12</span>, <span class="number">5</span> <span class="number">180</span>, <span class="number">10</span> <span class="number">0</span>, <span class="number">20</span> <span class="number">109</span>, <span class="number">50</span> <span class="number">126</span>, <span class="number">100</span> <span class="number">192</span>, <span class="number">200</span> <span class="number">107</span>, <span class="number">500</span> <span class="number">47</span>, <span class="number">1000 </span><span class="number">20</span>, <span class="number">14758</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">25.284600</span> <span class="string">ms</span> <span class="string">(25284600</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS1.in</span> <span class="string">&amp;</span> <span class="string">COINS1.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">12</span>, <span class="number">5</span> <span class="number">180</span>, <span class="number">10</span> <span class="number">0</span>, <span class="number">20</span> <span class="number">109</span>, <span class="number">50</span> <span class="number">126</span>, <span class="number">100</span> <span class="number">192</span>, <span class="number">200</span> <span class="number">107</span>, <span class="number">500</span> <span class="number">47</span>, <span class="number">1000 </span><span class="number">20</span>, <span class="number">14758</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">16.951400</span> <span class="string">ms</span> <span class="string">(16951400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS2.in</span> <span class="string">&amp;</span> <span class="string">COINS2.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">45</span>, <span class="number">5</span> <span class="number">0</span>, <span class="number">10</span> <span class="number">148</span>, <span class="number">20</span> <span class="number">145</span>, <span class="number">50</span> <span class="number">136</span>, <span class="number">100</span> <span class="number">181</span>, <span class="number">200</span> <span class="number">17</span>, <span class="number">500</span> <span class="number">172</span>, <span class="number">1000 </span><span class="number">152</span>, <span class="number">16834</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">23</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">23</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">13.734800</span> <span class="string">ms</span> <span class="string">(13734800</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS3.in</span> <span class="string">&amp;</span> <span class="string">COINS3.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">22</span>, <span class="number">5</span> <span class="number">0</span>, <span class="number">10</span> <span class="number">27</span>, <span class="number">20</span> <span class="number">52</span>, <span class="number">50</span> <span class="number">192</span>, <span class="number">100</span> <span class="number">164</span>, <span class="number">200</span> <span class="number">110</span>, <span class="number">500</span> <span class="number">62</span>, <span class="number">1000 </span><span class="number">98</span>, <span class="number">17397</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">10.814700</span> <span class="string">ms</span> <span class="string">(10814700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS4.in</span> <span class="string">&amp;</span> <span class="string">COINS4.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">99</span>, <span class="number">5</span> <span class="number">173</span>, <span class="number">10</span> <span class="number">11</span>, <span class="number">20</span> <span class="number">54</span>, <span class="number">50</span> <span class="number">101</span>, <span class="number">100</span> <span class="number">6</span>, <span class="number">200</span> <span class="number">44</span>, <span class="number">500</span> <span class="number">15</span>, <span class="number">1000 </span><span class="number">126</span>, <span class="number">12810</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">16</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">16</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">8.838500</span> <span class="string">ms</span> <span class="string">(8838500</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS5.in</span> <span class="string">&amp;</span> <span class="string">COINS5.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">133</span>, <span class="number">5</span> <span class="number">6</span>, <span class="number">10</span> <span class="number">137</span>, <span class="number">20</span> <span class="number">196</span>, <span class="number">50</span> <span class="number">198</span>, <span class="number">100</span> <span class="number">176</span>, <span class="number">200</span> <span class="number">0</span>, <span class="number">500</span> <span class="number">168</span>, <span class="number">1000 </span><span class="number">94</span>, <span class="number">2253</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.159000</span> <span class="string">ms</span> <span class="string">(1159000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS6.in</span> <span class="string">&amp;</span> <span class="string">COINS6.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">0</span>, <span class="number">5</span> <span class="number">3</span>, <span class="number">10</span> <span class="number">131</span>, <span class="number">20</span> <span class="number">24</span>, <span class="number">50</span> <span class="number">78</span>, <span class="number">100</span> <span class="number">66</span>, <span class="number">200</span> <span class="number">84</span>, <span class="number">500</span> <span class="number">147</span>, <span class="number">1000 </span><span class="number">152</span>, <span class="number">16423</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">8.171400</span> <span class="string">ms</span> <span class="string">(8171400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>

<h4 id="Recursive-Method-2-Dimension"><a href="#Recursive-Method-2-Dimension" class="headerlink" title="Recursive Method (2-Dimension)"></a>Recursive Method (2-Dimension)</h4><h5 id="Diagram-1"><a href="#Diagram-1" class="headerlink" title="Diagram"></a>Diagram</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">2</span> <span class="number">3</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">6</span> <span class="number">1</span>, <span class="number">12</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">root((root)) --#1, 0 * 6--&gt; 47c306e5((12))</span><br><span class="line">47c306e5 --#2, 0 * 3--&gt; 1c2ac852((12))</span><br><span class="line">1c2ac852 --#3, 0 * 2--&gt; a6e0b278((12))</span><br><span class="line">1c2ac852 --#4, 1 * 2--&gt; d03ca462((10))</span><br><span class="line">1c2ac852 --#5, 2 * 2--&gt; 91c93566((8))</span><br><span class="line">1c2ac852 --#6, 3 * 2--&gt; 4180836e((6))</span><br><span class="line">style 4180836e fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">47c306e5 --#7, 1 * 3--&gt; 5ecc1041((9))</span><br><span class="line">5ecc1041 --#8, 0 * 2--&gt; b759c285((9))</span><br><span class="line">5ecc1041 --#9, 1 * 2--&gt; 01ecf723((7))</span><br><span class="line">5ecc1041 --#10, 2 * 2--&gt; a3105e86((5))</span><br><span class="line">5ecc1041 --#11, 3 * 2--&gt; 25c25e57((3))</span><br><span class="line">style 25c25e57 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">47c306e5 --#12, 2 * 3--&gt; be869faa((6))</span><br><span class="line">style be869faa fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">be869faa --#13, 0 * 2--&gt; 3314f76a((6))</span><br><span class="line">style 3314f76a fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">be869faa --#14, 1 * 2--&gt; e07a5826((4))</span><br><span class="line">be869faa --#15, 2 * 2--&gt; bdcf5e09((2))</span><br><span class="line">be869faa --#16, 3 * 2--&gt; b6de7abb((0))</span><br><span class="line">style b6de7abb fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">47c306e5 --#17, 3 * 3--&gt; 4fd2a78a((3))</span><br><span class="line">style 4fd2a78a fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">4fd2a78a --#18, 0 * 2--&gt; 24309338((3))</span><br><span class="line">style 24309338 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">4fd2a78a --#19, 1 * 2--&gt; a9927e68((1))</span><br><span class="line">root((root)) --#20, 1 * 6--&gt; 30bd713b((6))</span><br><span class="line">30bd713b --#21, 0 * 3--&gt; 82f6a912((6))</span><br><span class="line">style 82f6a912 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">30bd713b --#22, 1 * 3--&gt; a1adc784((3))</span><br><span class="line">style a1adc784 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">30bd713b --#23, 2 * 3--&gt; 2bd1ac23((0))</span><br><span class="line">2bd1ac23 --#24, 0 * 2--&gt; 9eccd897((0))</span><br><span class="line">style 9eccd897 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Source-1"><a href="#Source-1" class="headerlink" title="Source"></a>Source</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> n;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span>[] values;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span>[] amounts;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> capacity;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span>[][] dp;</span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span>[][] visited;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">INF</span> <span class="operator">=</span> <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> firstCoins, <span class="type">int</span> capacity)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Base Case */</span></span><br><span class="line">    <span class="keyword">if</span> (visited[firstCoins][capacity]  firstCoins == <span class="number">0</span>) <span class="keyword">return</span> dp[firstCoins][capacity];</span><br><span class="line">    <span class="keyword">else</span> visited[firstCoins][capacity] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Recursive Case */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> values[firstCoins - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; (k &lt;= capacity / value) &amp;&amp; (k &lt;= amounts[firstCoins - <span class="number">1</span>]); k++) &#123;</span><br><span class="line">        <span class="comment">// the following are the same</span></span><br><span class="line">        <span class="comment">// dp[firstCoins][capacity] = Math.min(f(firstCoins - 1, capacity), f(firstCoins - 1, capacity - (k * value)) + k);</span></span><br><span class="line">        dp[firstCoins][capacity] = Math.min(dp[firstCoins - <span class="number">1</span>][capacity], f(firstCoins - <span class="number">1</span>, capacity - (k * value)) + k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[firstCoins][capacity];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// define dp array</span></span><br><span class="line">    dp = <span class="keyword">new</span> <span class="title class_">int</span>[values.length + <span class="number">1</span>][capacity + <span class="number">1</span>];</span><br><span class="line">    visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[values.length + <span class="number">1</span>][capacity + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= values.length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= capacity; j++) &#123;</span><br><span class="line">            dp[i][j] = INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= values.length; i++) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= capacity; j++) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][j] = INF;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dp</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> f(values.length, capacity);</span><br><span class="line">    <span class="keyword">return</span> ans == INF ? -<span class="number">1</span> : ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Scanner scanner : judger) &#123;</span><br><span class="line">        n = scanner.nextInt();</span><br><span class="line">        values = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        amounts = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">amount</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            values[i] = value;</span><br><span class="line">            amounts[i] = amount;</span><br><span class="line">        &#125;</span><br><span class="line">        capacity = scanner.nextInt();</span><br><span class="line">        judger.manuallyStartTimer();</span><br><span class="line">        System.out.println(solve());</span><br><span class="line">        judger.manuallyStopTimer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Benchmark-1"><a href="#Benchmark-1" class="headerlink" title="Benchmark"></a>Benchmark</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS0.in</span> <span class="string">&amp;</span> <span class="string">COINS0.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">12</span>, <span class="number">5</span> <span class="number">180</span>, <span class="number">10</span> <span class="number">0</span>, <span class="number">20</span> <span class="number">109</span>, <span class="number">50</span> <span class="number">126</span>, <span class="number">100</span> <span class="number">192</span>, <span class="number">200</span> <span class="number">107</span>, <span class="number">500</span> <span class="number">47</span>, <span class="number">1000 </span><span class="number">20</span>, <span class="number">14758</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">8.383200</span> <span class="string">ms</span> <span class="string">(8383200</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS1.in</span> <span class="string">&amp;</span> <span class="string">COINS1.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">12</span>, <span class="number">5</span> <span class="number">180</span>, <span class="number">10</span> <span class="number">0</span>, <span class="number">20</span> <span class="number">109</span>, <span class="number">50</span> <span class="number">126</span>, <span class="number">100</span> <span class="number">192</span>, <span class="number">200</span> <span class="number">107</span>, <span class="number">500</span> <span class="number">47</span>, <span class="number">1000 </span><span class="number">20</span>, <span class="number">14758</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">21</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">5.690600</span> <span class="string">ms</span> <span class="string">(5690600</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS2.in</span> <span class="string">&amp;</span> <span class="string">COINS2.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">45</span>, <span class="number">5</span> <span class="number">0</span>, <span class="number">10</span> <span class="number">148</span>, <span class="number">20</span> <span class="number">145</span>, <span class="number">50</span> <span class="number">136</span>, <span class="number">100</span> <span class="number">181</span>, <span class="number">200</span> <span class="number">17</span>, <span class="number">500</span> <span class="number">172</span>, <span class="number">1000 </span><span class="number">152</span>, <span class="number">16834</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">23</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">23</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">6.921800</span> <span class="string">ms</span> <span class="string">(6921800</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS3.in</span> <span class="string">&amp;</span> <span class="string">COINS3.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">22</span>, <span class="number">5</span> <span class="number">0</span>, <span class="number">10</span> <span class="number">27</span>, <span class="number">20</span> <span class="number">52</span>, <span class="number">50</span> <span class="number">192</span>, <span class="number">100</span> <span class="number">164</span>, <span class="number">200</span> <span class="number">110</span>, <span class="number">500</span> <span class="number">62</span>, <span class="number">1000 </span><span class="number">98</span>, <span class="number">17397</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.721700</span> <span class="string">ms</span> <span class="string">(1721700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS4.in</span> <span class="string">&amp;</span> <span class="string">COINS4.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">99</span>, <span class="number">5</span> <span class="number">173</span>, <span class="number">10</span> <span class="number">11</span>, <span class="number">20</span> <span class="number">54</span>, <span class="number">50</span> <span class="number">101</span>, <span class="number">100</span> <span class="number">6</span>, <span class="number">200</span> <span class="number">44</span>, <span class="number">500</span> <span class="number">15</span>, <span class="number">1000 </span><span class="number">126</span>, <span class="number">12810</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">16</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">16</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">4.294700</span> <span class="string">ms</span> <span class="string">(4294700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS5.in</span> <span class="string">&amp;</span> <span class="string">COINS5.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">133</span>, <span class="number">5</span> <span class="number">6</span>, <span class="number">10</span> <span class="number">137</span>, <span class="number">20</span> <span class="number">196</span>, <span class="number">50</span> <span class="number">198</span>, <span class="number">100</span> <span class="number">176</span>, <span class="number">200</span> <span class="number">0</span>, <span class="number">500</span> <span class="number">168</span>, <span class="number">1000 </span><span class="number">94</span>, <span class="number">2253</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.258100</span> <span class="string">ms</span> <span class="string">(1258100</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS6.in</span> <span class="string">&amp;</span> <span class="string">COINS6.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">10</span>, <span class="number">1</span> <span class="number">0</span>, <span class="number">2</span> <span class="number">0</span>, <span class="number">5</span> <span class="number">3</span>, <span class="number">10</span> <span class="number">131</span>, <span class="number">20</span> <span class="number">24</span>, <span class="number">50</span> <span class="number">78</span>, <span class="number">100</span> <span class="number">66</span>, <span class="number">200</span> <span class="number">84</span>, <span class="number">500</span> <span class="number">147</span>, <span class="number">1000 </span><span class="number">152</span>, <span class="number">16423</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">-1</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">2.296300</span> <span class="string">ms</span> <span class="string">(2296300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS7.in</span> <span class="string">&amp;</span> <span class="string">COINS7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">1</span> <span class="number">1</span>, <span class="number">2</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">11</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.092600</span> <span class="string">ms</span> <span class="string">(92600</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>

<h4 id="Recursive-Method-4-Dimension"><a href="#Recursive-Method-4-Dimension" class="headerlink" title="Recursive Method (4-Dimension)"></a>Recursive Method (4-Dimension)</h4><h5 id="Diagram-2"><a href="#Diagram-2" class="headerlink" title="Diagram"></a>Diagram</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">2</span> <span class="number">3</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">6</span> <span class="number">1</span>, <span class="number">12</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">root((root)) --#36, 0 * 6--&gt; a7411865((12))</span><br><span class="line">a7411865 --#37, 0 * 3--&gt; 45b1eb92((12))</span><br><span class="line">45b1eb92 --#38, 0 * 2--&gt; 23c84bd8((12))</span><br><span class="line">style 23c84bd8 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">45b1eb92 --#39, 1 * 2--&gt; 3a989a55((10))</span><br><span class="line">style 3a989a55 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">45b1eb92 --#40, 2 * 2--&gt; 01f72111((8))</span><br><span class="line">style 01f72111 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">45b1eb92 --#41, 3 * 2--&gt; bf018faf((6))</span><br><span class="line">style bf018faf fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">a7411865 --#42, 1 * 3--&gt; e48ee7e2((9))</span><br><span class="line">e48ee7e2 --#43, 0 * 2--&gt; 4edc439b((9))</span><br><span class="line">style 4edc439b fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">e48ee7e2 --#44, 1 * 2--&gt; f92a6278((7))</span><br><span class="line">style f92a6278 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">e48ee7e2 --#45, 2 * 2--&gt; 1b25d26a((5))</span><br><span class="line">style 1b25d26a fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">e48ee7e2 --#46, 3 * 2--&gt; 39611a30((3))</span><br><span class="line">style 39611a30 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">a7411865 --#47, 2 * 3--&gt; 0abad9d3((6))</span><br><span class="line">0abad9d3 --#48, 0 * 2--&gt; ba8ca012((6))</span><br><span class="line">style ba8ca012 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">0abad9d3 --#49, 1 * 2--&gt; 0475bb15((4))</span><br><span class="line">style 0475bb15 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">0abad9d3 --#50, 2 * 2--&gt; ea8374c3((2))</span><br><span class="line">style ea8374c3 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">0abad9d3 --#51, 3 * 2--&gt; eeff9ef2((0))</span><br><span class="line">style eeff9ef2 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">a7411865 --#52, 3 * 3--&gt; fbb80b24((3))</span><br><span class="line">fbb80b24 --#53, 0 * 2--&gt; a96a30bc((3))</span><br><span class="line">style a96a30bc fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">fbb80b24 --#54, 1 * 2--&gt; fc4ee4be((1))</span><br><span class="line">style fc4ee4be fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">root((root)) --#55, 1 * 6--&gt; 8c399954((6))</span><br><span class="line">8c399954 --#56, 0 * 3--&gt; 59fdd542((6))</span><br><span class="line">59fdd542 --#57, 0 * 2--&gt; 49d33747((6))</span><br><span class="line">style 49d33747 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">59fdd542 --#58, 1 * 2--&gt; 8d975ef6((4))</span><br><span class="line">style 8d975ef6 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">59fdd542 --#59, 2 * 2--&gt; 89d23054((2))</span><br><span class="line">style 89d23054 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">59fdd542 --#60, 3 * 2--&gt; 1ec22271((0))</span><br><span class="line">style 1ec22271 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">8c399954 --#61, 1 * 3--&gt; 4de3015f((3))</span><br><span class="line">4de3015f --#62, 0 * 2--&gt; 010c58d1((3))</span><br><span class="line">style 010c58d1 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">4de3015f --#63, 1 * 2--&gt; 951f5029((1))</span><br><span class="line">style 951f5029 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">8c399954 --#64, 2 * 3--&gt; ce3992c9((0))</span><br><span class="line">style ce3992c9 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Source-2"><a href="#Source-2" class="headerlink" title="Source"></a>Source</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> n;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span>[] values;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span>[] amounts;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> capacity;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">INF</span> <span class="operator">=</span> <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Memo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ArrayList&lt;Memo&gt; memo = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> firstCoins;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] amounts;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> value;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> visited;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Memo</span><span class="params">(<span class="type">int</span> firstCoins, <span class="type">int</span> capacity, <span class="type">int</span>[] amounts, <span class="type">int</span> value, <span class="type">boolean</span> visited)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstCoins = firstCoins;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        <span class="built_in">this</span>.amounts = amounts;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.visited = visited;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span>  <span class="title function_">getClass</span><span class="params">()</span> != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Memo</span> <span class="variable">memo</span> <span class="operator">=</span> (Memo) o;</span><br><span class="line">        <span class="keyword">if</span> (firstCoins != memo.firstCoins) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (capacity != memo.capacity) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> Arrays.equals(amounts, memo.amounts);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">resetMemo</span><span class="params">()</span> &#123;</span><br><span class="line">        memo.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> firstCoins, <span class="type">int</span> capacity, <span class="type">int</span>[] amounts, <span class="type">int</span> value, <span class="type">boolean</span> visited)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> memo.indexOf(<span class="keyword">new</span> <span class="title class_">Memo</span>(firstCoins, capacity, amounts, value, visited));</span><br><span class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">            memo.add(<span class="keyword">new</span> <span class="title class_">Memo</span>(firstCoins, capacity, amounts, value, visited));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            memo.set(index, <span class="keyword">new</span> <span class="title class_">Memo</span>(firstCoins, capacity, amounts, value, visited));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Memo</span> <span class="variable">MEMO_ZERO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Memo</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Memo</span> <span class="variable">MEMO_INF</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Memo</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span>, INF, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Memo <span class="title function_">get</span><span class="params">(<span class="type">int</span> firstCoins, <span class="type">int</span> capacity, <span class="type">int</span>[] amounts)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Special cases */</span></span><br><span class="line">        <span class="keyword">if</span> (capacity == <span class="number">0</span>) <span class="keyword">return</span> MEMO_ZERO;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (firstCoins == <span class="number">0</span>) <span class="keyword">return</span> MEMO_INF;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Normal cases */</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> memo.indexOf(<span class="keyword">new</span> <span class="title class_">Memo</span>(firstCoins, capacity, amounts, -<span class="number">1</span>, <span class="literal">false</span>));</span><br><span class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">Memo</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Memo</span>(firstCoins, capacity, amounts, INF, <span class="literal">false</span>);</span><br><span class="line">            memo.add(temp);</span><br><span class="line">            <span class="keyword">return</span> temp;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> memo.get(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> firstCoins, <span class="type">int</span> capacity, <span class="type">int</span>[] amounts)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Base Case */</span></span><br><span class="line">    <span class="keyword">if</span> (Memo.get(firstCoins, capacity, amounts).visited) &#123;</span><br><span class="line">        <span class="keyword">return</span> Memo.get(firstCoins, capacity, amounts).value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Recursive Case */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> values[firstCoins - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; (k &lt;= capacity / value) &amp;&amp; (k &lt;= amounts[firstCoins - <span class="number">1</span>]); k++) &#123;</span><br><span class="line">        <span class="comment">// choice 1</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">do_not_use_current_type_of_coin</span> <span class="operator">=</span> Memo.get(firstCoins - <span class="number">1</span>, capacity, amounts).value;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// choice 2</span></span><br><span class="line">        <span class="type">int</span>[] amounts_clone = amounts.clone();</span><br><span class="line">        amounts_clone[firstCoins - <span class="number">1</span>] -= k;</span><br><span class="line">        <span class="type">int</span> <span class="variable">use_current_type_of_coin</span> <span class="operator">=</span> f(firstCoins - <span class="number">1</span>, capacity - (k * value), amounts_clone) + k;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// optimal choice</span></span><br><span class="line">        Memo.set(firstCoins, capacity, amounts, Math.min(do_not_use_current_type_of_coin, use_current_type_of_coin), <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Memo.get(firstCoins, capacity, amounts).value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// define dp array</span></span><br><span class="line">    Memo.resetMemo();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dp</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> f(values.length, capacity, amounts);</span><br><span class="line">    <span class="keyword">return</span> ans == INF ? -<span class="number">1</span> : ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Scanner scanner : judger) &#123;</span><br><span class="line">        n = scanner.nextInt();</span><br><span class="line">        values = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        amounts = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="type">int</span> <span class="variable">amount</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            values[i] = value;</span><br><span class="line">            amounts[i] = amount;</span><br><span class="line">        &#125;</span><br><span class="line">        capacity = scanner.nextInt();</span><br><span class="line">        judger.manuallyStartTimer();</span><br><span class="line">        System.out.println(solve());</span><br><span class="line">        judger.manuallyStopTimer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Benchmark-2"><a href="#Benchmark-2" class="headerlink" title="Benchmark"></a>Benchmark</h5><h6 id="Recursive-Method-with-4-Dimension"><a href="#Recursive-Method-with-4-Dimension" class="headerlink" title="Recursive Method with 4-Dimension"></a>Recursive Method with 4-Dimension</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS7.in</span> <span class="string">&amp;</span> <span class="string">COINS7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">1</span> <span class="number">1</span>, <span class="number">2</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">11</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.000600</span> <span class="string">ms</span> <span class="string">(1000600</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS8.in</span> <span class="string">&amp;</span> <span class="string">COINS8.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">2</span> <span class="number">3</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">6</span> <span class="number">1</span>, <span class="number">12</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">3</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">3</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.242400</span> <span class="string">ms</span> <span class="string">(242400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS9.in</span> <span class="string">&amp;</span> <span class="string">COINS9.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">9</span>, <span class="number">1</span> <span class="number">1</span>, <span class="number">2</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">4</span> <span class="number">4</span>, <span class="number">5</span> <span class="number">5</span>, <span class="number">6</span> <span class="number">6</span>, <span class="number">7</span> <span class="number">7</span>, <span class="number">8</span> <span class="number">8</span>, <span class="number">9</span> <span class="number">9</span>, <span class="number">60</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">7</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">7</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">17775.069700</span> <span class="string">ms</span> <span class="string">(17775069700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>

<h6 id="Recursive-Method-with-2-Dimention"><a href="#Recursive-Method-with-2-Dimention" class="headerlink" title="Recursive Method with 2-Dimention"></a>Recursive Method with 2-Dimention</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS7.in</span> <span class="string">&amp;</span> <span class="string">COINS7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">1</span> <span class="number">1</span>, <span class="number">2</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">11</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">4</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">8.181900</span> <span class="string">ms</span> <span class="string">(8181900</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS8.in</span> <span class="string">&amp;</span> <span class="string">COINS8.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">3</span>, <span class="number">2</span> <span class="number">3</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">6</span> <span class="number">1</span>, <span class="number">12</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">3</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">3</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">3.047300</span> <span class="string">ms</span> <span class="string">(3047300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">COINS9.in</span> <span class="string">&amp;</span> <span class="string">COINS9.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">9</span>, <span class="number">1</span> <span class="number">1</span>, <span class="number">2</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">3</span>, <span class="number">4</span> <span class="number">4</span>, <span class="number">5</span> <span class="number">5</span>, <span class="number">6</span> <span class="number">6</span>, <span class="number">7</span> <span class="number">7</span>, <span class="number">8</span> <span class="number">8</span>, <span class="number">9</span> <span class="number">9</span>, <span class="number">60</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">7</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">7</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">69.721200</span> <span class="string">ms</span> <span class="string">(69721200</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>

<h2 id="Pebble-Merging-Problem"><a href="#Pebble-Merging-Problem" class="headerlink" title="Pebble Merging Problem"></a>Pebble Merging Problem</h2><h3 id="Description-1"><a href="#Description-1" class="headerlink" title="Description"></a>Description</h3><p>在一个圆形操场的四周摆放着 n 堆石子。现要将石子有次序地合并成一堆。规定每次只 能选相邻的 2 堆石子合并成新的一堆，并将新的一堆石子数记为该次合并的得分。试设计一 个算法，计算出将 n 堆石子合并成一堆的最小得分和最大得分。</p>
<h3 id="Input-1"><a href="#Input-1" class="headerlink" title="Input"></a>Input</h3><p>由文件 input.txt 提供输入数据。文件的第 1 行是正整数 n，1≤n≤100，表示有 n 堆石子。 第二行有 n 个数，分别表示每堆石子的个数。</p>
<h3 id="Output-1"><a href="#Output-1" class="headerlink" title="Output"></a>Output</h3><p>程序运行结束时，将计算结果输出到文件 output.txt 中。文件的第 1 行中的数是最小得 分；第 2 行中的数是最大得分；。</p>
<h3 id="Sample-1"><a href="#Sample-1" class="headerlink" title="Sample"></a>Sample</h3><p><strong>输入文件示例</strong></p>
<p>input.txt</p>
<p>4</p>
<p>4 4 5 9</p>
<p><strong>输出文件示例</strong></p>
<p>output.txt</p>
<p>43</p>
<p>54</p>
<h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>我们只考虑<code>最小得分</code>，因为 <code>最小得分</code> 和 <code>最大得分</code> 是<code>对称的</code>。</p>
<p>然后，由于<code>每次只能合并相邻的两堆石子</code>，所以我们不妨<code>将所有石子从左到右排成线性的一堆石子</code></p>
<hr>
<h4 id="Establish-the-Recursive-Equation"><a href="#Establish-the-Recursive-Equation" class="headerlink" title="Establish the Recursive Equation"></a>Establish the Recursive Equation</h4><p>我们不妨考虑 <code>最终 (End)</code> 会发生什么： <code>所有的n堆石子</code> 被合并为 <code>1堆石子</code>。</p>
<p>而<code>最后一步 (The Final Step)</code>时，我们会将<code>2堆石子</code>合并为<code>1堆石子</code>。</p>
<p>显然，我们需要<code>为此次合并操作</code>付出的代价为<code>左边那一堆石子的重量 + 右边那一堆石子的重量</code></p>
<p>此外，我们还要加上<code>为了获得左边那堆石子的所付出的代价</code>和<code>为了获得右边那堆石子所付出的代价</code></p>
<blockquote>
<p>注意，这里面已经隐含了<code>递归</code>，这相当于，我们在<code>线性排列的一堆石子里</code>：在<code>第i堆石子</code>和<code>第j堆石子</code>之中，插入了<code>分隔板</code>，使之形成<code>左边那堆石子（第i堆石子~第k堆石子)</code> 和<code>右边那堆石子 (第k+1堆石子~第j堆石子)</code>。</p>
</blockquote>
<p>因而，我们可以写出<code>递推方程</code></p>
<blockquote>
<p>其中sum表示 <code>前缀和</code></p>
</blockquote>
<hr>
<h4 id="Determine-the-order-of-computation-Iterative-Method"><a href="#Determine-the-order-of-computation-Iterative-Method" class="headerlink" title="Determine the order of computation (Iterative Method)"></a>Determine the order of computation (Iterative Method)</h4><p>为了 <code>保证</code>在 <code>求解原问题</code>时，<code>该原问题所需的所有子问题</code> 均 <code>已经求解完毕</code>，则我们需要 <code>确定合适的运算顺序</code>。</p>
<p>首先，我们考虑下<code>合并过程刚开始的时候</code>：i&#x3D;1,j&#x3D;n 即表示考虑 从<code>第1堆石子</code>到<code>第n堆石子</code>的最少合并代价，</p>
<p>假设<code>最终这个最优解在第k堆石子处分隔开</code>：</p>
<p>即可得到<code>2个子问题</code>，<code>从第1堆石子到第k堆石子的最少合并代价</code>和<code>从第k+1堆石子到第n堆石子的最少合并代价</code>。</p>
<p>不妨继续考虑<code>从第1堆石子到第k堆石子的最少合并代价</code>，我们会发现这里仍然需要 <code>递归</code> ，直到<code>基本情况</code>。</p>
<p>而<code>基本情况</code>就是<code>只有1堆石子的情况</code>。</p>
<p>所以，通过<code>分析递归过程</code>得出的<code>基本情况</code>，我们<code>反过来</code>从<code>基本情况</code>逐步建立<code>迭代形式的运算顺序</code>：即我们从<code>只有1堆石子的最少合并代价</code>开始计算，然后计算<code>只有2堆石子的最少合并代价</code>，…，计算<code>只有n堆石子的最少合并代价</code>。</p>
<p>于是，我们确定了<code>第一个运算顺序：考虑只有[1, n]堆石子的最少合并代价</code></p>
<p>接下来，我们需要<code>枚举</code> <code>只有len堆石子</code>到底是 <code>哪len堆石子</code> ，由于已经确定了<code>石子的堆数（即区间长度 len，因为所有石子堆是线性排列的）</code>。</p>
<p>则我们只需要确定<code>起始点</code>即可，于是，我们确定了<code>第二个运算顺序：只有指定堆的石子的起始点为[0,n - len]</code></p>
<p>而接下来，我们仅需要对<code>指定长度的石子堆</code>进行<code>确定分割点k</code>即可。</p>
<blockquote>
<p>而且由于我们前面的运算顺序中，<code>第一个运算顺序</code>为计算<code>石子堆的长度</code>从1~n</p>
<p>因而，我们在<code>第三个运算顺序</code>时<code>确立分割点</code>时，可以<code>保证 更小区间长度的石子堆的最小合并代价</code>是<code>已经计算好的</code></p>
</blockquote>
<hr>
<p>综上，我们确立好了运算顺序：</p>
<ol>
<li>第一个运算顺序：区间长度（连续的len个石子堆）</li>
<li>第二个运算顺序：区间的起始点（从第i个石子堆开始的连续len个石子堆）</li>
<li>第三个运算顺序：分割点（在这个选定的 <code>石子堆序列</code> 中，选定 <code>分割点</code>，将这个 <code>石子堆序列</code> 分为 <code>左右两个部分</code>）</li>
</ol>
<h4 id="Simply-use-memo-Recursive-Method"><a href="#Simply-use-memo-Recursive-Method" class="headerlink" title="Simply use memo (Recursive Method)"></a>Simply use memo (Recursive Method)</h4><p>在已经得出了 <code>递推方程</code>的情况下，如果不希望 <code>确定运算顺序</code>，则可以直接使用 <code>递归方法</code>。</p>
<p><code>递归方法</code>可以非常自然地 <code>描述</code> <code>递推关系</code>。</p>
<p>在已知 <code>最优子结构</code>的情况下，<code>动态规划 (Dynamic Programming)</code> 和 <code>暴力法 (Brute-Force)</code>最大的区别是：</p>
<p><code>动态规划</code>利用了 <code>重叠子问题 (Overlapping Subproblem)</code>性质。</p>
<p>即 <code>递归形式的动态规划 = 递归形式的暴力法 + 备忘录机制</code></p>
<blockquote>
<p>如果一开始就打算使用<code>递归形式</code>，那么<code>运算顺序</code>就没有那么重要了，因为我们总可以<code>在需要的时候临时计算</code>，然后<code>利用备忘录机制（这很重要，否则会导致重复地求解相同的子问题）</code>来保存<code>某个子问题的计算结果</code>即可。</p>
</blockquote>
<blockquote>
<p>但相比于 <code>迭代形式的动态规划</code>会 <code>产生整颗子问题空间树 (无论某些子问题是否真的被用到)</code>， <code>递归形式的动态规划</code>则只会 <code>生成那些确实需要用到的子问题</code>。</p>
<p>但是，一般来说，<code>迭代形式的动态规划</code>却会更加快速。</p>
<blockquote>
<p><code>编译器</code>对于 <code>迭代算法</code>可以有更多的信息来进行 <code>指令级优化</code>。</p>
<p>同时，<code>迭代形式</code>也可以避免过多的 <code>过程调用的帧栈创建和销毁的代价</code>，以及获得 <code>更优的高速缓存命中率</code></p>
</blockquote>
<p>但通过 <code>递归形式</code>产生的 <code>子问题空间树</code>是 <code>“残缺的”</code>，在只有 <code>少量子问题</code>重复出现的情况下，用 <code>递归形式的动态规划</code>会更加高效。</p>
</blockquote>
<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><h4 id="Iterative-Method-1"><a href="#Iterative-Method-1" class="headerlink" title="Iterative Method"></a>Iterative Method</h4><h5 id="Diagram-3"><a href="#Diagram-3" class="headerlink" title="Diagram"></a>Diagram</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">4</span>, <span class="number">1</span> <span class="number">2</span> <span class="number">3333 </span><span class="number">2</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6676</span>, <span class="number">10010</span>]</span><br></pre></td></tr></table></figure>

<p>i\j</p>
<p>0</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>0</p>
<p>0</p>
<p>3</p>
<p>3339</p>
<p>6676</p>
<p>1</p>
<p>1061109567</p>
<p>0</p>
<p>3335</p>
<p>6672</p>
<p>2</p>
<p>1061109567</p>
<p>1061109567</p>
<p>0</p>
<p>3335</p>
<p>3</p>
<p>1061109567</p>
<p>1061109567</p>
<p>1061109567</p>
<p>0</p>
<p>i\j</p>
<p>0</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>0</p>
<p>0</p>
<p>3</p>
<p>6671</p>
<p>10010</p>
<p>1</p>
<p>0</p>
<p>0</p>
<p>3335</p>
<p>6672</p>
<p>2</p>
<p>0</p>
<p>0</p>
<p>0</p>
<p>3335</p>
<p>3</p>
<p>0</p>
<p>0</p>
<p>0</p>
<p>0</p>
<h5 id="Source-3"><a href="#Source-3" class="headerlink" title="Source"></a>Source</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> Judger.Pair&lt;Integer, Integer&gt; <span class="title function_">solve</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[] sum)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n][n];</span><br><span class="line">    <span class="type">int</span> min, max;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Min cost</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == j) dp[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> dp[i][j] = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">1</span>; len &lt; n; len++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; (n - len); i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + len;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i; k &lt; j; k++) &#123;</span><br><span class="line">                dp[i][j] = Math.min(dp[i][j], dp[i][k] + dp[k + <span class="number">1</span>][j] + (sum[j + <span class="number">1</span>] - sum[i]));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    min = dp[<span class="number">0</span>][n - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Max Cost</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == j) dp[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> dp[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">1</span>; len &lt; n; len++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; (n - len); i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + len;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i; k &lt; j; k++) &#123;</span><br><span class="line">                dp[i][j] = Math.max(dp[i][j], dp[i][k] + (dp[k + <span class="number">1</span>][j] + sum[j + <span class="number">1</span>] - sum[i]));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    max = dp[<span class="number">0</span>][n - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Judger</span>.Pair&lt;&gt;(min, max);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Scanner scanner : judger) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            a[i] = scanner.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Pre-solve: partial sum</span></span><br><span class="line">        <span class="type">int</span>[] sum = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; sum.length; i++) &#123;</span><br><span class="line">            sum[i] = sum[i - <span class="number">1</span>] + a[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Judger.Pair&lt;Integer, Integer&gt; answer = solve(n, sum);</span><br><span class="line">        System.out.printf(<span class="string">&quot;%d\n%d&quot;</span>, answer.getKey(), answer.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Benchmark-3"><a href="#Benchmark-3" class="headerlink" title="Benchmark"></a>Benchmark</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE0.in</span> <span class="string">&amp;</span> <span class="string">MERGE0.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">37</span>, <span class="number">53</span> <span class="number">49</span> <span class="number">2</span> <span class="number">9</span> <span class="number">9</span> <span class="number">30</span> <span class="number">2</span> <span class="number">35</span> <span class="number">1</span> <span class="number">46</span> <span class="number">39</span> <span class="number">46</span> <span class="number">42</span> <span class="number">33</span> <span class="number">13</span> <span class="number">41</span> <span class="number">35</span> <span class="number">57</span> <span class="number">38</span> <span class="number">59</span> <span class="number">15</span> <span class="number">40</span> <span class="number">18</span> <span class="number">6</span> <span class="number">46</span> <span class="number">30</span> <span class="number">53</span> <span class="number">31</span> <span class="number">34</span> <span class="number">57</span> <span class="number">41</span> <span class="number">20</span> <span class="number">1</span> <span class="number">42</span> <span class="number">59</span> <span class="number">46</span> <span class="number">45</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6186</span>, <span class="number">25130</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">6186</span>, <span class="number">25130</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">4.828800</span> <span class="string">ms</span> <span class="string">(4828800</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE1.in</span> <span class="string">&amp;</span> <span class="string">MERGE1.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">4</span>, <span class="number">1</span> <span class="number">2</span> <span class="number">3333 </span><span class="number">2</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6676</span>, <span class="number">10010</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">6676</span>, <span class="number">10010</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.929800</span> <span class="string">ms</span> <span class="string">(929800</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE2.in</span> <span class="string">&amp;</span> <span class="string">MERGE2.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span>, <span class="number">30</span> <span class="number">35</span> <span class="number">15</span> <span class="number">5</span> <span class="number">10</span> <span class="number">20</span> <span class="number">25</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">370</span>, <span class="number">580</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">370</span>, <span class="number">580</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.354100</span> <span class="string">ms</span> <span class="string">(1354100</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE3.in</span> <span class="string">&amp;</span> <span class="string">MERGE3.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span>, <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">116</span>, <span class="number">187</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">116</span>, <span class="number">187</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.063500</span> <span class="string">ms</span> <span class="string">(1063500</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE4.in</span> <span class="string">&amp;</span> <span class="string">MERGE4.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">30</span>, <span class="number">3</span> <span class="number">4</span> <span class="number">7</span> <span class="number">11</span> <span class="number">13</span> <span class="number">15</span> <span class="number">18</span> <span class="number">21</span> <span class="number">17</span> <span class="number">14</span> <span class="number">7</span> <span class="number">5</span> <span class="number">8</span> <span class="number">10</span> <span class="number">19</span> <span class="number">16</span> <span class="number">13</span> <span class="number">10</span> <span class="number">7</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">3</span> <span class="number">15</span> <span class="number">3</span> <span class="number">10</span> <span class="number">8</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">1342</span>, <span class="number">5318</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">1342</span>, <span class="number">5318</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.857000</span> <span class="string">ms</span> <span class="string">(1857000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE5.in</span> <span class="string">&amp;</span> <span class="string">MERGE5.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">4</span>, <span class="number">1</span> <span class="number">3</span> <span class="number">15</span> <span class="number">2</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">42</span>, <span class="number">59</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">42</span>, <span class="number">59</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.901300</span> <span class="string">ms</span> <span class="string">(901300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE6.in</span> <span class="string">&amp;</span> <span class="string">MERGE6.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span>, <span class="number">1</span> <span class="number">7</span> <span class="number">6</span> <span class="number">12</span> <span class="number">3</span> <span class="number">15</span> <span class="number">2</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">129</span>, <span class="number">218</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">129</span>, <span class="number">218</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.066700</span> <span class="string">ms</span> <span class="string">(1066700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE7.in</span> <span class="string">&amp;</span> <span class="string">MERGE7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">5</span>, <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3333 </span><span class="number">2</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6680</span>, <span class="number">13349</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">6680</span>, <span class="number">13349</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.969700</span> <span class="string">ms</span> <span class="string">(969700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE8.in</span> <span class="string">&amp;</span> <span class="string">MERGE8.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">87</span>, <span class="number">14</span> <span class="number">27</span> <span class="number">48</span> <span class="number">9</span> <span class="number">8</span> <span class="number">14</span> <span class="number">9</span> <span class="number">29</span> <span class="number">25</span> <span class="number">14</span> <span class="number">8</span> <span class="number">30</span> <span class="number">37</span> <span class="number">37</span> <span class="number">4</span> <span class="number">4</span> <span class="number">3</span> <span class="number">6</span> <span class="number">39</span> <span class="number">40</span> <span class="number">19</span> <span class="number">30</span> <span class="number">22</span> <span class="number">37</span> <span class="number">25</span> <span class="number">17</span> <span class="number">41</span> <span class="number">41</span> <span class="number">7</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">10</span> <span class="number">33</span> <span class="number">12</span> <span class="number">28</span> <span class="number">13</span> <span class="number">18</span> <span class="number">42</span> <span class="number">16</span> <span class="number">16</span> <span class="number">33</span> <span class="number">34</span> <span class="number">45</span> <span class="number">16</span> <span class="number">24</span> <span class="number">15</span> <span class="number">38</span> <span class="number">37</span> <span class="number">28</span> <span class="number">36</span> <span class="number">21</span> <span class="number">27</span> <span class="number">30</span> <span class="number">44</span> <span class="number">33</span> <span class="number">6</span> <span class="number">24</span> <span class="number">20</span> <span class="number">6</span> <span class="number">3</span> <span class="number">27</span> <span class="number">33</span> <span class="number">4</span> <span class="number">46</span> <span class="number">42</span> <span class="number">34</span> <span class="number">46</span> <span class="number">14</span> <span class="number">35</span> <span class="number">36</span> <span class="number">25</span> <span class="number">33</span> <span class="number">8</span> <span class="number">12</span> <span class="number">47</span> <span class="number">18</span> <span class="number">7</span> <span class="number">49</span> <span class="number">16</span> <span class="number">3</span> <span class="number">5</span> <span class="number">43</span> <span class="number">28</span> <span class="number">35</span> <span class="number">5</span> <span class="number">33</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">12799</span>, <span class="number">96955</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">12799</span>, <span class="number">96955</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">6.057900</span> <span class="string">ms</span> <span class="string">(6057900</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE9.in</span> <span class="string">&amp;</span> <span class="string">MERGE9.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">20</span>, <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">20</span> <span class="number">19</span> <span class="number">18</span> <span class="number">17</span> <span class="number">16</span> <span class="number">15</span> <span class="number">14</span> <span class="number">13</span> <span class="number">12</span> <span class="number">11</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">864</span>, <span class="number">2850</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">864</span>, <span class="number">2850</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.526400</span> <span class="string">ms</span> <span class="string">(1526400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>

<h4 id="Recursive-Method"><a href="#Recursive-Method" class="headerlink" title="Recursive Method"></a>Recursive Method</h4><h5 id="Diagram-4"><a href="#Diagram-4" class="headerlink" title="Diagram"></a>Diagram</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expected  Input: [4, 1 2 3333 2]</span><br><span class="line">Expected Output: [6676, 10010]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">style db2871da fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 984401db fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 108f3e6e fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style d053e213 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 3a08e73b fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 905d2093 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">d053e213 --#1L, 3333--&gt; 3a08e73b((2..2&lt;/br&gt;0))</span><br><span class="line">d053e213 --#1R, 2--&gt; 905d2093((3..3&lt;/br&gt;0))</span><br><span class="line">984401db --#2L, 2--&gt; 108f3e6e((1..1&lt;/br&gt;0))</span><br><span class="line">984401db --#2R, 3335--&gt; d053e213((2..3&lt;/br&gt;3335))</span><br><span class="line">style 9a62f0a0 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style d33c7169 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 64212337 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">9a62f0a0 --#3L, 2--&gt; d33c7169((1..1&lt;/br&gt;0))</span><br><span class="line">9a62f0a0 --#3R, 3333--&gt; 64212337((2..2&lt;/br&gt;0))</span><br><span class="line">style c78fd6db fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">984401db --#4L, 3335--&gt; 9a62f0a0((1..2&lt;/br&gt;3335))</span><br><span class="line">984401db --#4R, 2--&gt; c78fd6db((3..3&lt;/br&gt;0))</span><br><span class="line">root((root)) --#5L, 1--&gt; db2871da((0..0&lt;/br&gt;0))</span><br><span class="line">root((root)) --#5R, 3337--&gt; 984401db((1..3&lt;/br&gt;6672))</span><br><span class="line">style 4361b325 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 1f5338ec fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style c9c46067 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">4361b325 --#6L, 1--&gt; 1f5338ec((0..0&lt;/br&gt;0))</span><br><span class="line">4361b325 --#6R, 2--&gt; c9c46067((1..1&lt;/br&gt;0))</span><br><span class="line">style 6b63e09f fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">root((root)) --#7L, 3--&gt; 4361b325((0..1&lt;/br&gt;3))</span><br><span class="line">root((root)) --#7R, 3335--&gt; 6b63e09f((2..3&lt;/br&gt;3335))</span><br><span class="line">style 4bd4d793 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 2c2b9065 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 20a281ee fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">4bd4d793 --#8L, 1--&gt; 2c2b9065((0..0&lt;/br&gt;0))</span><br><span class="line">4bd4d793 --#8R, 3335--&gt; 20a281ee((1..2&lt;/br&gt;3335))</span><br><span class="line">style 42941b97 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 7de997a1 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">4bd4d793 --#9L, 3--&gt; 42941b97((0..1&lt;/br&gt;3))</span><br><span class="line">4bd4d793 --#9R, 3333--&gt; 7de997a1((2..2&lt;/br&gt;0))</span><br><span class="line">style 5565dbef fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">root((root)) --#10L, 3336--&gt; 4bd4d793((0..2&lt;/br&gt;3339))</span><br><span class="line">root((root)) --#10R, 2--&gt; 5565dbef((3..3&lt;/br&gt;0))</span><br><span class="line">style root fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">root((0..3&lt;/br&gt;6676))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">style c39dfc51 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 4b5075a2 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 9a8edd98 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 77669c62 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 3525cd7d fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 27e0a4da fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">77669c62 --#11L, 3333--&gt; 3525cd7d((2..2&lt;/br&gt;0))</span><br><span class="line">77669c62 --#11R, 2--&gt; 27e0a4da((3..3&lt;/br&gt;0))</span><br><span class="line">4b5075a2 --#12L, 2--&gt; 9a8edd98((1..1&lt;/br&gt;0))</span><br><span class="line">4b5075a2 --#12R, 3335--&gt; 77669c62((2..3&lt;/br&gt;3335))</span><br><span class="line">style cad53082 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 5dec4f10 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 57160f17 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">cad53082 --#13L, 2--&gt; 5dec4f10((1..1&lt;/br&gt;0))</span><br><span class="line">cad53082 --#13R, 3333--&gt; 57160f17((2..2&lt;/br&gt;0))</span><br><span class="line">style 43d989e7 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">4b5075a2 --#14L, 3335--&gt; cad53082((1..2&lt;/br&gt;3335))</span><br><span class="line">4b5075a2 --#14R, 2--&gt; 43d989e7((3..3&lt;/br&gt;0))</span><br><span class="line">root((root)) --#15L, 1--&gt; c39dfc51((0..0&lt;/br&gt;0))</span><br><span class="line">root((root)) --#15R, 3337--&gt; 4b5075a2((1..3&lt;/br&gt;6672))</span><br><span class="line">style 59f09ba9 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style ce2df958 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 3b1bc123 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">59f09ba9 --#16L, 1--&gt; ce2df958((0..0&lt;/br&gt;0))</span><br><span class="line">59f09ba9 --#16R, 2--&gt; 3b1bc123((1..1&lt;/br&gt;0))</span><br><span class="line">style 468ac0d5 fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">root((root)) --#17L, 3--&gt; 59f09ba9((0..1&lt;/br&gt;3))</span><br><span class="line">root((root)) --#17R, 3335--&gt; 468ac0d5((2..3&lt;/br&gt;3335))</span><br><span class="line">style 41c67309 fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line">style 62aca470 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">style b51c743b fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">41c67309 --#18L, 1--&gt; 62aca470((0..0&lt;/br&gt;0))</span><br><span class="line">41c67309 --#18R, 3335--&gt; b51c743b((1..2&lt;/br&gt;3335))</span><br><span class="line">style 675fda1c fill: lightgray,stroke: #333,stroke-width: 4px</span><br><span class="line">style 7631db1b fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">41c67309 --#19L, 3--&gt; 675fda1c((0..1&lt;/br&gt;3))</span><br><span class="line">41c67309 --#19R, 3333--&gt; 7631db1b((2..2&lt;/br&gt;0))</span><br><span class="line">style c18be7c1 fill: gray,stroke: #333,stroke-width: 4px</span><br><span class="line">root((root)) --#20L, 3336--&gt; 41c67309((0..2&lt;/br&gt;6671))</span><br><span class="line">root((root)) --#20R, 2--&gt; c18be7c1((3..3&lt;/br&gt;0))</span><br><span class="line">root((0..3&lt;/br&gt;10010))</span><br><span class="line">style root fill: lightgreen,stroke: #333,stroke-width: 4px</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Source-4"><a href="#Source-4" class="headerlink" title="Source"></a>Source</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> n;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span>[] sum;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span>[][] dp;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">int</span> <span class="title">m</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Base Case */</span></span><br><span class="line">    <span class="keyword">if</span> (dp[i][j] != INF) &#123;</span><br><span class="line">        <span class="keyword">return</span> dp[i][j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Recursive Case */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = i; k &lt; j; k++) &#123;</span><br><span class="line">        <span class="comment">// it&#x27;s also correct: dp[i][j] = Math.min(m(i, j), m(i, k) + m(k + 1, j) + (sum[j + 1] - sum[i]));</span></span><br><span class="line">        dp[i][j] = Math.<span class="built_in">min</span>(dp[i][j], <span class="built_in">m</span>(i, k) + <span class="built_in">m</span>(k + <span class="number">1</span>, j) + (sum[j + <span class="number">1</span>] - sum[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">int</span> <span class="title">M</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Base Case */</span></span><br><span class="line">    <span class="keyword">if</span> (dp[i][j] != -INF) &#123;</span><br><span class="line">        <span class="keyword">return</span> dp[i][j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Recursive Case */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = i; k &lt; j; k++) &#123;</span><br><span class="line">        dp[i][j] = Math.<span class="built_in">max</span>(dp[i][j], <span class="built_in">M</span>(i, k) + <span class="built_in">M</span>(k + <span class="number">1</span>, j) + (sum[j + <span class="number">1</span>] - sum[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> Judger.<span class="function">Pair&lt;Integer, Integer&gt; <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    dp = <span class="keyword">new</span> <span class="type">int</span>[n][n];</span><br><span class="line">    <span class="type">int</span> min, max;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Min */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            dp[i][j] = INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        dp[i][i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    min = <span class="built_in">m</span>(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Max */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            dp[i][j] = -INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        dp[i][i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    max = <span class="built_in">M</span>(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Judger.Pair&lt;&gt;(min, max);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Scanner scanner : judger) &#123;</span><br><span class="line">        n = scanner.<span class="built_in">nextInt</span>();</span><br><span class="line">        <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="type">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            a[i] = scanner.<span class="built_in">nextInt</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Pre-solve: partial sum</span></span><br><span class="line">        sum = <span class="keyword">new</span> <span class="type">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; sum.length; i++) &#123;</span><br><span class="line">            sum[i] = sum[i - <span class="number">1</span>] + a[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Judger.Pair&lt;Integer, Integer&gt; answer = <span class="built_in">solve</span>();</span><br><span class="line">        System.out.<span class="built_in">printf</span>(<span class="string">&quot;%d\n%d&quot;</span>, answer.<span class="built_in">getKey</span>(), answer.<span class="built_in">getValue</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Benchmark-4"><a href="#Benchmark-4" class="headerlink" title="Benchmark"></a>Benchmark</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE0.in</span> <span class="string">&amp;</span> <span class="string">MERGE0.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">37</span>, <span class="number">53</span> <span class="number">49</span> <span class="number">2</span> <span class="number">9</span> <span class="number">9</span> <span class="number">30</span> <span class="number">2</span> <span class="number">35</span> <span class="number">1</span> <span class="number">46</span> <span class="number">39</span> <span class="number">46</span> <span class="number">42</span> <span class="number">33</span> <span class="number">13</span> <span class="number">41</span> <span class="number">35</span> <span class="number">57</span> <span class="number">38</span> <span class="number">59</span> <span class="number">15</span> <span class="number">40</span> <span class="number">18</span> <span class="number">6</span> <span class="number">46</span> <span class="number">30</span> <span class="number">53</span> <span class="number">31</span> <span class="number">34</span> <span class="number">57</span> <span class="number">41</span> <span class="number">20</span> <span class="number">1</span> <span class="number">42</span> <span class="number">59</span> <span class="number">46</span> <span class="number">45</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6186</span>, <span class="number">25130</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">6186</span>, <span class="number">25130</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">4.601200</span> <span class="string">ms</span> <span class="string">(4601200</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE1.in</span> <span class="string">&amp;</span> <span class="string">MERGE1.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">4</span>, <span class="number">1</span> <span class="number">2</span> <span class="number">3333 </span><span class="number">2</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6676</span>, <span class="number">10010</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">6676</span>, <span class="number">10010</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.888000</span> <span class="string">ms</span> <span class="string">(888000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE2.in</span> <span class="string">&amp;</span> <span class="string">MERGE2.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span>, <span class="number">30</span> <span class="number">35</span> <span class="number">15</span> <span class="number">5</span> <span class="number">10</span> <span class="number">20</span> <span class="number">25</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">370</span>, <span class="number">580</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">370</span>, <span class="number">580</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.097400</span> <span class="string">ms</span> <span class="string">(1097400</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE3.in</span> <span class="string">&amp;</span> <span class="string">MERGE3.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span>, <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">116</span>, <span class="number">187</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">116</span>, <span class="number">187</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.463500</span> <span class="string">ms</span> <span class="string">(1463500</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE4.in</span> <span class="string">&amp;</span> <span class="string">MERGE4.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">30</span>, <span class="number">3</span> <span class="number">4</span> <span class="number">7</span> <span class="number">11</span> <span class="number">13</span> <span class="number">15</span> <span class="number">18</span> <span class="number">21</span> <span class="number">17</span> <span class="number">14</span> <span class="number">7</span> <span class="number">5</span> <span class="number">8</span> <span class="number">10</span> <span class="number">19</span> <span class="number">16</span> <span class="number">13</span> <span class="number">10</span> <span class="number">7</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">3</span> <span class="number">15</span> <span class="number">3</span> <span class="number">10</span> <span class="number">8</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">1342</span>, <span class="number">5318</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">1342</span>, <span class="number">5318</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.491700</span> <span class="string">ms</span> <span class="string">(1491700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE5.in</span> <span class="string">&amp;</span> <span class="string">MERGE5.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">4</span>, <span class="number">1</span> <span class="number">3</span> <span class="number">15</span> <span class="number">2</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">42</span>, <span class="number">59</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">42</span>, <span class="number">59</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.847000</span> <span class="string">ms</span> <span class="string">(847000</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE6.in</span> <span class="string">&amp;</span> <span class="string">MERGE6.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">7</span>, <span class="number">1</span> <span class="number">7</span> <span class="number">6</span> <span class="number">12</span> <span class="number">3</span> <span class="number">15</span> <span class="number">2</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">129</span>, <span class="number">218</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">129</span>, <span class="number">218</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.783500</span> <span class="string">ms</span> <span class="string">(783500</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE7.in</span> <span class="string">&amp;</span> <span class="string">MERGE7.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">5</span>, <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3333 </span><span class="number">2</span>]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">6680</span>, <span class="number">13349</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">6680</span>, <span class="number">13349</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">0.795700</span> <span class="string">ms</span> <span class="string">(795700</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE8.in</span> <span class="string">&amp;</span> <span class="string">MERGE8.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">87</span>, <span class="number">14</span> <span class="number">27</span> <span class="number">48</span> <span class="number">9</span> <span class="number">8</span> <span class="number">14</span> <span class="number">9</span> <span class="number">29</span> <span class="number">25</span> <span class="number">14</span> <span class="number">8</span> <span class="number">30</span> <span class="number">37</span> <span class="number">37</span> <span class="number">4</span> <span class="number">4</span> <span class="number">3</span> <span class="number">6</span> <span class="number">39</span> <span class="number">40</span> <span class="number">19</span> <span class="number">30</span> <span class="number">22</span> <span class="number">37</span> <span class="number">25</span> <span class="number">17</span> <span class="number">41</span> <span class="number">41</span> <span class="number">7</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">10</span> <span class="number">33</span> <span class="number">12</span> <span class="number">28</span> <span class="number">13</span> <span class="number">18</span> <span class="number">42</span> <span class="number">16</span> <span class="number">16</span> <span class="number">33</span> <span class="number">34</span> <span class="number">45</span> <span class="number">16</span> <span class="number">24</span> <span class="number">15</span> <span class="number">38</span> <span class="number">37</span> <span class="number">28</span> <span class="number">36</span> <span class="number">21</span> <span class="number">27</span> <span class="number">30</span> <span class="number">44</span> <span class="number">33</span> <span class="number">6</span> <span class="number">24</span> <span class="number">20</span> <span class="number">6</span> <span class="number">3</span> <span class="number">27</span> <span class="number">33</span> <span class="number">4</span> <span class="number">46</span> <span class="number">42</span> <span class="number">34</span> <span class="number">46</span> <span class="number">14</span> <span class="number">35</span> <span class="number">36</span> <span class="number">25</span> <span class="number">33</span> <span class="number">8</span> <span class="number">12</span> <span class="number">47</span> <span class="number">18</span> <span class="number">7</span> <span class="number">49</span> <span class="number">16</span> <span class="number">3</span> <span class="number">5</span> <span class="number">43</span> <span class="number">28</span> <span class="number">35</span> <span class="number">5</span> <span class="number">33</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">12799</span>, <span class="number">96955</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">12799</span>, <span class="number">96955</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">3.839300</span> <span class="string">ms</span> <span class="string">(3839300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Current Case:</span> <span class="string">MERGE9.in</span> <span class="string">&amp;</span> <span class="string">MERGE9.out</span></span><br><span class="line"><span class="attr">Expected  Input:</span> [<span class="number">20</span>, <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">20</span> <span class="number">19</span> <span class="number">18</span> <span class="number">17</span> <span class="number">16</span> <span class="number">15</span> <span class="number">14</span> <span class="number">13</span> <span class="number">12</span> <span class="number">11</span> ]</span><br><span class="line"><span class="attr">Expected Output:</span> [<span class="number">864</span>, <span class="number">2850</span>]</span><br><span class="line"><span class="attr">Your     Output:</span> [<span class="number">864</span>, <span class="number">2850</span>]</span><br><span class="line"><span class="attr">Time Cost:</span> <span class="number">1.105300</span> <span class="string">ms</span> <span class="string">(1105300</span> <span class="string">ns)</span></span><br><span class="line"><span class="string">Accepted.</span></span><br><span class="line"><span class="string">-----------------------------------------------------</span></span><br><span class="line"><span class="attr">Result Statistics:</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> <span class="string">√</span> </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">103</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
